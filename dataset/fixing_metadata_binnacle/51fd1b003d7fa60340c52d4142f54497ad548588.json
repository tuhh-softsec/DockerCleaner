{"seed":2869677604,"processedDockerfileHash":"627343e32efb491ccd2bd35b21da4da5","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","pin-package-manager-versions-pip","pin-package-manager-versions-npm","have-a-healthcheck","have-a-user"],"processedDockerfile":"#\n#      Copyright 2018 EPAM Systems\n#\n#      Licensed under the Apache License, Version 2.0 (the \"License\");\n#      you may not use this file except in compliance with the License.\n#      You may obtain a copy of the License at\n#\n#          http://www.apache.org/licenses/LICENSE-2.0\n#\n#      Unless required by applicable law or agreed to in writing, software\n#      distributed under the License is distributed on an \"AS IS\" BASIS,\n#      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n#      See the License for the specific language governing permissions and\n#      limitations under the License.\n#\n#   Args to build\nARG JUPYTERLAB_VERSION=0.35.6\n#   Image for building ready-to-distribute plugin frontend\nFROM node:10.15.3-stretch AS plugin-frontend-builder\nENV WORK_DIR=\"/opt/legion-plugin\"\nWORKDIR \"${WORK_DIR}/\"\nCOPY legion/jupyterlab-plugin/package.json legion/jupyterlab-plugin/yarn.lock \"${WORK_DIR}/\"/\nRUN yarn install --non-interactive --ignore-scripts\nCOPY legion/jupyterlab-plugin/ \"${WORK_DIR}/\"\nRUN yarn build\nRUN yarn lint\nRUN npm pack .\n#   Image for getting jupyterlab sources for linking\nFROM python:3.6.8-stretch AS plugin-frontend-rebuilder\nARG JUPYTERLAB_VERSION\nRUN apt-get update \\\n && apt-get install --no-install-recommends apt-transport-https -yqq\nRUN echo \"deb https://deb.nodesource.com/node_10.x stretch main\" > /etc/apt/sources.list.d/nodesource.list \\\n && wget -qO- https://deb.nodesource.com/gpgkey/nodesource.gpg.key | apt-key add - \\\n && echo \"deb https://dl.yarnpkg.com/debian/ stable main\" > /etc/apt/sources.list.d/yarn.list \\\n && wget -qO- https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - \\\n && apt-get update \\\n && apt-get install --no-install-recommends nodejs yarn -yqq \\\n && pip install pip==23.1 -U \\\n && pip install pipenv==2023.3.20 \\\n && npm install npm@^6 -g \\\n && rm -rf /var/lib/apt/lists/*\n#   Install jupyterlab\nRUN pip3 install --disable-pip-version-check jupyterlab==$JUPYTERLAB_VERSION\n#   Run installation w/o any code to warm up nodejs cache\nRUN jupyter lab build\n#   Copy and install Legion's plugin\nCOPY --from=plugin-frontend-builder /opt/legion-plugin/jupyter_legion-*.tgz jupyter_legion.tgz\nRUN jupyter labextension install jupyter_legion.tgz\n#   We have to remove folder with node_modules and other build-related staff that is not required for running\nRUN rm -rf /usr/local/share/jupyter/lab/staging\n#   Main image\nFROM python:3.6.8-stretch\nARG JUPYTERLAB_VERSION\nENV WORK_DIR=\"/opt/legion\"\nWORKDIR \"${WORK_DIR}/\"\nRUN wget https://github.com/krallin/tini/releases/download/v0.18.0/tini-amd64 -qO /bin/tiny \\\n && chmod a+x /bin/tiny\nRUN pip3 install --disable-pip-version-check --upgrade pip==18.1 pipenv==2018.10.13 ptvsd==4.2.2 jupyterlab==$JUPYTERLAB_VERSION\nCOPY legion/sdk/Pipfile legion/sdk/Pipfile.lock \"${WORK_DIR}/legion/sdk/\"/\nRUN cd legion/sdk \\\n && pipenv install --system --three\nCOPY legion/toolchains/python/Pipfile legion/toolchains/python/Pipfile.lock \"${WORK_DIR}/legion/toolchains/python/\"/\nRUN cd legion/toolchains/python \\\n && pipenv install --system --three\nCOPY legion/cli/Pipfile legion/cli/Pipfile.lock \"${WORK_DIR}/legion/cli/\"/\nRUN cd legion/cli \\\n && pipenv install --system --three\nCOPY --from=plugin-frontend-rebuilder /usr/local/share/jupyter /usr/local/share/jupyter\nCOPY containers/toolchains/python/legion-doc.txt /opt/legion/\nCOPY containers/toolchains/python/jupyter_notebook_config.py /etc/jupyter/\nCOPY legion/sdk \"${WORK_DIR}/legion/sdk\"\nCOPY legion/toolchains/python \"${WORK_DIR}/legion/toolchains/python\"\nCOPY legion/cli \"${WORK_DIR}/legion/cli\"\nCOPY legion/jupyterlab-plugin \"${WORK_DIR}/legion/jupyterlab-plugin\"\nRUN pip3 install --no-deps -e legion/sdk \\\n && pip3 install --no-deps -e legion/toolchains/python \\\n && pip3 install --no-deps -e legion/cli \\\n && pip3 install -e legion/jupyterlab-plugin \\\n && jupyter serverextension enable --py legion.jupyterlab \\\n && echo '[ ! -z \"$TERM\" -a -r /etc/motd ] \\\n && cat /etc/motd' >> /etc/bash.bashrc \\\n && cat /opt/legion/legion-doc.txt > /etc/motd\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\nHEALTHCHECK CMD curl --fail http://127.0.0.1:3000 || exit 1\n","originalDockerfile":"#\n#     Copyright 2018 EPAM Systems\n#\n#     Licensed under the Apache License, Version 2.0 (the \"License\");\n#     you may not use this file except in compliance with the License.\n#     You may obtain a copy of the License at\n#\n#         http://www.apache.org/licenses/LICENSE-2.0\n#\n#     Unless required by applicable law or agreed to in writing, software\n#     distributed under the License is distributed on an \"AS IS\" BASIS,\n#     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n#     See the License for the specific language governing permissions and\n#     limitations under the License.\n#\n#  Args to build\nARG JUPYTERLAB_VERSION=0.35.6\n#  Image for building ready-to-distribute plugin frontend\nFROM node:10.15.3-stretch AS plugin-frontend-builder\nENV WORK_DIR=\"/opt/legion-plugin\"\nWORKDIR \"${WORK_DIR}/\"\nCOPY legion/jupyterlab-plugin/package.json legion/jupyterlab-plugin/yarn.lock \"${WORK_DIR}/\"/\nRUN yarn install --non-interactive --ignore-scripts\nCOPY legion/jupyterlab-plugin/ \"${WORK_DIR}/\"\nRUN yarn build\nRUN yarn lint\nRUN npm pack .\n#  Image for getting jupyterlab sources for linking\nFROM python:3.6.8-stretch AS plugin-frontend-rebuilder\nARG JUPYTERLAB_VERSION\nRUN apt-get update \\\n && apt-get install apt-transport-https -yqq\nRUN echo \"deb https://deb.nodesource.com/node_10.x stretch main\" > /etc/apt/sources.list.d/nodesource.list \\\n && wget -qO- https://deb.nodesource.com/gpgkey/nodesource.gpg.key | apt-key add - \\\n && echo \"deb https://dl.yarnpkg.com/debian/ stable main\" > /etc/apt/sources.list.d/yarn.list \\\n && wget -qO- https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - \\\n && apt-get update \\\n && apt-get install nodejs yarn -yqq \\\n && pip install pip -U \\\n && pip install pipenv \\\n && npm install npm@^6 -g \\\n && rm -rf /var/lib/apt/lists/*\n#  Install jupyterlab\nRUN pip3 install --disable-pip-version-check jupyterlab==$JUPYTERLAB_VERSION\n#  Run installation w/o any code to warm up nodejs cache\nRUN jupyter lab build\n#  Copy and install Legion's plugin\nCOPY --from=plugin-frontend-builder /opt/legion-plugin/jupyter_legion-*.tgz jupyter_legion.tgz\nRUN jupyter labextension install jupyter_legion.tgz\n#  We have to remove folder with node_modules and other build-related staff that is not required for running\nRUN rm -rf /usr/local/share/jupyter/lab/staging\n#  Main image\nFROM python:3.6.8-stretch\nARG JUPYTERLAB_VERSION\nENV WORK_DIR=\"/opt/legion\"\nWORKDIR \"${WORK_DIR}/\"\nRUN wget https://github.com/krallin/tini/releases/download/v0.18.0/tini-amd64 -qO /bin/tiny \\\n && chmod a+x /bin/tiny\nRUN pip3 install --disable-pip-version-check --upgrade pip==18.1 pipenv==2018.10.13 ptvsd==4.2.2 jupyterlab==$JUPYTERLAB_VERSION\nCOPY legion/sdk/Pipfile legion/sdk/Pipfile.lock \"${WORK_DIR}/legion/sdk/\"/\nRUN cd legion/sdk \\\n && pipenv install --system --three\nCOPY legion/toolchains/python/Pipfile legion/toolchains/python/Pipfile.lock \"${WORK_DIR}/legion/toolchains/python/\"/\nRUN cd legion/toolchains/python \\\n && pipenv install --system --three\nCOPY legion/cli/Pipfile legion/cli/Pipfile.lock \"${WORK_DIR}/legion/cli/\"/\nRUN cd legion/cli \\\n && pipenv install --system --three\nCOPY --from=plugin-frontend-rebuilder /usr/local/share/jupyter /usr/local/share/jupyter\nCOPY containers/toolchains/python/legion-doc.txt /opt/legion/\nCOPY containers/toolchains/python/jupyter_notebook_config.py /etc/jupyter/\nCOPY legion/sdk \"${WORK_DIR}/legion/sdk\"\nCOPY legion/toolchains/python \"${WORK_DIR}/legion/toolchains/python\"\nCOPY legion/cli \"${WORK_DIR}/legion/cli\"\nCOPY legion/jupyterlab-plugin \"${WORK_DIR}/legion/jupyterlab-plugin\"\nRUN pip3 install --no-deps -e legion/sdk \\\n && pip3 install --no-deps -e legion/toolchains/python \\\n && pip3 install --no-deps -e legion/cli \\\n && pip3 install -e legion/jupyterlab-plugin \\\n && jupyter serverextension enable --py legion.jupyterlab \\\n && echo '[ ! -z \"$TERM\" -a -r /etc/motd ] \\\n && cat /etc/motd' >> /etc/bash.bashrc \\\n && cat /opt/legion/legion-doc.txt > /etc/motd\n","injectedSmells":[],"originalDockerfileHash":"37438e82ac311a1289bbe0c5ab0bce24","successfullyInjectedSmells":[],"originalDockerfileUglified":"#\n#      Copyright 2018 EPAM Systems\n#\n#      Licensed under the Apache License, Version 2.0 (the \"License\");\n#      you may not use this file except in compliance with the License.\n#      You may obtain a copy of the License at\n#\n#          http://www.apache.org/licenses/LICENSE-2.0\n#\n#      Unless required by applicable law or agreed to in writing, software\n#      distributed under the License is distributed on an \"AS IS\" BASIS,\n#      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n#      See the License for the specific language governing permissions and\n#      limitations under the License.\n#\n#   Args to build\nARG JUPYTERLAB_VERSION=0.35.6\n#   Image for building ready-to-distribute plugin frontend\nFROM node:10.15.3-stretch AS plugin-frontend-builder\nENV WORK_DIR=\"/opt/legion-plugin\"\nWORKDIR \"${WORK_DIR}/\"\nCOPY legion/jupyterlab-plugin/package.json legion/jupyterlab-plugin/yarn.lock \"${WORK_DIR}/\"/\nRUN yarn install --non-interactive --ignore-scripts\nCOPY legion/jupyterlab-plugin/ \"${WORK_DIR}/\"\nRUN yarn build\nRUN yarn lint\nRUN npm pack .\n#   Image for getting jupyterlab sources for linking\nFROM python:3.6.8-stretch AS plugin-frontend-rebuilder\nARG JUPYTERLAB_VERSION\nRUN apt-get update \\\n && apt-get install apt-transport-https -yqq\nRUN echo \"deb https://deb.nodesource.com/node_10.x stretch main\" > /etc/apt/sources.list.d/nodesource.list \\\n && wget -qO- https://deb.nodesource.com/gpgkey/nodesource.gpg.key | apt-key add - \\\n && echo \"deb https://dl.yarnpkg.com/debian/ stable main\" > /etc/apt/sources.list.d/yarn.list \\\n && wget -qO- https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - \\\n && apt-get update \\\n && apt-get install nodejs yarn -yqq \\\n && pip install pip -U \\\n && pip install pipenv \\\n && npm install npm@^6 -g \\\n && rm -rf /var/lib/apt/lists/*\n#   Install jupyterlab\nRUN pip3 install --disable-pip-version-check jupyterlab==$JUPYTERLAB_VERSION\n#   Run installation w/o any code to warm up nodejs cache\nRUN jupyter lab build\n#   Copy and install Legion's plugin\nCOPY --from=plugin-frontend-builder /opt/legion-plugin/jupyter_legion-*.tgz jupyter_legion.tgz\nRUN jupyter labextension install jupyter_legion.tgz\n#   We have to remove folder with node_modules and other build-related staff that is not required for running\nRUN rm -rf /usr/local/share/jupyter/lab/staging\n#   Main image\nFROM python:3.6.8-stretch\nARG JUPYTERLAB_VERSION\nENV WORK_DIR=\"/opt/legion\"\nWORKDIR \"${WORK_DIR}/\"\nRUN wget https://github.com/krallin/tini/releases/download/v0.18.0/tini-amd64 -qO /bin/tiny \\\n && chmod a+x /bin/tiny\nRUN pip3 install --disable-pip-version-check --upgrade pip==18.1 pipenv==2018.10.13 ptvsd==4.2.2 jupyterlab==$JUPYTERLAB_VERSION\nCOPY legion/sdk/Pipfile legion/sdk/Pipfile.lock \"${WORK_DIR}/legion/sdk/\"/\nRUN cd legion/sdk \\\n && pipenv install --system --three\nCOPY legion/toolchains/python/Pipfile legion/toolchains/python/Pipfile.lock \"${WORK_DIR}/legion/toolchains/python/\"/\nRUN cd legion/toolchains/python \\\n && pipenv install --system --three\nCOPY legion/cli/Pipfile legion/cli/Pipfile.lock \"${WORK_DIR}/legion/cli/\"/\nRUN cd legion/cli \\\n && pipenv install --system --three\nCOPY --from=plugin-frontend-rebuilder /usr/local/share/jupyter /usr/local/share/jupyter\nCOPY containers/toolchains/python/legion-doc.txt /opt/legion/\nCOPY containers/toolchains/python/jupyter_notebook_config.py /etc/jupyter/\nCOPY legion/sdk \"${WORK_DIR}/legion/sdk\"\nCOPY legion/toolchains/python \"${WORK_DIR}/legion/toolchains/python\"\nCOPY legion/cli \"${WORK_DIR}/legion/cli\"\nCOPY legion/jupyterlab-plugin \"${WORK_DIR}/legion/jupyterlab-plugin\"\nRUN pip3 install --no-deps -e legion/sdk \\\n && pip3 install --no-deps -e legion/toolchains/python \\\n && pip3 install --no-deps -e legion/cli \\\n && pip3 install -e legion/jupyterlab-plugin \\\n && jupyter serverextension enable --py legion.jupyterlab \\\n && echo '[ ! -z \"$TERM\" -a -r /etc/motd ] \\\n && cat /etc/motd' >> /etc/bash.bashrc \\\n && cat /opt/legion/legion-doc.txt > /etc/motd\n","originalDockerfileUglifiedHash":"a77f3fd2020afe4cf5eb57fce15d63c7","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/51fd1b003d7fa60340c52d4142f54497ad548588.dockerfile"}