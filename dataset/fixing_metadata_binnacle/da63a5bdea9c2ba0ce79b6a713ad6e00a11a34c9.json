{"seed":58713664,"processedDockerfileHash":"7b99cf57b83090c5c740a83fb517fccf","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["have-a-healthcheck","have-a-user"],"processedDockerfile":"#  ## Dockerfile for guacamole\n#  ## Includes the mysql authentication module preinstalled\n#   Use phusion/baseimage as base image. To make your builds reproducible, make\n#   sure you lock down to a specific version, not to `latest`!\n#   See https://github.com/phusion/baseimage-docker/blob/master/Changelog.md for\n#   a list of version numbers.\nFROM phusion/baseimage:0.9.16\nMAINTAINER Zuhkov <zuhkov@gmail.com>\n#   Set correct environment variables.\nENV HOME=\"/root\"\nENV DEBIAN_FRONTEND=\"noninteractive\"\nENV LC_ALL=\"C.UTF-8\"\nENV LANG=\"en_US.UTF-8\"\nENV LANGUAGE=\"en_US.UTF-8\"\n#   Use baseimage-docker's init system\nCMD [\"/sbin/my_init\"]\n#   Configure user nobody to match unRAID's settings\nRUN usermod -u 99 nobody \\\n && usermod -g 100 nobody \\\n && usermod -d /home nobody \\\n && chown -R nobody:users /home\n#   Disable SSH\nRUN rm -rf /etc/service/sshd /etc/my_init.d/00_regen_ssh_host_keys.sh\nRUN apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 0xcbcb082a1bb943db \\\n && echo \"deb http://mariadb.mirror.iweb.com/repo/5.5/ubuntu `lsb_release -cs ` main\" > /etc/apt/sources.list.d/mariadb.list\n#  ## Don't let apt install docs or man pages\nCOPY excludes /etc/dpkg/dpkg.cfg.d/excludes\n#  ## Install packages and clean up in one command to reduce build size\nRUN apt-get update \\\n && apt-get install --no-install-recommends libcairo2-dev libpng12-dev freerdp-x11 libssh2-1 libfreerdp-dev libvorbis-dev libssl0.9.8 gcc libssh-dev libpulse-dev tomcat7 tomcat7-admin libpango1.0-dev libssh2-1-dev autoconf wget libossp-uuid-dev libtelnet-dev libvncserver-dev build-essential software-properties-common pwgen mariadb-server -y \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* /usr/share/man /usr/share/groff /usr/share/info /usr/share/lintian /usr/share/linda /var/cache/man \\\n && ((find /usr/share/doc -depth -type f ! -name copyright | xargs rm || true ) ) \\\n && ((find /usr/share/doc -empty | xargs rmdir || true ) )\n#  ## Install the authentication extensions in the classpath folder\n#  ## and the client app in the tomcat webapp folder\n#  ## Version of guacamole to be installed\nENV GUAC_VER=\"0.9.5\"\n#  ## Version of mysql-connector-java to install\nENV MCJ_VER=\"5.1.34\"\n#  ## config directory and classpath directory\nRUN mkdir -p /config /var/lib/guacamole/classpath /etc/firstrun\n#   Tweak my.cnf\nRUN sed -i -e 's#\\(bind-address.*=\\).*#\\1 127.0.0.1#g' /etc/mysql/my.cnf \\\n && sed -i -e 's#\\(log_error.*=\\).*#\\1 /config/databases/mysql_safe.log#g' /etc/mysql/my.cnf \\\n && sed -i -e 's/\\(user.*=\\).*/\\1 nobody/g' /etc/mysql/my.cnf \\\n && echo '[mysqld]' > /etc/mysql/conf.d/innodb_file_per_table.cnf \\\n && echo 'innodb_file_per_table' >> /etc/mysql/conf.d/innodb_file_per_table.cnf\n#  ## Install MySQL Authentication Module\nRUN cd /tmp \\\n && wget -q --span-hosts http://downloads.sourceforge.net/project/guacamole/current/extensions/guacamole-auth-mysql-${GUAC_VER}.tar.gz \\\n && tar -zxf guacamole-auth-mysql-$GUAC_VER.tar.gz \\\n && mv -f `find . -type f -name '*.jar' ` /var/lib/guacamole/classpath \\\n && mv -f guacamole-auth-mysql-$GUAC_VER/schema/*.sql /root \\\n && rm -Rf /tmp/*\n#  ## Install dependancies for mysql authentication module\nRUN cd /tmp \\\n && wget -q --span-hosts http://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-${MCJ_VER}.tar.gz \\\n && tar -zxf mysql-connector-java-$MCJ_VER.tar.gz \\\n && mv -f `find . -type f -name '*.jar' ` /var/lib/guacamole/classpath \\\n && rm -Rf /tmp/*\n#  ## Install precompiled client webapp\nRUN cd /var/lib/tomcat7/webapps \\\n && rm -Rf ROOT \\\n && wget -q --span-hosts http://sourceforge.net/projects/guacamole/files/current/binary/guacamole-${GUAC_VER}.war \\\n && ln -s guacamole-$GUAC_VER.war ROOT.war \\\n && ln -s guacamole-$GUAC_VER.war guacamole.war\n#  ## Compile and install guacamole server\nRUN cd /tmp \\\n && wget -q --span-hosts http://sourceforge.net/projects/guacamole/files/current/source/guacamole-server-${GUAC_VER}.tar.gz \\\n && tar -zxf guacamole-server-$GUAC_VER.tar.gz \\\n && cd guacamole-server-$GUAC_VER \\\n && ./configure --with-init-dir=/etc/init.d \\\n && make \\\n && make install \\\n && update-rc.d guacd defaults \\\n && ldconfig \\\n && rm -Rf /tmp/*\n#  ## Compensate for GUAC-513\nRUN ln -s /usr/local/lib/freerdp/guacsnd.so /usr/lib/x86_64-linux-gnu/freerdp/ \\\n && ln -s /usr/local/lib/freerdp/guacdr.so /usr/lib/x86_64-linux-gnu/freerdp/\n#  ## Configure Service Startup\nCOPY rc.local /etc/rc.local\nCOPY mariadb.sh /etc/service/mariadb/run\nCOPY firstrun.sh /etc/my_init.d/firstrun.sh\nCOPY configfiles/. /etc/firstrun/\nRUN chmod a+x /etc/rc.local \\\n && chmod +x /etc/service/mariadb/run \\\n && chmod +x /etc/my_init.d/firstrun.sh \\\n && chown -R nobody:users /config \\\n && chown -R nobody:users /var/log/mysql* \\\n && chown -R nobody:users /var/lib/mysql \\\n && chown -R nobody:users /etc/mysql \\\n && chown -R nobody:users /var/run/mysqld\nEXPOSE 8080/tcp\nVOLUME [\"/config\"]\n#  ## END\n#  ## To make this a persistent guacamole container, you must map /config of this container\n#  ## to a folder on your host machine.\n#  ##\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"# ## Dockerfile for guacamole\n# ## Includes the mysql authentication module preinstalled\n#  Use phusion/baseimage as base image. To make your builds reproducible, make\n#  sure you lock down to a specific version, not to `latest`!\n#  See https://github.com/phusion/baseimage-docker/blob/master/Changelog.md for\n#  a list of version numbers.\nFROM phusion/baseimage:0.9.16\nMAINTAINER Zuhkov <zuhkov@gmail.com>\n#  Set correct environment variables.\nENV HOME=\"/root\"\nENV DEBIAN_FRONTEND=\"noninteractive\"\nENV LC_ALL=\"C.UTF-8\"\nENV LANG=\"en_US.UTF-8\"\nENV LANGUAGE=\"en_US.UTF-8\"\n#  Use baseimage-docker's init system\nCMD [\"/sbin/my_init\"]\n#  Configure user nobody to match unRAID's settings\nRUN usermod -u 99 nobody \\\n && usermod -g 100 nobody \\\n && usermod -d /home nobody \\\n && chown -R nobody:users /home\n#  Disable SSH\nRUN rm -rf /etc/service/sshd /etc/my_init.d/00_regen_ssh_host_keys.sh\nRUN apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 0xcbcb082a1bb943db \\\n && echo \"deb http://mariadb.mirror.iweb.com/repo/5.5/ubuntu `lsb_release -cs ` main\" > /etc/apt/sources.list.d/mariadb.list\n# ## Don't let apt install docs or man pages\nCOPY excludes /etc/dpkg/dpkg.cfg.d/excludes\n# ## Install packages and clean up in one command to reduce build size\nRUN apt-get update \\\n && apt-get install --no-install-recommends libcairo2-dev libpng12-dev freerdp-x11 libssh2-1 libfreerdp-dev libvorbis-dev libssl0.9.8 gcc libssh-dev libpulse-dev tomcat7 tomcat7-admin libpango1.0-dev libssh2-1-dev autoconf wget libossp-uuid-dev libtelnet-dev libvncserver-dev build-essential software-properties-common pwgen mariadb-server -y \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* /usr/share/man /usr/share/groff /usr/share/info /usr/share/lintian /usr/share/linda /var/cache/man \\\n && ((find /usr/share/doc -depth -type f ! -name copyright | xargs rm || true ) ) \\\n && ((find /usr/share/doc -empty | xargs rmdir || true ) )\n# ## Install the authentication extensions in the classpath folder\n# ## and the client app in the tomcat webapp folder\n# ## Version of guacamole to be installed\nENV GUAC_VER=\"0.9.5\"\n# ## Version of mysql-connector-java to install\nENV MCJ_VER=\"5.1.34\"\n# ## config directory and classpath directory\nRUN mkdir -p /config /var/lib/guacamole/classpath /etc/firstrun\n#  Tweak my.cnf\nRUN sed -i -e 's#\\(bind-address.*=\\).*#\\1 127.0.0.1#g' /etc/mysql/my.cnf \\\n && sed -i -e 's#\\(log_error.*=\\).*#\\1 /config/databases/mysql_safe.log#g' /etc/mysql/my.cnf \\\n && sed -i -e 's/\\(user.*=\\).*/\\1 nobody/g' /etc/mysql/my.cnf \\\n && echo '[mysqld]' > /etc/mysql/conf.d/innodb_file_per_table.cnf \\\n && echo 'innodb_file_per_table' >> /etc/mysql/conf.d/innodb_file_per_table.cnf\n# ## Install MySQL Authentication Module\nRUN cd /tmp \\\n && wget -q --span-hosts http://downloads.sourceforge.net/project/guacamole/current/extensions/guacamole-auth-mysql-${GUAC_VER}.tar.gz \\\n && tar -zxf guacamole-auth-mysql-$GUAC_VER.tar.gz \\\n && mv -f `find . -type f -name '*.jar' ` /var/lib/guacamole/classpath \\\n && mv -f guacamole-auth-mysql-$GUAC_VER/schema/*.sql /root \\\n && rm -Rf /tmp/*\n# ## Install dependancies for mysql authentication module\nRUN cd /tmp \\\n && wget -q --span-hosts http://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-${MCJ_VER}.tar.gz \\\n && tar -zxf mysql-connector-java-$MCJ_VER.tar.gz \\\n && mv -f `find . -type f -name '*.jar' ` /var/lib/guacamole/classpath \\\n && rm -Rf /tmp/*\n# ## Install precompiled client webapp\nRUN cd /var/lib/tomcat7/webapps \\\n && rm -Rf ROOT \\\n && wget -q --span-hosts http://sourceforge.net/projects/guacamole/files/current/binary/guacamole-${GUAC_VER}.war \\\n && ln -s guacamole-$GUAC_VER.war ROOT.war \\\n && ln -s guacamole-$GUAC_VER.war guacamole.war\n# ## Compile and install guacamole server\nRUN cd /tmp \\\n && wget -q --span-hosts http://sourceforge.net/projects/guacamole/files/current/source/guacamole-server-${GUAC_VER}.tar.gz \\\n && tar -zxf guacamole-server-$GUAC_VER.tar.gz \\\n && cd guacamole-server-$GUAC_VER \\\n && ./configure --with-init-dir=/etc/init.d \\\n && make \\\n && make install \\\n && update-rc.d guacd defaults \\\n && ldconfig \\\n && rm -Rf /tmp/*\n# ## Compensate for GUAC-513\nRUN ln -s /usr/local/lib/freerdp/guacsnd.so /usr/lib/x86_64-linux-gnu/freerdp/ \\\n && ln -s /usr/local/lib/freerdp/guacdr.so /usr/lib/x86_64-linux-gnu/freerdp/\n# ## Configure Service Startup\nCOPY rc.local /etc/rc.local\nCOPY mariadb.sh /etc/service/mariadb/run\nCOPY firstrun.sh /etc/my_init.d/firstrun.sh\nCOPY configfiles/. /etc/firstrun/\nRUN chmod a+x /etc/rc.local \\\n && chmod +x /etc/service/mariadb/run \\\n && chmod +x /etc/my_init.d/firstrun.sh \\\n && chown -R nobody:users /config \\\n && chown -R nobody:users /var/log/mysql* \\\n && chown -R nobody:users /var/lib/mysql \\\n && chown -R nobody:users /etc/mysql \\\n && chown -R nobody:users /var/run/mysqld\nEXPOSE 8080/tcp\nVOLUME [\"/config\"]\n# ## END\n# ## To make this a persistent guacamole container, you must map /config of this container\n# ## to a folder on your host machine.\n# ##\n","injectedSmells":[],"originalDockerfileHash":"741724c0587a4f52ab4b1852037fe640","successfullyInjectedSmells":[],"originalDockerfileUglified":"#  ## Dockerfile for guacamole\n#  ## Includes the mysql authentication module preinstalled\n#   Use phusion/baseimage as base image. To make your builds reproducible, make\n#   sure you lock down to a specific version, not to `latest`!\n#   See https://github.com/phusion/baseimage-docker/blob/master/Changelog.md for\n#   a list of version numbers.\nFROM phusion/baseimage:0.9.16\nMAINTAINER Zuhkov <zuhkov@gmail.com>\n#   Set correct environment variables.\nENV HOME=\"/root\"\nENV DEBIAN_FRONTEND=\"noninteractive\"\nENV LC_ALL=\"C.UTF-8\"\nENV LANG=\"en_US.UTF-8\"\nENV LANGUAGE=\"en_US.UTF-8\"\n#   Use baseimage-docker's init system\nCMD [\"/sbin/my_init\"]\n#   Configure user nobody to match unRAID's settings\nRUN usermod -u 99 nobody \\\n && usermod -g 100 nobody \\\n && usermod -d /home nobody \\\n && chown -R nobody:users /home\n#   Disable SSH\nRUN rm -rf /etc/service/sshd /etc/my_init.d/00_regen_ssh_host_keys.sh\nRUN apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 0xcbcb082a1bb943db \\\n && echo \"deb http://mariadb.mirror.iweb.com/repo/5.5/ubuntu `lsb_release -cs ` main\" > /etc/apt/sources.list.d/mariadb.list\n#  ## Don't let apt install docs or man pages\nCOPY excludes /etc/dpkg/dpkg.cfg.d/excludes\n#  ## Install packages and clean up in one command to reduce build size\nRUN apt-get update \\\n && apt-get install --no-install-recommends libcairo2-dev libpng12-dev freerdp-x11 libssh2-1 libfreerdp-dev libvorbis-dev libssl0.9.8 gcc libssh-dev libpulse-dev tomcat7 tomcat7-admin libpango1.0-dev libssh2-1-dev autoconf wget libossp-uuid-dev libtelnet-dev libvncserver-dev build-essential software-properties-common pwgen mariadb-server -y \\\n && apt-get clean \\\n && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* /usr/share/man /usr/share/groff /usr/share/info /usr/share/lintian /usr/share/linda /var/cache/man \\\n && ((find /usr/share/doc -depth -type f ! -name copyright | xargs rm || true ) ) \\\n && ((find /usr/share/doc -empty | xargs rmdir || true ) )\n#  ## Install the authentication extensions in the classpath folder\n#  ## and the client app in the tomcat webapp folder\n#  ## Version of guacamole to be installed\nENV GUAC_VER=\"0.9.5\"\n#  ## Version of mysql-connector-java to install\nENV MCJ_VER=\"5.1.34\"\n#  ## config directory and classpath directory\nRUN mkdir -p /config /var/lib/guacamole/classpath /etc/firstrun\n#   Tweak my.cnf\nRUN sed -i -e 's#\\(bind-address.*=\\).*#\\1 127.0.0.1#g' /etc/mysql/my.cnf \\\n && sed -i -e 's#\\(log_error.*=\\).*#\\1 /config/databases/mysql_safe.log#g' /etc/mysql/my.cnf \\\n && sed -i -e 's/\\(user.*=\\).*/\\1 nobody/g' /etc/mysql/my.cnf \\\n && echo '[mysqld]' > /etc/mysql/conf.d/innodb_file_per_table.cnf \\\n && echo 'innodb_file_per_table' >> /etc/mysql/conf.d/innodb_file_per_table.cnf\n#  ## Install MySQL Authentication Module\nRUN cd /tmp \\\n && wget -q --span-hosts http://downloads.sourceforge.net/project/guacamole/current/extensions/guacamole-auth-mysql-${GUAC_VER}.tar.gz \\\n && tar -zxf guacamole-auth-mysql-$GUAC_VER.tar.gz \\\n && mv -f `find . -type f -name '*.jar' ` /var/lib/guacamole/classpath \\\n && mv -f guacamole-auth-mysql-$GUAC_VER/schema/*.sql /root \\\n && rm -Rf /tmp/*\n#  ## Install dependancies for mysql authentication module\nRUN cd /tmp \\\n && wget -q --span-hosts http://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-${MCJ_VER}.tar.gz \\\n && tar -zxf mysql-connector-java-$MCJ_VER.tar.gz \\\n && mv -f `find . -type f -name '*.jar' ` /var/lib/guacamole/classpath \\\n && rm -Rf /tmp/*\n#  ## Install precompiled client webapp\nRUN cd /var/lib/tomcat7/webapps \\\n && rm -Rf ROOT \\\n && wget -q --span-hosts http://sourceforge.net/projects/guacamole/files/current/binary/guacamole-${GUAC_VER}.war \\\n && ln -s guacamole-$GUAC_VER.war ROOT.war \\\n && ln -s guacamole-$GUAC_VER.war guacamole.war\n#  ## Compile and install guacamole server\nRUN cd /tmp \\\n && wget -q --span-hosts http://sourceforge.net/projects/guacamole/files/current/source/guacamole-server-${GUAC_VER}.tar.gz \\\n && tar -zxf guacamole-server-$GUAC_VER.tar.gz \\\n && cd guacamole-server-$GUAC_VER \\\n && ./configure --with-init-dir=/etc/init.d \\\n && make \\\n && make install \\\n && update-rc.d guacd defaults \\\n && ldconfig \\\n && rm -Rf /tmp/*\n#  ## Compensate for GUAC-513\nRUN ln -s /usr/local/lib/freerdp/guacsnd.so /usr/lib/x86_64-linux-gnu/freerdp/ \\\n && ln -s /usr/local/lib/freerdp/guacdr.so /usr/lib/x86_64-linux-gnu/freerdp/\n#  ## Configure Service Startup\nCOPY rc.local /etc/rc.local\nCOPY mariadb.sh /etc/service/mariadb/run\nCOPY firstrun.sh /etc/my_init.d/firstrun.sh\nCOPY configfiles/. /etc/firstrun/\nRUN chmod a+x /etc/rc.local \\\n && chmod +x /etc/service/mariadb/run \\\n && chmod +x /etc/my_init.d/firstrun.sh \\\n && chown -R nobody:users /config \\\n && chown -R nobody:users /var/log/mysql* \\\n && chown -R nobody:users /var/lib/mysql \\\n && chown -R nobody:users /etc/mysql \\\n && chown -R nobody:users /var/run/mysqld\nEXPOSE 8080/tcp\nVOLUME [\"/config\"]\n#  ## END\n#  ## To make this a persistent guacamole container, you must map /config of this container\n#  ## to a folder on your host machine.\n#  ##\n","originalDockerfileUglifiedHash":"5483c24e69eb4908fdacfdb54ec8a648","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/da63a5bdea9c2ba0ce79b6a713ad6e00a11a34c9.dockerfile"}