{"seed":3625220426,"processedDockerfileHash":"b7e118fdc4d24c4b6021210bc5408e9a","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","pin-package-manager-versions-apt-get","do-not-have-secrets","have-a-healthcheck"],"processedDockerfile":"#  == FROM instructions support variables that are declared by\n#   any ARG instructions that occur before the first FROM\n#   ref: https://docs.docker.com/engine/reference/builder/#understand-how-arg-and-from-interact\n#\n#   To overwrite the build args use:\n#    docker build ... --build-arg UBUNTU_DATE=20171006\nARG UBUNTU_FLAVOR=xenial\nARG UBUNTU_DATE=20181113\n#  == Ubuntu xenial is 16.04, i.e. FROM ubuntu:16.04\n#   Find latest images at https://hub.docker.com/r/library/ubuntu/\n#   Layer size: ~122 MB\nFROM ubuntu:${UBUNTU_FLAVOR}-${UBUNTU_DATE}\n#  == An ARG declared before a FROM is outside of a build stage,\n#   so it can’t be used in any instruction after a FROM. To use\n#   the default value of an ARG declared before the first\n#   FROM use an ARG instruction without a value inside of a build stage\n#   ref: https://docs.docker.com/engine/reference/builder/#understand-how-arg-and-from-interact\nARG UBUNTU_FLAVOR\nARG UBUNTU_DATE\n#   Docker build debug logging, green colored\nRUN printf \"\\033[1;32mFROM ubuntu:${UBUNTU_FLAVOR}-${UBUNTU_DATE} \\033[0m\\n\"\n#  == Ubuntu flavors - common\nRUN echo \"deb http://archive.ubuntu.com/ubuntu ${UBUNTU_FLAVOR} main universe\\n\" > /etc/apt/sources.list \\\n && echo \"deb http://archive.ubuntu.com/ubuntu ${UBUNTU_FLAVOR}-updates main universe\\n\" >> /etc/apt/sources.list \\\n && echo \"deb http://archive.ubuntu.com/ubuntu ${UBUNTU_FLAVOR}-security main universe\\n\" >> /etc/apt/sources.list\nMAINTAINER Diego Molina <diemol@gmail.com>\nMAINTAINER Leo Gallucci <elgalu3+dosel@gmail.com>\n#   https://github.com/docker/docker/pull/25466#discussion-diff-74622923R677\nLABEL maintainer=\"\\\"Diego Molina <diemol@gmail.com>\\\"\"\nLABEL maintainer=\"\\\"Leo Gallucci <elgalu3+dosel@gmail.com>\\\"\"\n#   No interactive frontend during docker build\nENV DEBIAN_FRONTEND=\"noninteractive\" \\\n    DEBCONF_NONINTERACTIVE_SEEN=\"true\"\n#   GPG servers aren't too reliable (especially in out test builds)\n#   so fallback servers are needed\n#    ref: https://github.com/nodejs/docker-node/issues/340#issuecomment-321669029\n#    ref: http://askubuntu.com/a/235911/134645\n#    ref: https://github.com/moby/moby/issues/20022#issuecomment-182169732\n#   How to remove keys? e.g. sudo apt-key del 2EA8F35793D8809A\nRUN set -ex \\\n && for key in 2EA8F35793D8809A 40976EAF437D05B5 3B4FE6ACC0B21F32 A2F683C52980AECF F76221572C52609D 58118E89F3A912897C070ADBF76221572C52609D; do gpg --keyserver keyserver.ubuntu.com --recv-keys \"$key\" || gpg --keyserver pgp.mit.edu --recv-keys \"$key\" || gpg --keyserver keyserver.pgp.com --recv-keys \"$key\" || gpg --keyserver ha.pool.sks-keyservers.net --recv-keys \"$key\" ; done\n#  ========================\n#   Miscellaneous packages\n#  ========================\n#   libltdl7        0.3 MB\n#     allows to run docker alongside docker\n#   netcat-openbsd  0.5 MB\n#     inlcues `nc` an arbitrary TCP and UDP connections and listens\n#   pwgen           0.4 MB\n#     generates random, meaningless but pronounceable passwords\n#   bc              0.5 MB\n#     An arbitrary precision calculator language\n#   unzip           0.7 MB\n#     uncompress zip files\n#   bzip2           1.29 MB\n#     uncompress bzip files\n#   apt-utils       1.0 MB\n#     commandline utilities related to package management with APT\n#   net-tools       0.8 MB\n#     arp, hostname, ifconfig, netstat, route, plipconfig, iptunnel\n#   jq              1.1 MB\n#     jq is like sed for JSON data, you can use it to slice and filter and map\n#   sudo            1.3 MB\n#     sudo binary\n#   psmisc          1.445 MB\n#     fuser – identifies what processes are using files.\n#     killall – kills a process by its name, similar to a pkill Unices.\n#     pstree – Shows currently running processes in a tree format.\n#     peekfd – Peek at file descriptors of running processes.\n#   iproute2        2.971 MB\n#     to use `ip` command\n#   iputils-ping    3.7 MB\n#     ping, ping6 - send ICMP ECHO_REQUEST to network hosts\n#   dbus-x11        4.6 MB\n#     is needed to avoid http://askubuntu.com/q/237893/134645\n#   wget            7.3 MB\n#     The non-interactive network downloader\n#   curl             17 MB (real +diff when with wget: 7 MB)\n#     transfer URL data using various Internet protocols\n#   ---------------------------------------------------------\n#   If we install them separately the total SUM() gives 39 MB\n#   If we install them together   the total SUM() gives 25 MB\n#   ---------------------------------------------------------\n#   Removed packages:\n#     telnet          5.2 MB\n#       for debugging firewall issues\n#     grc              33 MB !!\n#       is a terminal colorizer that works nice with tail https://github.com/garabik/grc\n#     moreutils        44 MB !!\n#       has `ts` that will prepend a timestamp to every line of input you give it\n#   Layer size: medium: 29.8 MB\n#   Layer size: medium: 27.9 MB (with --no-install-recommends)\nRUN apt-get update -qqy \\\n && apt-get install --no-install-recommends libltdl7 libhavege1 netcat-openbsd pwgen bc unzip bzip2 apt-utils net-tools jq sudo psmisc iproute2 iputils-ping dbus-x11 wget curl -qqy \\\n && apt-get -qyy autoremove \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#  ==============================\n#   Locale and encoding settings\n#  ==============================\n#   TODO: Allow to change instance language OS and Browser level\n#    see if this helps: https://github.com/rogaha/docker-desktop/blob/68d7ca9df47b98f3ba58184c951e49098024dc24/Dockerfile#L57\nENV LANG_WHICH=\"en\"\nENV LANG_WHERE=\"US\"\nENV ENCODING=\"UTF-8\"\nENV LANGUAGE=\"${LANG_WHICH}_${LANG_WHERE}.${ENCODING}\"\nENV LANG=\"${LANGUAGE}\"\n#   Layer size: small: ~9 MB\n#   Layer size: small: ~9 MB MB (with --no-install-recommends)\nRUN apt-get update -qqy \\\n && apt-get install --no-install-recommends language-pack-en tzdata locales -qqy \\\n && locale-gen ${LANGUAGE} \\\n && dpkg-reconfigure --frontend noninteractive locales \\\n && apt-get -qyy autoremove \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#  ===================\n#   Timezone settings\n#  ===================\n#   Full list at https://en.wikipedia.org/wiki/List_of_tz_database_time_zones\n#    e.g. \"US/Pacific\" for Los Angeles, California, USA\n#   e.g. ENV TZ \"US/Pacific\"\nENV TZ=\"Europe/Berlin\"\n#   Apply TimeZone\n#   Layer size: tiny: 1.339 MB\nRUN echo \"Setting time zone to '${TZ}'\" \\\n && echo \"${TZ}\" > /etc/timezone \\\n && dpkg-reconfigure --frontend noninteractive tzdata\n#  ========================================\n#   Add normal user with passwordless sudo\n#  ========================================\n#   Layer size: tiny: 0.3 MB\nRUN useradd seluser --shell /bin/bash --create-home \\\n && usermod -a -G sudo seluser \\\n && gpasswd -a seluser video \\\n && echo 'seluser:secret' | chpasswd \\\n && useradd extrauser --shell /bin/bash \\\n && usermod -a -G sudo extrauser \\\n && gpasswd -a extrauser video \\\n && gpasswd -a extrauser seluser \\\n && echo 'extrauser:secret' | chpasswd \\\n && echo 'ALL ALL = (ALL) NOPASSWD: ALL' >> /etc/sudoers\n#  ==============================\n#   Java8 - OpenJDK JRE headless\n#   Minimal runtime used for executing non GUI Java programs\n#  ==============================\n#   Regarding urandom see\n#    http://stackoverflow.com/q/26021181/511069\n#    https://github.com/SeleniumHQ/docker-selenium/issues/14#issuecomment-67414070\n#   Layer size: big: 132.2 MB\n#   Layer size: big: 132.2 MB (with --no-install-recommends)\nRUN apt-get update -qqy \\\n && apt-get install --no-install-recommends openjdk-8-jre-headless -qqy \\\n && sed -i 's/securerandom.source=file:\\/dev\\/urandom/securerandom.source=file:\\/dev\\/.\\/urandom/g' /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/security/java.security \\\n && sed -i 's/securerandom.source=file:\\/dev\\/random/securerandom.source=file:\\/dev\\/.\\/urandom/g' /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/security/java.security \\\n && apt-get -qyy autoremove \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#  ==================\n#   Java8 - Oracle\n#  ==================\n#   Regarding urandom see\n#    http://stackoverflow.com/q/26021181/511069\n#    https://github.com/SeleniumHQ/docker-selenium/issues/14#issuecomment-67414070\n#   Layer size: huge: 618.6 MB (with --no-install-recommends)\n#   Layer size: huge: 661.1 MB\n#   RUN apt-get -qqy update \\\n#     && apt-get -qqy --no-install-recommends install \\\n#       software-properties-common \\\n#     && echo debconf shared/accepted-oracle-license-v1-1 \\\n#         select true | debconf-set-selections \\\n#     && echo debconf shared/accepted-oracle-license-v1-1 \\\n#         seen true | debconf-set-selections \\\n#     && add-apt-repository ppa:webupd8team/java \\\n#     && apt-get -qqy update \\\n#     && apt-get -qqy install \\\n#       oracle-java8-installer \\\n#     && sed -i 's/securerandom.source=file:\\/dev\\/urandom/securerandom.source=file:\\/dev\\/.\\/urandom/g' \\\n#          /usr/lib/jvm/java-8-oracle/jre/lib/security/java.security \\\n#     && sed -i 's/securerandom.source=file:\\/dev\\/random/securerandom.source=file:\\/dev\\/.\\/urandom/g' \\\n#          /usr/lib/jvm/java-8-oracle/jre/lib/security/java.security \\\n#     && apt-get -qqy install \\\n#       oracle-java8-set-default \\\n#     && apt-get -qyy autoremove \\\n#     && rm -rf /var/lib/apt/lists/* \\\n#     && apt-get -qyy clean\n#  ==============================================\n#   Java blocks until kernel have enough entropy\n#   to generate the /dev/random seed\n#  ==============================================\n#   See: SeleniumHQ/docker-selenium/issues/14\n#   Layer size: tiny: 0.8 MB\nRUN apt-get update -qqy \\\n && apt-key update -qqy \\\n && apt-get install --no-install-recommends haveged rng-tools -qqy \\\n && service haveged start \\\n && update-rc.d haveged defaults \\\n && apt-get -qyy autoremove \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#  ===================================================\n#   Run the following commands as non-privileged user\n#  ===================================================\nUSER seluser\nWORKDIR /home/seluser\n#   Docker backward compatibility\nRUN echo \"${UBUNTU_FLAVOR}\" > UBUNTU_FLAVOR \\\n && echo \"${UBUNTU_DATE}\" > UBUNTU_DATE\n#  =================\n#   Selenium latest\n#  =================\n#   Layer size: medium ~22 MB\nARG SEL_DIRECTORY=\"3.14\"\nENV SEL_VER=\"3.141.59\"\nRUN wget -nv \"https://github.com/dosel/selenium/releases/download/selenium-3.141.59-patch-d47e74d6f2/selenium.jar\" \\\n && ln -s \"selenium.jar\" \"selenium-server-standalone-${SEL_VER}.jar\" \\\n && ln -s \"selenium.jar\" \"selenium-server-standalone-3.jar\"\n#   TODO: Enable this again when Selenium 4.0 is released\n#  RUN echo $SEL_VER\n#  RUN  export SELBASE=\"https://selenium-release.storage.googleapis.com\" \\\n#    && export SELPATH=\"${SEL_DIRECTORY}/selenium-server-standalone-${SEL_VER}.jar\" \\\n#    && wget -nv ${SELBASE}/${SELPATH} \\\n#    && ln -s \"selenium-server-standalone-${SEL_VER}.jar\" \\\n#             \"selenium-server-standalone-3.jar\"\nLABEL selenium_version=\"\\\"${SEL_VER}\\\"\"\n#  =============================\n#   sudo by default from now on\n#  =============================\nUSER root\n#  =========================================================\n#   Python2 for Supervisor, selenium tests, and other stuff\n#  =========================================================\n#   Layer size: big.: 79.39 MB (with --no-install-recommends)\n#   Layer size: huge: 296 MB\n#   RUN apt-get -qqy update \\\n#     && apt-get -qqy --no-install-recommends install \\\n#       python2.7 \\\n#       python-pip \\\n#       python-openssl \\\n#       libssl-dev \\\n#       libffi-dev \\\n#     && pip install --upgrade pip==9.0.3 \\\n#     && pip install --upgrade setuptools \\\n#     && rm -rf /var/lib/apt/lists/* \\\n#     && apt-get -qyy clean\n#  =========================================================\n#   Python3 for Supervisor, selenium tests, and other stuff\n#  =========================================================\n#   Note Python2 comes already installed with Oracle Java\n#    so better stick to it to avoid occupying more disk space\n#   Note Python3 fails installing mozInstall==1.12 with\n#    NameError: name 'file' is not defined\n#   After install, make some useful symlinks that are expected to exist\n#   Layer size: big.: 138.9 MB (with --no-install-recommends)\n#   Layer size: huge: 309.9 MB\nCOPY test/requirements.txt /test/\nRUN apt-get update -qqy \\\n && apt-get install --no-install-recommends python3 python3-pip python3-dev python3-openssl libssl-dev libffi-dev -qqy \\\n && pip3 install --no-cache --upgrade pip==9.0.3 \\\n && pip3 install --no-cache setuptools \\\n && pip3 install --no-cache numpy \\\n && pip3 install --no-cache --requirement /test/requirements.txt \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\nRUN cd /usr/local/bin \\\n && { [ -e easy_install ] || ln -s easy_install-* easy_install ; } \\\n && ln -s idle3 idle \\\n && ln -s pydoc3 pydoc \\\n && ln -s python3 python \\\n && ln -s python3-config python-config \\\n && ln -s /usr/bin/python3 /usr/bin/python \\\n && python --version \\\n && pip --version\n#  ====================\n#   Supervisor install\n#  ====================\n#   TODO: Upgrade to supervisor stable 4.0 as soon as is released\n#   Check every now and then if version 4 is finally the stable one\n#    https://pypi.python.org/pypi/supervisor\n#    https://github.com/Supervisor/supervisor\n#   RUN apt-get -qqy update \\\n#     && apt-get -qqy install \\\n#       supervisor \\\n#   2018-09-28 commit: 837c159ae51f3b, supervisor/version.txt: 4.0.0.dev0\n#   2018-06-01 commit: ec495be4e28c69, supervisor/version.txt: 4.0.0.dev0\n#   2017-10-21 commit: 3f04badc3237f0, supervisor/version.txt: 4.0.0.dev0\n#   2017-05-30 commit: 946d9cf3be4db3, supervisor/version.txt: 4.0.0.dev0\nENV RUN_DIR=\"/var/run/sele\"\nRUN SHA=\"837c159ae51f3bf12c1d30a8cb44f3450611983c\" \\\n && pip install \"https://github.com/Supervisor/supervisor/zipball/${SHA}\" --no-cache || pip install \"https://github.com/Supervisor/supervisor/zipball/${SHA}\" --no-cache \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#  ================\n#   Font libraries\n#  ================\n#   libfontconfig            ~1 MB\n#   libfreetype6             ~1 MB\n#   xfonts-cyrillic          ~2 MB\n#   xfonts-scalable          ~2 MB\n#   fonts-liberation         ~3 MB\n#   fonts-ipafont-gothic     ~13 MB\n#   fonts-wqy-zenhei         ~17 MB\n#   ttf-ubuntu-font-family   ~5 MB\n#     Ubuntu Font Family, sans-serif typeface hinted for clarity\n#   Removed packages:\n#   xfonts-100dpi            ~6 MB\n#   xfonts-75dpi             ~6 MB\n#   Regarding fonts-liberation see:\n#    https://github.com/SeleniumHQ/docker-selenium/issues/383#issuecomment-278367069\n#   Layer size: small: 36.28 MB (with --no-install-recommends)\n#   Layer size: small: 36.28 MB\nRUN apt-get update -qqy \\\n && apt-get install --no-install-recommends libfontconfig libfreetype6 xfonts-cyrillic xfonts-scalable fonts-liberation fonts-ipafont-gothic fonts-wqy-zenhei ttf-ubuntu-font-family -qqy \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#  =========\n#   Openbox\n#   A lightweight window manager using freedesktop standards\n#  =========\n#   Let's disable this as is only filling disk space\n#   Layer size: huge: 153.4 MB (with --no-install-recommends)\n#   Layer size: huge: 224.4 MB\n#   RUN apt-get -qqy update \\\n#     && apt-get -qqy --no-install-recommends install \\\n#       openbox obconf menu \\\n#     && rm -rf /var/lib/apt/lists/* \\\n#     && apt-get -qyy clean\n#  =========\n#   fluxbox\n#   A fast, lightweight and responsive window manager\n#  =========\n#   xfce4-notifyd adds 5mb but allows `notify-send` notifications\n#   Layer size: small: 9.659 MB\n#   Layer size: small: 6.592 MB (with --no-install-recommends)\nRUN apt-get update -qqy \\\n && apt-get install --no-install-recommends fluxbox xfce4-notifyd -qqy \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#  ============================\n#   Xvfb X virtual framebuffer\n#  ============================\n#   xvfb: Xvfb or X virtual framebuffer is a display server\n#    + implements the X11 display server protocol\n#    + performs all graphical operations in memory\n#   Packages that used to be together in this layer\n#     xvfb                      75.69 MB  no-recommends: 68.2 MB\n#     xorg                      160.3 MB  no-recommends: 134.6 MB\n#     xserver-xorg-video-dummy  116.7 MB  no-recommends: 90.52 MB\n#   Layer size: big: 136.9 MB (with --no-install-recommends)\n#   Layer size: big: 162.6 MB\nRUN apt-get update -qqy \\\n && apt-get install --no-install-recommends xvfb xorg -qqy \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#  ============\n#   VNC Server\n#  ============\n#   Layer size: medium: 12.67 MB\n#   Layer size: medium: 10.08 MB (with --no-install-recommends)\nRUN apt-get update -qqy \\\n && apt-get install --no-install-recommends x11vnc -qqy \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#  ===================================================\n#   Run the following commands as non-privileged user\n#  ===================================================\nUSER seluser\n#  #######################################\n#   noVNC to expose VNC via an html page #\n#  #######################################\n#   Download elgalu/noVNC dated 2016-11-18 commit 9223e8f2d1c207fb74cb4b8cc243e59d84f9e2f6\n#   Download kanaka/noVNC dated 2016-11-10 commit 80b7dde665cac937aa0929d2b75aa482fc0e10ad\n#   Download kanaka/noVNC dated 2016-02-24 commit b403cb92fb8de82d04f305b4f14fa978003890d7\n#   Download kanaka/websockify dated 2016-10-10 commit cb1508fa495bea4b333173705772c1997559ae4b\n#   Download kanaka/websockify dated 2015-06-02 commit 558a6439f14b0d85a31145541745e25c255d576b\n#   Layer size: small: 2.919 MB\nENV NOVNC_SHA=\"9223e8f2d1c207fb74cb4b8cc243e59d84f9e2f6\" \\\n    WEBSOCKIFY_SHA=\"cb1508fa495bea4b333173705772c1997559ae4b\"\nRUN wget -nv -O noVNC.zip \"https://github.com/elgalu/noVNC/archive/${NOVNC_SHA}.zip\" \\\n && unzip -x noVNC.zip \\\n && mv noVNC-${NOVNC_SHA} noVNC \\\n && rm noVNC.zip \\\n && wget -nv -O websockify.zip \"https://github.com/kanaka/websockify/archive/${WEBSOCKIFY_SHA}.zip\" \\\n && unzip -x websockify.zip \\\n && rm websockify.zip \\\n && mv websockify-${WEBSOCKIFY_SHA} ./noVNC/utils/websockify\n#  =============================\n#   sudo by default from now on\n#  =============================\nUSER root\n#  =========================\n#   Browser video libraries\n#  =========================\n#   gstreamer (gstreamer1.0-libav)\n#     for mp4 & html5 video browser support: https://www.youtube.com/html5\n#   TODO: Add test to see what the browser supports by opening\n#         https://www.youtube.com/html5\n#   Layer size: big: 149.9 MB\n#   Layer size: big: 135.4 MB (with --no-install-recommends)\nRUN apt-get update -qqy \\\n && apt-get install --no-install-recommends gstreamer1.0-libav -qqy \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#  =================================================\n#   ffmpeg/libav/avconv video codecs & dependencies\n#  =================================================\n#   MP4Box (gpac) to clean the video credits to @taskworld @dtinth\n#   ponchio/untrunc dependencies to restore a damaged (truncated) video\n#     libavformat-dev libavcodec-dev libavutil-dev libqt4-dev make g++ libz-dev\n#   Layer size: medium: ~12 MB (with --no-install-recommends)\n#   Layer size: medium: ~21 MB\n#   RUN apt-get -qqy update \\\n#     && apt-get -qqy --no-install-recommends install \\\n#       libx264-dev \\\n#       libvorbis-dev \\\n#       libx11-dev \\\n#       gpac \\\n#     && rm -rf /var/lib/apt/lists/* \\\n#     && apt-get -qyy clean\n#  ========\n#   ffmpeg\n#  ========\n#   MP4Box (gpac) to clean the video credits to @taskworld @dtinth\n#   ffmpeg (ffmpeg): Is a better alternative to Pyvnc2swf\n#     (use in Ubuntu >= 15) packages: ffmpeg\n#   Layer size: medium: ~12 MB (with --no-install-recommends)\n#   Layer size: medium: ~17 MB\nRUN apt-get update -qqy \\\n && apt-get install --no-install-recommends ffmpeg gpac -qqy \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#  ==============\n#   libav/avconv\n#  ==============\n#   Layer size: medium: 11.58 MB (with --no-install-recommends)\n#   Layer size: medium: 16.75 MB\n#   libav-tools (avconv): a fork of ffmpeg\n#     a better alternative to Pyvnc2swf\n#     (use in Ubuntu <= 14) packages: libav-tools libx264-142\nRUN apt-get update -qqy \\\n && apt-get install --no-install-recommends libav-tools -qqy \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#   ------------------------#\n#   Sauce Connect Tunneling #\n#   ------------------------#\n#   Please use https://github.com/zalando/zalenium\n#   -----------------------#\n#   BrowserStack Tunneling #\n#   -----------------------#\n#   Please use https://github.com/zalando/zalenium\n#  -----------------#\n#   Mozilla\n#\n#  -----------------#\n#   Install all Firefox dependencies\n#   Layer size: big: 83.51 MB\n#   Adding libasound2 and others, credits to @jackTheRipper\n#    https://github.com/SeleniumHQ/docker-selenium/pull/418\n#   libasound2 \\\n#   libpulse-dev \\\n#   xul-ext-ubufox \\\nRUN apt-get update -qqy \\\n && apt-get install --no-install-recommends `apt-cache depends firefox | awk '/Depends:/{print$2}' ` -qqy \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#  ===================================================\n#   Run the following commands as non-privileged user\n#  ===================================================\nUSER seluser\n#  --- Nightly\n#   ENV FF_VER=\"52.0a0\" \\\n#       FF_PLATFORM=\"linux-i686\" \\\n#       FF_INNER_PATH=\"firefox/nightly/latest-mozilla-central\"\n#   ENV FF_COMP=\"firefox-${FF_VER}.${FF_LANG}.${FF_PLATFORM}.tar.bz2\"\n#   ENV FF_URL=\"${FF_BASE_URL}/${FF_INNER_PATH}/${FF_COMP}\"\n#\n#   Where to find latest version:\n#    https://archive.mozilla.org/pub/mozilla.org/firefox/releases/latest/linux-x86_64/en-US/\n#    https://download-installer.cdn.mozilla.net/pub/mozilla.org/firefox/releases/latest/linux-x86_64/en-US/\n#    https://ftp.mozilla.org/pub/mozilla.org/firefox/releases/latest/linux-x86_64/en-US/\n#   e.g. 44.0 instead of latest\n#    https://archive.mozilla.org/pub/firefox/releases/44.0/linux-x86_64/en-US/firefox-44.0.tar.bz2\n#   FF_LANG can be either en-US // de // fr and so on\n#   Regarding the pip packages, see released versions at:\n#    https://github.com/mozilla/mozdownload/releases\n#  =============================\n#   sudo by default from now on\n#  =============================\nUSER root\nENV FF_LANG=\"en-US\" \\\n    FF_BASE_URL=\"https://archive.mozilla.org/pub\" \\\n    FF_PLATFORM=\"linux-x86_64\" \\\n    FF_INNER_PATH=\"firefox/releases\"\n#  --- For Selenium 3\n#   Layer size: big: 108.2 MB\nARG FF_VER=\"67.0\"\nENV FF_COMP=\"firefox-${FF_VER}.tar.bz2\"\nENV FF_URL=\"${FF_BASE_URL}/${FF_INNER_PATH}/${FF_VER}/${FF_PLATFORM}/${FF_LANG}/${FF_COMP}\"\nRUN cd /opt \\\n && wget -nv \"${FF_URL}\" -O \"firefox.tar.bz2\" \\\n && bzip2 -d \"firefox.tar.bz2\" \\\n && tar xf \"firefox.tar\" \\\n && rm \"firefox.tar\" \\\n && ln -fs /opt/firefox/firefox /usr/bin/firefox \\\n && chown -R seluser:seluser /opt/firefox \\\n && chmod -R 777 /opt/firefox\nLABEL selenium_firefox_version=\"\\\"${FF_VER}\\\"\"\n#  ============\n#   GeckoDriver\n#  ============\n#   Layer size: tiny: ~4 MB\nARG GECKOD_VER=\"0.24.0\"\nENV GECKOD_URL=\"https://github.com/mozilla/geckodriver/releases/download\"\nRUN wget --no-verbose -O geckodriver.tar.gz \"${GECKOD_URL}/v${GECKOD_VER}/geckodriver-v${GECKOD_VER}-linux64.tar.gz\" \\\n && rm -rf /opt/geckodriver* \\\n && tar -C /opt -xvzf geckodriver.tar.gz \\\n && chmod +x /opt/geckodriver \\\n && cp /opt/geckodriver /usr/bin/geckodriver \\\n && chown seluser:seluser /opt/geckodriver \\\n && chown seluser:seluser /usr/bin/geckodriver \\\n && rm geckodriver.tar.gz\nCOPY bin/fail /usr/bin/\n#  ===============\n#   Google Chrome\n#  ===============\n#   TODO: Use Google fingerprint to verify downloads\n#    https://www.google.de/linuxrepositories/\nARG EXPECTED_CHROME_VERSION=\"75.0.3770.80\"\nENV CHROME_URL=\"https://dl.google.com/linux/direct\" \\\n    CHROME_BASE_DEB_PATH=\"/home/seluser/chrome-deb/google-chrome\" \\\n    GREP_ONLY_NUMS_VER=\"[0-9.]{2,20}\"\nLABEL selenium_chrome_version=\"\\\"${EXPECTED_CHROME_VERSION}\\\"\"\n#   Layer size: huge: 196.3 MB\nRUN apt-get update -qqy \\\n && mkdir -p chrome-deb \\\n && wget -nv \"${CHROME_URL}/google-chrome-stable_current_amd64.deb\" -O \"./chrome-deb/google-chrome-stable_current_amd64.deb\" \\\n && apt-get install --no-install-recommends \"${CHROME_BASE_DEB_PATH}-stable_current_amd64.deb\" -qyy \\\n && rm \"${CHROME_BASE_DEB_PATH}-stable_current_amd64.deb\" \\\n && rm -rf ./chrome-deb \\\n && apt-get -qyy autoremove \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean \\\n && export CH_STABLE_VER=$( /usr/bin/google-chrome-stable --version | grep -iEo \"${GREP_ONLY_NUMS_VER}\" ;) \\\n && echo \"CH_STABLE_VER:'${CH_STABLE_VER}' vs EXPECTED_CHROME_VERSION:'${EXPECTED_CHROME_VERSION}'\" \\\n && [ \"${CH_STABLE_VER}\" = \"${EXPECTED_CHROME_VERSION}\" ] || fail\n#   We have a wrapper for /opt/google/chrome/google-chrome\nRUN mv /opt/google/chrome/google-chrome /opt/google/chrome/google-chrome-base\nCOPY selenium-node-chrome/opt /opt\nCOPY lib/* /usr/lib/\n#   Use a custom wallpaper for Fluxbox\nCOPY images/wallpaper-dosel.png /usr/share/images/fluxbox/ubuntu-light.png\nCOPY images/wallpaper-zalenium.png /usr/share/images/fluxbox/\nRUN chown -R seluser:seluser /usr/share/images/fluxbox/ \\\n && chmod -R 777 /usr/share/images/fluxbox\n#  ===================================================\n#   Run the following commands as non-privileged user\n#  ===================================================\nUSER seluser\n#  ==================\n#   Chrome webdriver\n#  ==================\n#   How to get cpu arch dynamically: $(lscpu | grep Architecture | sed \"s/^.*_//\")\nARG CHROME_DRIVER_VERSION=\"75.0.3770.8\"\nENV CHROME_DRIVER_BASE=\"chromedriver.storage.googleapis.com\" \\\n    CPU_ARCH=\"64\"\nENV CHROME_DRIVER_FILE=\"chromedriver_linux${CPU_ARCH}.zip\"\nENV CHROME_DRIVER_URL=\"https://${CHROME_DRIVER_BASE}/${CHROME_DRIVER_VERSION}/${CHROME_DRIVER_FILE}\"\n#   Gets latest chrome driver version. Or you can hard-code it, e.g. 2.15\n#   Layer size: small: 6.932 MB\nRUN wget -nv -O chromedriver_linux${CPU_ARCH}.zip ${CHROME_DRIVER_URL} \\\n && unzip chromedriver_linux${CPU_ARCH}.zip \\\n && rm chromedriver_linux${CPU_ARCH}.zip \\\n && mv chromedriver chromedriver-${CHROME_DRIVER_VERSION} \\\n && chmod 755 chromedriver-${CHROME_DRIVER_VERSION} \\\n && ln -s chromedriver-${CHROME_DRIVER_VERSION} chromedriver \\\n && sudo ln -s /home/seluser/chromedriver /usr/bin\n#  =================\n#   Supervisor conf\n#  =================\nCOPY supervisor/etc/supervisor/supervisord.conf /etc/supervisor/\nCOPY **/etc/supervisor/conf.d/* /etc/supervisor/conf.d/\n#  ===================\n#   DNS & hosts stuff\n#  ===================\nCOPY ./dns/etc/hosts /tmp/hosts\n#  ======\n#   Envs\n#  ======\nENV DEFAULT_SELENIUM_HUB_PORT=\"24444\" \\\n    DEFAULT_SELENIUM_NODE_CH_PORT=\"25550\" \\\n    DEFAULT_SELENIUM_NODE_FF_PORT=\"25551\" \\\n    DEFAULT_SELENIUM_MULTINODE_PORT=\"25552\" \\\n    DEFAULT_VNC_PORT=\"25900\" \\\n    DEFAULT_NOVNC_PORT=\"26080\" \\\n    DEFAULT_SUPERVISOR_HTTP_PORT=\"19001\"\n#   Commented for now; all these versions are still available at\n#     https://github.com/elgalu/docker-selenium/releases/tag/2.47.1m\n#   CHROME_FLAVOR \"stable\"\n#     Default chrome flavor, options no longer available: beta|unstable\n#   PICK_ALL_RANDOM_PORTS \"true\" / \"false\"\n#     Randomize all ports, i.e. pick unused unprivileged ones\n#   RANDOM_PORT_FROM\n#   RANDOM_PORT_TO\n#     When using PICK_ALL_RANDOM_PORTS=true the ports will\n#     be from a range to avoid collisions\n#   MEM_JAVA_PERCENT \"80\"\n#     Because the JVM uses only 1/4 of system memory by default\n#   WAIT_FOREGROUND_RETRY\n#   WAIT_VNC_FOREGROUND_RETRY\n#     Max amount of time to wait on Xvfb or Xmanager while retrying\n#   XVFB_STARTRETRIES\n#   XMANAGER\n#     We used to support 2 X managers: fluxbox | openbox\n#     But after version 3.0.1 we only support fluxbox\n#     to save disk space\n#   XMANAGER_STARTRETRIES\n#   XMANAGER_STARTSECS\n#     Supervisor processes retry attemps (0 means do not retry)\n#   WAIT_TIMEOUT\n#     Max amount of time to wait for other processes dependencies\n#   DISP_N\n#     Display number; see entry.sh for $DISPLAY\n#   MAX_DISPLAY_SEARCH\n#     Maximum searches for a free DISPLAY number\n#   SELENIUM_HUB_PORT\n#     Even though you can change them below, don't worry too much about container\n#     internal ports since you can map them to the host via `docker run -p`\n#   SELENIUM_HUB_PROTO\n#   SELENIUM_HUB_HOST\n#   SELENIUM_NODE_HOST\n#     You may want to connect to another hub\n#   SELENIUM_HUB_PARAMS\n#   SELENIUM_NODE_PARAMS\n#   SELENIUM_NODE_PROXY_PARAMS\n#     Selenium additional params:\n#   CHROME_ARGS\n#     \"--no-sandbox --disable-gpu\" To taggle issue #58 see https://goo.gl/fz6RTu\n#     more: \"--ignore-certificate-errors\"\n#   CHROME_VERBOSELOGGING\n#     Will be passed with: -Dwebdriver.chrome.verboseLogging\n#       SELENIUM_NODE_CHROME_PARAMS='-Dselenium.chrome.args=\"--no-sandbox\"' \\\n#       WEBDRIVER_NODE_CHROME_PARAMS='-Dwebdriver.chrome.args=\"--no-sandbox\"' \\\n#       Selenium capabilities descriptive (to avoid opera/ie warnings)\n#        docs at https://code.google.com/p/selenium/wiki/Grid2\n#   SEL_RELEASE_TIMEOUT_SECS\n#     -timeout AKA GRID_TIMEOUT TODO fix with, ping @allanatadministrate\n#     https://github.com/SeleniumHQ/docker-selenium/pull/393\n#   SEL_BROWSER_TIMEOUT_SECS\n#   SELENIUM_NODE_REGISTER_CYCLE\n#     How often in ms the node will try to register itself again.\n#     Allow to restart the hub without having to restart the nodes.\n#      (node) in ms. Selenium default: 5000\n#   SEL_CLEANUPCYCLE_MS\n#     How often a proxy will check for timed out thread.\n#      (node) in ms. Selenium default: 5000\n#   SEL_NODEPOLLING_MS\n#     Interval between alive checks of node how often the hub checks if the node is still alive.\n#      (node) in ms. Selenium default: 5000\n#   SEL_UNREGISTER_IF_STILL_DOWN_AFTER\n#     If the node remains down for more than unregisterIfStillDownAfter millisec\n#      it will disappear from the hub. in ms. Default: 1min\n#   no_proxy\n#   HUB_ENV_no_proxy\n#     Docker for Mac beta - containers do not start #227\n#   VNC_FROM_PORT\n#   VNC_TO_PORT\n#     We need a fixed port range to expose VNC due to a bug in Docker for Mac beta (1.12)\n#     https://forums.docker.com/t/docker-for-mac-beta-not-forwarding-ports/8658/6\n#   VNC_CLI_OPTS\n#     e.g. VNC_CLI_OPTS=\"-noipv6 -no6 -forever -shared\"\n#     e.g. VNC_CLI_OPTS=\"-forever -shared\"\n#   VNC_PASSWORD\n#     - \"no\" means no password; less secure but not a big deal\n#     - \"\" (empty string) means it will be randomly generated\n#     - \"some-value\" will use that password \"some-value\" or whatever\n#   LOG_LEVEL\n#     Supervisor loglevel and also general docker log level\n#     can be: debug, warn, trace, info\n#   DISABLE_ROLLBACK\n#     When DISABLE_ROLLBACK=true it will:\n#      - output logs\n#      - exec bash to permit troubleshooting\n#   LOGS_DIR\n#     Logs are now managed by supervisord.conf, see\n#      ${LOGS_DIR}/*.log\n#   FFMPEG_FRAME_RATE\n#     ffmpeg encoding options\n#   FFMPEG_CODEC_ARGS\n#     Video size can be lowered down via re-encoding, see\n#      http://askubuntu.com/a/365221/134645\n#   FFMPEG_DRAW_MOUSE\n#      Specify whether to draw the mouse pointer. Default: 1\n#   VIDEO GRID CHROME FIREFOX RC_CHROME RC_FIREFOX\n#     true/false which services should start upon docker run\n#   VIDEO_FILE_EXTENSION\n#     Video file and extension, e.g. mp4, mkv\n#   TAIL_LOG_LINES\n#     Amount of lines to display when startup errors\n#   SHM_TRY_MOUNT_UNMOUNT\n#     Fix small tiny 64mb shm issue\n#   ETHERNET_DEVICE_NAME\n#     When docker run --net=host the network name may be different\n#   XMANAGER_STOP_SIGNAL\n#   XVFB_STOP_SIGNAL\n#   XTERM_START\n#    Wheather to start an xterm in the windows manager. For debugging.\n#   XTERM_STOP_SIGNAL\n#   SELENIUM_NODE_FIREFOX_STOP_SIGNAL\n#   SELENIUM_NODE_CHROME_STOP_SIGNAL\n#   SELENIUM_MULTINODE_STOP_SIGNAL\n#   SELENIUM_HUB_STOP_SIGNAL\n#   VNC_STOP_SIGNAL\n#   NOVNC_STOP_SIGNAL\n#   VIDEO_REC_STOP_SIGNAL\n#   DOCKER_SOCK\n#     Run docker from inside docker\n#     Usage: docker run -v /var/run/docker.sock:/var/run/docker.sock\n#                       -v $(which docker):/usr/bin/docker\n#   TEST_SLEEPS\n#     Used internally due to flaky tests, should be removed in the future\n#   SEND_ANONYMOUS_USAGE_INFO\n#   GA_TRACKING_ID\n#   GA_ENDPOINT\n#   GA_API_VERSION\n#     All Google Analytics related, see LICENSE.md & Analytics.md for more info\n# A secret has been removed here. Please do not provide secrets from the Dockerfile as these will leak into the metadata of the resulting docker image. To provide secrets the --secret flag of the docker build command can be used (https://docs.docker.com/develop/develop-images/build_enhancements/#new-docker-build-secret-information).\nENV FIREFOX_VERSION=\"${FF_VER}\" \\\n    USE_SELENIUM=\"3\" \\\n    CHROME_FLAVOR=\"stable\" \\\n    DEBUG=\"false\" \\\n    PICK_ALL_RANDOM_PORTS=\"false\" \\\n    RANDOM_PORT_FROM=\"23100\" \\\n    RANDOM_PORT_TO=\"29999\" \\\n    USER=\"seluser\" \\\n    HOME=\"/home/seluser\" \\\n    VNC_STORE_PWD_FILE=\"/home/seluser/.vnc/passwd\" \\\n    BIN_UTILS=\"/usr/bin\" \\\n    MEM_JAVA_PERCENT=\"80\" \\\n    WAIT_FOREGROUND_RETRY=\"2s\" \\\n    WAIT_VNC_FOREGROUND_RETRY=\"6s\" \\\n    XVFB_STARTRETRIES=\"0\" \\\n    XMANAGER_STARTSECS=\"2\" \\\n    XMANAGER_STARTRETRIES=\"3\" \\\n    WAIT_TIMEOUT=\"45s\" \\\n    SCREEN_WIDTH=\"1900\" \\\n    SCREEN_HEIGHT=\"1880\" \\\n    SCREEN_MAIN_DEPTH=\"24\" \\\n    SCREEN_SUB_DEPTH=\"32\" \\\n    DISP_N=\"-1\" \\\n    MAX_DISPLAY_SEARCH=\"99\" \\\n    SCREEN_NUM=\"0\" \\\n    SELENIUM_HUB_PORT=\"${DEFAULT_SELENIUM_HUB_PORT}\" \\\n    SELENIUM_HUB_PROTO=\"http\" \\\n    SELENIUM_HUB_HOST=\"127.0.0.1\" \\\n    SELENIUM_NODE_HOST=\"0.0.0.0\" \\\n    SELENIUM_NODE_CH_PORT=\"${DEFAULT_SELENIUM_NODE_CH_PORT}\" \\\n    SELENIUM_NODE_FF_PORT=\"${DEFAULT_SELENIUM_NODE_FF_PORT}\" \\\n    SELENIUM_MULTINODE_PORT=\"${DEFAULT_SELENIUM_MULTINODE_PORT}\" \\\n    SELENIUM_HUB_PARAMS=\"\" \\\n    SELENIUM_NODE_PARAMS=\"\" \\\n    SELENIUM_NODE_PROXY_PARAMS=\"\" \\\n    CHROME_ARGS=\"--no-sandbox --disable-setuid-sandbox --disable-gpu --disable-infobars\" \\\n    CHROME_ADDITIONAL_ARGS=\"\" \\\n    CHROME_VERBOSELOGGING=\"true\" \\\n    MAX_INSTANCES=\"1\" \\\n    MAX_SESSIONS=\"1\" \\\n    SEL_RELEASE_TIMEOUT_SECS=\"19000\" \\\n    SEL_BROWSER_TIMEOUT_SECS=\"16000\" \\\n    SELENIUM_NODE_REGISTER_CYCLE=\"5000\" \\\n    SEL_CLEANUPCYCLE_MS=\"5000\" \\\n    SEL_NODEPOLLING_MS=\"5000\" \\\n    SEL_UNREGISTER_IF_STILL_DOWN_AFTER=\"2500\" \\\n    no_proxy=\"localhost\" \\\n    HUB_ENV_no_proxy=\"localhost\" \\\n    XVFB_CLI_OPTS_TCP=\"-nolisten tcp -nolisten inet6\" \\\n    XVFB_CLI_OPTS_BASE=\"-ac -r -cc 4 -accessx -xinerama\" \\\n    XVFB_CLI_OPTS_EXT=\"+extension Composite +extension RANDR +extension GLX\" \\\n    VNC_START=\"true\" \\\n    VNC_PORT=\"${DEFAULT_VNC_PORT}\" \\\n    VNC_FROM_PORT=\"\" \\\n    VNC_TO_PORT=\"\" \\\n    VNC_CLI_OPTS=\"-forever -shared\" \\\n    NOVNC_PORT=\"${DEFAULT_NOVNC_PORT}\" \\\n    NOVNC=\"false\" \\\n    NOVNC_WAIT_TIMEOUT=\"5s\" \\\n    SUPERVISOR_HTTP_PORT=\"${DEFAULT_SUPERVISOR_HTTP_PORT}\" \\\n    SUPERVISOR_HTTP_USERNAME=\"supervisorweb\" \\\n    SUPERVISOR_REQUIRED_SRV_LIST=\"xmanager\" \\\n    SUPERVISOR_NOT_REQUIRED_SRV_LIST1=\"ignoreMe\" \\\n    SUPERVISOR_NOT_REQUIRED_SRV_LIST2=\"ignoreMe\" \\\n    SLEEP_SECS_AFTER_KILLING_SUPERVISORD=\"3\" \\\n    SUPERVISOR_STOPWAITSECS=\"20\" \\\n    SUPERVISOR_STOPSIGNAL=\"TERM\" \\\n    SUPERVISOR_KILLASGROUP=\"false\" \\\n    SUPERVISOR_STOPASGROUP=\"false\" \\\n    LOG_LEVEL=\"info\" \\\n    DISABLE_ROLLBACK=\"false\" \\\n    LOGFILE_MAXBYTES=\"10MB\" \\\n    LOGFILE_BACKUPS=\"5\" \\\n    LOGS_DIR=\"/var/log/cont\" \\\n    VIDEO=\"false\" \\\n    GRID=\"true\" \\\n    CHROME=\"true\" \\\n    FIREFOX=\"true\" \\\n    MULTINODE=\"false\" \\\n    FFMPEG_FRAME_RATE=\"10\" \\\n    FFMPEG_CODEC_ARGS=\"-vcodec libx264 -preset ultrafast -pix_fmt yuv420p\" \\\n    FFMPEG_FINAL_CRF=\"0\" \\\n    FFMPEG_DRAW_MOUSE=\"1\" \\\n    VIDEO_TMP_FILE_EXTENSION=\"mkv\" \\\n    VIDEO_FILE_EXTENSION=\"mp4\" \\\n    MP4_INTERLEAVES_MEDIA_DATA_CHUNKS_SECS=\"500\" \\\n    VIDEO_FILE_NAME=\"\" \\\n    VIDEO_BEFORE_STOP_SLEEP_SECS=\"1\" \\\n    VIDEO_AFTER_STOP_SLEEP_SECS=\"0.5\" \\\n    VIDEO_STOPWAITSECS=\"50\" \\\n    VIDEO_CONVERSION_MAX_WAIT=\"20s\" \\\n    VIDEO_MP4_FIX_MAX_WAIT=\"8s\" \\\n    VIDEO_WAIT_VID_TOOL_PID_1st_sig_UP_TO_SECS=\"6s\" \\\n    VIDEO_WAIT_VID_TOOL_PID_2nd_sig_UP_TO_SECS=\"2s\" \\\n    VIDEO_WAIT_VID_TOOL_PID_3rd_sig_UP_TO_SECS=\"1s\" \\\n    VIDEO_STOP_1st_sig_TYPE=\"SIGTERM\" \\\n    VIDEO_STOP_2nd_sig_TYPE=\"SIGINT\" \\\n    VIDEO_STOP_3rd_sig_TYPE=\"SIGKILL\" \\\n    WAIT_TIME_OUT_VIDEO_STOP=\"20s\" \\\n    VIDEOS_DIR=\"/home/seluser/videos\" \\\n    XMANAGER=\"fluxbox\" \\\n    FLUXBOX_START_MAX_RETRIES=\"5\" \\\n    TAIL_LOG_LINES=\"50\" \\\n    SHM_TRY_MOUNT_UNMOUNT=\"false\" \\\n    SHM_SIZE=\"512M\" \\\n    ETHERNET_DEVICE_NAME=\"eth0\" \\\n    XMANAGER_STOP_SIGNAL=\"TERM\" \\\n    XVFB_STOP_SIGNAL=\"TERM\" \\\n    XTERM_START=\"false\" \\\n    XTERM_STOP_SIGNAL=\"INT\" \\\n    SELENIUM_NODE_FIREFOX_STOP_SIGNAL=\"TERM\" \\\n    SELENIUM_NODE_CHROME_STOP_SIGNAL=\"TERM\" \\\n    SELENIUM_MULTINODE_STOP_SIGNAL=\"TERM\" \\\n    SELENIUM_HUB_STOP_SIGNAL=\"TERM\" \\\n    VNC_STOP_SIGNAL=\"TERM\" \\\n    NOVNC_STOP_SIGNAL=\"TERM\" \\\n    VIDEO_REC_STOP_SIGNAL=\"INT\" \\\n    DOCKER_SOCK=\"/var/run/docker.sock\" \\\n    TEST_SLEEPS=\"0.1\" \\\n    ZALENIUM=\"false\" \\\n    SEND_ANONYMOUS_USAGE_INFO=\"true\" \\\n    GA_TRACKING_ID=\"UA-18144954-9\" \\\n    GA_ENDPOINT=\"https://www.google-analytics.com/collect\" \\\n    GA_API_VERSION=\"1\" \\\n    LD_LIBRARY_PATH=\"/usr/lib/x86_64-linux-gnu/\" \\\n    DEBIAN_FRONTEND=\"\" \\\n    USE_KUBERNETES=\"false\" \\\n    REMOVE_SELUSER_FROM_SUDOERS_FOR_TESTING=\"false\" \\\n    DEBCONF_NONINTERACTIVE_SEEN=\"\"\n#  ================================\n#   Expose Container's Directories\n#  ================================\n#   VOLUME ${LOGS_DIR}\n#   Removed HEALTHCHECK because is providing no value to us but\n#   rather problems. When Zalenium starts N containers at the some time\n#   the --interval will make docker check the health of all of them\n#   at the same time and this causes an unnecessary CPU overhead.\n#   HEALTHCHECK --interval=2m --timeout=50s --retries=2 \\\n#     CMD wait_all_done 30s\n#  ================\n#   Binary scripts\n#  ================\nCOPY bin/* ${BIN_UTILS}/\nCOPY **/bin/* ${BIN_UTILS}/\nCOPY host-scripts/* /host-scripts/\nCOPY test/* /test/\nCOPY test/run_test.sh /usr/bin/run_test\nCOPY test/selenium_test.sh /usr/bin/selenium_test\nCOPY test/python_test.py /usr/bin/python_test\nCOPY images ./images\nCOPY LICENSE.md /home/seluser/\nCOPY Analytics.md /home/seluser/\n#   Include current version\nCOPY GLOBAL_PATCH_LEVEL.txt /home/seluser/\nRUN echo \"${SEL_VER}-$( cat GLOBAL_PATCH_LEVEL.txt ;)\" > /home/seluser/VERSION\n#   Moved from entry.sh\nENV SUPERVISOR_PIDFILE=\"${RUN_DIR}/supervisord.pid\" \\\n    DOCKER_SELENIUM_STATUS=\"${LOGS_DIR}/docker-selenium-status.log\" \\\n    VNC_TRYOUT_ERR_LOG=\"${LOGS_DIR}/vnc-tryouts-stderr\" \\\n    VNC_TRYOUT_OUT_LOG=\"${LOGS_DIR}/vnc-tryouts-stdout\"\n#  ===================================\n#   Fix dirs (again) and final chores\n#  ===================================\n#   The .X11-unix stuff is useful when using Xephyr\nRUN mkdir -p /home/seluser/.vnc \\\n && sudo touch /capabilities.json \\\n && sudo chown seluser:seluser /capabilities.json \\\n && generate_capabilities_json > /capabilities.json \\\n && cp /capabilities.json /home/seluser/capabilities.json \\\n && cp /capabilities.json /home/seluser/capabilities \\\n && cp /capabilities.json /home/seluser/caps.json \\\n && cp /capabilities.json /home/seluser/caps \\\n && mkdir -p ${VIDEOS_DIR} \\\n && sudo ln -s ${VIDEOS_DIR} /videos \\\n && sudo mkdir -p ${LOGS_DIR} \\\n && sudo mkdir -p ${RUN_DIR} \\\n && sudo mkdir -p /tmp/.X11-unix /tmp/.ICE-unix \\\n && sudo fixperms.sh \\\n && echo \"\"\n#  =====================================================\n#   Meta JSON file to hold commit info of current build\n#  =====================================================\nCOPY scm-source.json /\n#   Ensure the file is up-to-date else you should update it by running\n#    ./host-scripts/gen-scm-source.sh\n#   on the host machine\n#  ==================\n#   ENTRYPOINT & CMD\n#  ==================\n#   IMPORTANT: Using the string form `CMD \"entry.sh\"` without\n#   brackets [] causes Docker to run your process\n#   And using `bash` which doesn’t handle signals properly\nCMD [\"entry.sh\"]\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"# == FROM instructions support variables that are declared by\n#  any ARG instructions that occur before the first FROM\n#  ref: https://docs.docker.com/engine/reference/builder/#understand-how-arg-and-from-interact\n#\n#  To overwrite the build args use:\n#   docker build ... --build-arg UBUNTU_DATE=20171006\nARG UBUNTU_FLAVOR=xenial\nARG UBUNTU_DATE=20181113\n# == Ubuntu xenial is 16.04, i.e. FROM ubuntu:16.04\n#  Find latest images at https://hub.docker.com/r/library/ubuntu/\n#  Layer size: ~122 MB\nFROM ubuntu:${UBUNTU_FLAVOR}-${UBUNTU_DATE}\n# == An ARG declared before a FROM is outside of a build stage,\n#  so it can’t be used in any instruction after a FROM. To use\n#  the default value of an ARG declared before the first\n#  FROM use an ARG instruction without a value inside of a build stage\n#  ref: https://docs.docker.com/engine/reference/builder/#understand-how-arg-and-from-interact\nARG UBUNTU_FLAVOR\nARG UBUNTU_DATE\n#  Docker build debug logging, green colored\nRUN printf \"\\033[1;32mFROM ubuntu:${UBUNTU_FLAVOR}-${UBUNTU_DATE} \\033[0m\\n\"\n# == Ubuntu flavors - common\nRUN echo \"deb http://archive.ubuntu.com/ubuntu ${UBUNTU_FLAVOR} main universe\\n\" > /etc/apt/sources.list \\\n && echo \"deb http://archive.ubuntu.com/ubuntu ${UBUNTU_FLAVOR}-updates main universe\\n\" >> /etc/apt/sources.list \\\n && echo \"deb http://archive.ubuntu.com/ubuntu ${UBUNTU_FLAVOR}-security main universe\\n\" >> /etc/apt/sources.list\nMAINTAINER Diego Molina <diemol@gmail.com>\nMAINTAINER Leo Gallucci <elgalu3+dosel@gmail.com>\n#  https://github.com/docker/docker/pull/25466#discussion-diff-74622923R677\nLABEL maintainer=\"\\\"Diego Molina <diemol@gmail.com>\\\"\"\nLABEL maintainer=\"\\\"Leo Gallucci <elgalu3+dosel@gmail.com>\\\"\"\n#  No interactive frontend during docker build\nENV DEBIAN_FRONTEND=\"noninteractive\" \\\n    DEBCONF_NONINTERACTIVE_SEEN=\"true\"\n#  GPG servers aren't too reliable (especially in out test builds)\n#  so fallback servers are needed\n#   ref: https://github.com/nodejs/docker-node/issues/340#issuecomment-321669029\n#   ref: http://askubuntu.com/a/235911/134645\n#   ref: https://github.com/moby/moby/issues/20022#issuecomment-182169732\n#  How to remove keys? e.g. sudo apt-key del 2EA8F35793D8809A\nRUN set -ex \\\n && for key in 2EA8F35793D8809A 40976EAF437D05B5 3B4FE6ACC0B21F32 A2F683C52980AECF F76221572C52609D 58118E89F3A912897C070ADBF76221572C52609D; do gpg --keyserver keyserver.ubuntu.com --recv-keys \"$key\" || gpg --keyserver pgp.mit.edu --recv-keys \"$key\" || gpg --keyserver keyserver.pgp.com --recv-keys \"$key\" || gpg --keyserver ha.pool.sks-keyservers.net --recv-keys \"$key\" ; done\n# ========================\n#  Miscellaneous packages\n# ========================\n#  libltdl7        0.3 MB\n#    allows to run docker alongside docker\n#  netcat-openbsd  0.5 MB\n#    inlcues `nc` an arbitrary TCP and UDP connections and listens\n#  pwgen           0.4 MB\n#    generates random, meaningless but pronounceable passwords\n#  bc              0.5 MB\n#    An arbitrary precision calculator language\n#  unzip           0.7 MB\n#    uncompress zip files\n#  bzip2           1.29 MB\n#    uncompress bzip files\n#  apt-utils       1.0 MB\n#    commandline utilities related to package management with APT\n#  net-tools       0.8 MB\n#    arp, hostname, ifconfig, netstat, route, plipconfig, iptunnel\n#  jq              1.1 MB\n#    jq is like sed for JSON data, you can use it to slice and filter and map\n#  sudo            1.3 MB\n#    sudo binary\n#  psmisc          1.445 MB\n#    fuser – identifies what processes are using files.\n#    killall – kills a process by its name, similar to a pkill Unices.\n#    pstree – Shows currently running processes in a tree format.\n#    peekfd – Peek at file descriptors of running processes.\n#  iproute2        2.971 MB\n#    to use `ip` command\n#  iputils-ping    3.7 MB\n#    ping, ping6 - send ICMP ECHO_REQUEST to network hosts\n#  dbus-x11        4.6 MB\n#    is needed to avoid http://askubuntu.com/q/237893/134645\n#  wget            7.3 MB\n#    The non-interactive network downloader\n#  curl             17 MB (real +diff when with wget: 7 MB)\n#    transfer URL data using various Internet protocols\n#  ---------------------------------------------------------\n#  If we install them separately the total SUM() gives 39 MB\n#  If we install them together   the total SUM() gives 25 MB\n#  ---------------------------------------------------------\n#  Removed packages:\n#    telnet          5.2 MB\n#      for debugging firewall issues\n#    grc              33 MB !!\n#      is a terminal colorizer that works nice with tail https://github.com/garabik/grc\n#    moreutils        44 MB !!\n#      has `ts` that will prepend a timestamp to every line of input you give it\n#  Layer size: medium: 29.8 MB\n#  Layer size: medium: 27.9 MB (with --no-install-recommends)\nRUN apt-get -qqy update \\\n && apt-get -qqy install libltdl7 libhavege1 netcat-openbsd pwgen bc unzip bzip2 apt-utils net-tools jq sudo psmisc iproute2 iputils-ping dbus-x11 wget curl \\\n && apt-get -qyy autoremove \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n# ==============================\n#  Locale and encoding settings\n# ==============================\n#  TODO: Allow to change instance language OS and Browser level\n#   see if this helps: https://github.com/rogaha/docker-desktop/blob/68d7ca9df47b98f3ba58184c951e49098024dc24/Dockerfile#L57\nENV LANG_WHICH=\"en\"\nENV LANG_WHERE=\"US\"\nENV ENCODING=\"UTF-8\"\nENV LANGUAGE=\"${LANG_WHICH}_${LANG_WHERE}.${ENCODING}\"\nENV LANG=\"${LANGUAGE}\"\n#  Layer size: small: ~9 MB\n#  Layer size: small: ~9 MB MB (with --no-install-recommends)\nRUN apt-get -qqy update \\\n && apt-get -qqy --no-install-recommends install language-pack-en tzdata locales \\\n && locale-gen ${LANGUAGE} \\\n && dpkg-reconfigure --frontend noninteractive locales \\\n && apt-get -qyy autoremove \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n# ===================\n#  Timezone settings\n# ===================\n#  Full list at https://en.wikipedia.org/wiki/List_of_tz_database_time_zones\n#   e.g. \"US/Pacific\" for Los Angeles, California, USA\n#  e.g. ENV TZ \"US/Pacific\"\nENV TZ=\"Europe/Berlin\"\n#  Apply TimeZone\n#  Layer size: tiny: 1.339 MB\nRUN echo \"Setting time zone to '${TZ}'\" \\\n && echo \"${TZ}\" > /etc/timezone \\\n && dpkg-reconfigure --frontend noninteractive tzdata\n# ========================================\n#  Add normal user with passwordless sudo\n# ========================================\n#  Layer size: tiny: 0.3 MB\nRUN useradd seluser --shell /bin/bash --create-home \\\n && usermod -a -G sudo seluser \\\n && gpasswd -a seluser video \\\n && echo 'seluser:secret' | chpasswd \\\n && useradd extrauser --shell /bin/bash \\\n && usermod -a -G sudo extrauser \\\n && gpasswd -a extrauser video \\\n && gpasswd -a extrauser seluser \\\n && echo 'extrauser:secret' | chpasswd \\\n && echo 'ALL ALL = (ALL) NOPASSWD: ALL' >> /etc/sudoers\n# ==============================\n#  Java8 - OpenJDK JRE headless\n#  Minimal runtime used for executing non GUI Java programs\n# ==============================\n#  Regarding urandom see\n#   http://stackoverflow.com/q/26021181/511069\n#   https://github.com/SeleniumHQ/docker-selenium/issues/14#issuecomment-67414070\n#  Layer size: big: 132.2 MB\n#  Layer size: big: 132.2 MB (with --no-install-recommends)\nRUN apt-get -qqy update \\\n && apt-get -qqy install openjdk-8-jre-headless \\\n && sed -i 's/securerandom.source=file:\\/dev\\/urandom/securerandom.source=file:\\/dev\\/.\\/urandom/g' /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/security/java.security \\\n && sed -i 's/securerandom.source=file:\\/dev\\/random/securerandom.source=file:\\/dev\\/.\\/urandom/g' /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/security/java.security \\\n && apt-get -qyy autoremove \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n# ==================\n#  Java8 - Oracle\n# ==================\n#  Regarding urandom see\n#   http://stackoverflow.com/q/26021181/511069\n#   https://github.com/SeleniumHQ/docker-selenium/issues/14#issuecomment-67414070\n#  Layer size: huge: 618.6 MB (with --no-install-recommends)\n#  Layer size: huge: 661.1 MB\n#  RUN apt-get -qqy update \\\n#    && apt-get -qqy --no-install-recommends install \\\n#      software-properties-common \\\n#    && echo debconf shared/accepted-oracle-license-v1-1 \\\n#        select true | debconf-set-selections \\\n#    && echo debconf shared/accepted-oracle-license-v1-1 \\\n#        seen true | debconf-set-selections \\\n#    && add-apt-repository ppa:webupd8team/java \\\n#    && apt-get -qqy update \\\n#    && apt-get -qqy install \\\n#      oracle-java8-installer \\\n#    && sed -i 's/securerandom.source=file:\\/dev\\/urandom/securerandom.source=file:\\/dev\\/.\\/urandom/g' \\\n#         /usr/lib/jvm/java-8-oracle/jre/lib/security/java.security \\\n#    && sed -i 's/securerandom.source=file:\\/dev\\/random/securerandom.source=file:\\/dev\\/.\\/urandom/g' \\\n#         /usr/lib/jvm/java-8-oracle/jre/lib/security/java.security \\\n#    && apt-get -qqy install \\\n#      oracle-java8-set-default \\\n#    && apt-get -qyy autoremove \\\n#    && rm -rf /var/lib/apt/lists/* \\\n#    && apt-get -qyy clean\n# ==============================================\n#  Java blocks until kernel have enough entropy\n#  to generate the /dev/random seed\n# ==============================================\n#  See: SeleniumHQ/docker-selenium/issues/14\n#  Layer size: tiny: 0.8 MB\nRUN apt-get -qqy update \\\n && apt-key update -qqy \\\n && apt-get -qqy install haveged rng-tools \\\n && service haveged start \\\n && update-rc.d haveged defaults \\\n && apt-get -qyy autoremove \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n# ===================================================\n#  Run the following commands as non-privileged user\n# ===================================================\nUSER seluser\nWORKDIR /home/seluser\n#  Docker backward compatibility\nRUN echo \"${UBUNTU_FLAVOR}\" > UBUNTU_FLAVOR \\\n && echo \"${UBUNTU_DATE}\" > UBUNTU_DATE\n# =================\n#  Selenium latest\n# =================\n#  Layer size: medium ~22 MB\nARG SEL_DIRECTORY=\"3.14\"\nENV SEL_VER=\"3.141.59\"\nRUN wget -nv \"https://github.com/dosel/selenium/releases/download/selenium-3.141.59-patch-d47e74d6f2/selenium.jar\" \\\n && ln -s \"selenium.jar\" \"selenium-server-standalone-${SEL_VER}.jar\" \\\n && ln -s \"selenium.jar\" \"selenium-server-standalone-3.jar\"\n#  TODO: Enable this again when Selenium 4.0 is released\n# RUN echo $SEL_VER\n# RUN  export SELBASE=\"https://selenium-release.storage.googleapis.com\" \\\n#   && export SELPATH=\"${SEL_DIRECTORY}/selenium-server-standalone-${SEL_VER}.jar\" \\\n#   && wget -nv ${SELBASE}/${SELPATH} \\\n#   && ln -s \"selenium-server-standalone-${SEL_VER}.jar\" \\\n#            \"selenium-server-standalone-3.jar\"\nLABEL selenium_version=\"\\\"${SEL_VER}\\\"\"\n# =============================\n#  sudo by default from now on\n# =============================\nUSER root\n# =========================================================\n#  Python2 for Supervisor, selenium tests, and other stuff\n# =========================================================\n#  Layer size: big.: 79.39 MB (with --no-install-recommends)\n#  Layer size: huge: 296 MB\n#  RUN apt-get -qqy update \\\n#    && apt-get -qqy --no-install-recommends install \\\n#      python2.7 \\\n#      python-pip \\\n#      python-openssl \\\n#      libssl-dev \\\n#      libffi-dev \\\n#    && pip install --upgrade pip==9.0.3 \\\n#    && pip install --upgrade setuptools \\\n#    && rm -rf /var/lib/apt/lists/* \\\n#    && apt-get -qyy clean\n# =========================================================\n#  Python3 for Supervisor, selenium tests, and other stuff\n# =========================================================\n#  Note Python2 comes already installed with Oracle Java\n#   so better stick to it to avoid occupying more disk space\n#  Note Python3 fails installing mozInstall==1.12 with\n#   NameError: name 'file' is not defined\n#  After install, make some useful symlinks that are expected to exist\n#  Layer size: big.: 138.9 MB (with --no-install-recommends)\n#  Layer size: huge: 309.9 MB\nCOPY test/requirements.txt /test/\nRUN apt-get -qqy update \\\n && apt-get -qqy --no-install-recommends install python3 python3-pip python3-dev python3-openssl libssl-dev libffi-dev \\\n && pip3 install --no-cache --upgrade pip==9.0.3 \\\n && pip3 install --no-cache setuptools \\\n && pip3 install --no-cache numpy \\\n && pip3 install --no-cache --requirement /test/requirements.txt \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\nRUN cd /usr/local/bin \\\n && { [ -e easy_install ] || ln -s easy_install-* easy_install ; } \\\n && ln -s idle3 idle \\\n && ln -s pydoc3 pydoc \\\n && ln -s python3 python \\\n && ln -s python3-config python-config \\\n && ln -s /usr/bin/python3 /usr/bin/python \\\n && python --version \\\n && pip --version\n# ====================\n#  Supervisor install\n# ====================\n#  TODO: Upgrade to supervisor stable 4.0 as soon as is released\n#  Check every now and then if version 4 is finally the stable one\n#   https://pypi.python.org/pypi/supervisor\n#   https://github.com/Supervisor/supervisor\n#  RUN apt-get -qqy update \\\n#    && apt-get -qqy install \\\n#      supervisor \\\n#  2018-09-28 commit: 837c159ae51f3b, supervisor/version.txt: 4.0.0.dev0\n#  2018-06-01 commit: ec495be4e28c69, supervisor/version.txt: 4.0.0.dev0\n#  2017-10-21 commit: 3f04badc3237f0, supervisor/version.txt: 4.0.0.dev0\n#  2017-05-30 commit: 946d9cf3be4db3, supervisor/version.txt: 4.0.0.dev0\nENV RUN_DIR=\"/var/run/sele\"\nRUN SHA=\"837c159ae51f3bf12c1d30a8cb44f3450611983c\" \\\n && pip install \"https://github.com/Supervisor/supervisor/zipball/${SHA}\" --no-cache || pip install \"https://github.com/Supervisor/supervisor/zipball/${SHA}\" --no-cache \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n# ================\n#  Font libraries\n# ================\n#  libfontconfig            ~1 MB\n#  libfreetype6             ~1 MB\n#  xfonts-cyrillic          ~2 MB\n#  xfonts-scalable          ~2 MB\n#  fonts-liberation         ~3 MB\n#  fonts-ipafont-gothic     ~13 MB\n#  fonts-wqy-zenhei         ~17 MB\n#  ttf-ubuntu-font-family   ~5 MB\n#    Ubuntu Font Family, sans-serif typeface hinted for clarity\n#  Removed packages:\n#  xfonts-100dpi            ~6 MB\n#  xfonts-75dpi             ~6 MB\n#  Regarding fonts-liberation see:\n#   https://github.com/SeleniumHQ/docker-selenium/issues/383#issuecomment-278367069\n#  Layer size: small: 36.28 MB (with --no-install-recommends)\n#  Layer size: small: 36.28 MB\nRUN apt-get -qqy update \\\n && apt-get -qqy --no-install-recommends install libfontconfig libfreetype6 xfonts-cyrillic xfonts-scalable fonts-liberation fonts-ipafont-gothic fonts-wqy-zenhei ttf-ubuntu-font-family \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n# =========\n#  Openbox\n#  A lightweight window manager using freedesktop standards\n# =========\n#  Let's disable this as is only filling disk space\n#  Layer size: huge: 153.4 MB (with --no-install-recommends)\n#  Layer size: huge: 224.4 MB\n#  RUN apt-get -qqy update \\\n#    && apt-get -qqy --no-install-recommends install \\\n#      openbox obconf menu \\\n#    && rm -rf /var/lib/apt/lists/* \\\n#    && apt-get -qyy clean\n# =========\n#  fluxbox\n#  A fast, lightweight and responsive window manager\n# =========\n#  xfce4-notifyd adds 5mb but allows `notify-send` notifications\n#  Layer size: small: 9.659 MB\n#  Layer size: small: 6.592 MB (with --no-install-recommends)\nRUN apt-get -qqy update \\\n && apt-get -qqy install fluxbox xfce4-notifyd \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n# ============================\n#  Xvfb X virtual framebuffer\n# ============================\n#  xvfb: Xvfb or X virtual framebuffer is a display server\n#   + implements the X11 display server protocol\n#   + performs all graphical operations in memory\n#  Packages that used to be together in this layer\n#    xvfb                      75.69 MB  no-recommends: 68.2 MB\n#    xorg                      160.3 MB  no-recommends: 134.6 MB\n#    xserver-xorg-video-dummy  116.7 MB  no-recommends: 90.52 MB\n#  Layer size: big: 136.9 MB (with --no-install-recommends)\n#  Layer size: big: 162.6 MB\nRUN apt-get -qqy update \\\n && apt-get -qqy --no-install-recommends install xvfb xorg \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n# ============\n#  VNC Server\n# ============\n#  Layer size: medium: 12.67 MB\n#  Layer size: medium: 10.08 MB (with --no-install-recommends)\nRUN apt-get -qqy update \\\n && apt-get -qqy install x11vnc \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n# ===================================================\n#  Run the following commands as non-privileged user\n# ===================================================\nUSER seluser\n# #######################################\n#  noVNC to expose VNC via an html page #\n# #######################################\n#  Download elgalu/noVNC dated 2016-11-18 commit 9223e8f2d1c207fb74cb4b8cc243e59d84f9e2f6\n#  Download kanaka/noVNC dated 2016-11-10 commit 80b7dde665cac937aa0929d2b75aa482fc0e10ad\n#  Download kanaka/noVNC dated 2016-02-24 commit b403cb92fb8de82d04f305b4f14fa978003890d7\n#  Download kanaka/websockify dated 2016-10-10 commit cb1508fa495bea4b333173705772c1997559ae4b\n#  Download kanaka/websockify dated 2015-06-02 commit 558a6439f14b0d85a31145541745e25c255d576b\n#  Layer size: small: 2.919 MB\nENV NOVNC_SHA=\"9223e8f2d1c207fb74cb4b8cc243e59d84f9e2f6\" \\\n    WEBSOCKIFY_SHA=\"cb1508fa495bea4b333173705772c1997559ae4b\"\nRUN wget -nv -O noVNC.zip \"https://github.com/elgalu/noVNC/archive/${NOVNC_SHA}.zip\" \\\n && unzip -x noVNC.zip \\\n && mv noVNC-${NOVNC_SHA} noVNC \\\n && rm noVNC.zip \\\n && wget -nv -O websockify.zip \"https://github.com/kanaka/websockify/archive/${WEBSOCKIFY_SHA}.zip\" \\\n && unzip -x websockify.zip \\\n && rm websockify.zip \\\n && mv websockify-${WEBSOCKIFY_SHA} ./noVNC/utils/websockify\n# =============================\n#  sudo by default from now on\n# =============================\nUSER root\n# =========================\n#  Browser video libraries\n# =========================\n#  gstreamer (gstreamer1.0-libav)\n#    for mp4 & html5 video browser support: https://www.youtube.com/html5\n#  TODO: Add test to see what the browser supports by opening\n#        https://www.youtube.com/html5\n#  Layer size: big: 149.9 MB\n#  Layer size: big: 135.4 MB (with --no-install-recommends)\nRUN apt-get -qqy update \\\n && apt-get -qqy --no-install-recommends install gstreamer1.0-libav \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n# =================================================\n#  ffmpeg/libav/avconv video codecs & dependencies\n# =================================================\n#  MP4Box (gpac) to clean the video credits to @taskworld @dtinth\n#  ponchio/untrunc dependencies to restore a damaged (truncated) video\n#    libavformat-dev libavcodec-dev libavutil-dev libqt4-dev make g++ libz-dev\n#  Layer size: medium: ~12 MB (with --no-install-recommends)\n#  Layer size: medium: ~21 MB\n#  RUN apt-get -qqy update \\\n#    && apt-get -qqy --no-install-recommends install \\\n#      libx264-dev \\\n#      libvorbis-dev \\\n#      libx11-dev \\\n#      gpac \\\n#    && rm -rf /var/lib/apt/lists/* \\\n#    && apt-get -qyy clean\n# ========\n#  ffmpeg\n# ========\n#  MP4Box (gpac) to clean the video credits to @taskworld @dtinth\n#  ffmpeg (ffmpeg): Is a better alternative to Pyvnc2swf\n#    (use in Ubuntu >= 15) packages: ffmpeg\n#  Layer size: medium: ~12 MB (with --no-install-recommends)\n#  Layer size: medium: ~17 MB\nRUN apt-get -qqy update \\\n && apt-get -qqy install ffmpeg gpac \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n# ==============\n#  libav/avconv\n# ==============\n#  Layer size: medium: 11.58 MB (with --no-install-recommends)\n#  Layer size: medium: 16.75 MB\n#  libav-tools (avconv): a fork of ffmpeg\n#    a better alternative to Pyvnc2swf\n#    (use in Ubuntu <= 14) packages: libav-tools libx264-142\nRUN apt-get -qqy update \\\n && apt-get -qqy --no-install-recommends install libav-tools \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#  ------------------------#\n#  Sauce Connect Tunneling #\n#  ------------------------#\n#  Please use https://github.com/zalando/zalenium\n#  -----------------------#\n#  BrowserStack Tunneling #\n#  -----------------------#\n#  Please use https://github.com/zalando/zalenium\n# -----------------#\n#  Mozilla\n#\n# -----------------#\n#  Install all Firefox dependencies\n#  Layer size: big: 83.51 MB\n#  Adding libasound2 and others, credits to @jackTheRipper\n#   https://github.com/SeleniumHQ/docker-selenium/pull/418\n#  libasound2 \\\n#  libpulse-dev \\\n#  xul-ext-ubufox \\\nRUN apt-get -qqy update \\\n && apt-get -qqy --no-install-recommends install `apt-cache depends firefox | awk '/Depends:/{print$2}' ` \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n# ===================================================\n#  Run the following commands as non-privileged user\n# ===================================================\nUSER seluser\n# --- Nightly\n#  ENV FF_VER=\"52.0a0\" \\\n#      FF_PLATFORM=\"linux-i686\" \\\n#      FF_INNER_PATH=\"firefox/nightly/latest-mozilla-central\"\n#  ENV FF_COMP=\"firefox-${FF_VER}.${FF_LANG}.${FF_PLATFORM}.tar.bz2\"\n#  ENV FF_URL=\"${FF_BASE_URL}/${FF_INNER_PATH}/${FF_COMP}\"\n#\n#  Where to find latest version:\n#   https://archive.mozilla.org/pub/mozilla.org/firefox/releases/latest/linux-x86_64/en-US/\n#   https://download-installer.cdn.mozilla.net/pub/mozilla.org/firefox/releases/latest/linux-x86_64/en-US/\n#   https://ftp.mozilla.org/pub/mozilla.org/firefox/releases/latest/linux-x86_64/en-US/\n#  e.g. 44.0 instead of latest\n#   https://archive.mozilla.org/pub/firefox/releases/44.0/linux-x86_64/en-US/firefox-44.0.tar.bz2\n#  FF_LANG can be either en-US // de // fr and so on\n#  Regarding the pip packages, see released versions at:\n#   https://github.com/mozilla/mozdownload/releases\n# =============================\n#  sudo by default from now on\n# =============================\nUSER root\nENV FF_LANG=\"en-US\" \\\n    FF_BASE_URL=\"https://archive.mozilla.org/pub\" \\\n    FF_PLATFORM=\"linux-x86_64\" \\\n    FF_INNER_PATH=\"firefox/releases\"\n# --- For Selenium 3\n#  Layer size: big: 108.2 MB\nARG FF_VER=\"67.0\"\nENV FF_COMP=\"firefox-${FF_VER}.tar.bz2\"\nENV FF_URL=\"${FF_BASE_URL}/${FF_INNER_PATH}/${FF_VER}/${FF_PLATFORM}/${FF_LANG}/${FF_COMP}\"\nRUN cd /opt \\\n && wget -nv \"${FF_URL}\" -O \"firefox.tar.bz2\" \\\n && bzip2 -d \"firefox.tar.bz2\" \\\n && tar xf \"firefox.tar\" \\\n && rm \"firefox.tar\" \\\n && ln -fs /opt/firefox/firefox /usr/bin/firefox \\\n && chown -R seluser:seluser /opt/firefox \\\n && chmod -R 777 /opt/firefox\nLABEL selenium_firefox_version=\"\\\"${FF_VER}\\\"\"\n# ============\n#  GeckoDriver\n# ============\n#  Layer size: tiny: ~4 MB\nARG GECKOD_VER=\"0.24.0\"\nENV GECKOD_URL=\"https://github.com/mozilla/geckodriver/releases/download\"\nRUN wget --no-verbose -O geckodriver.tar.gz \"${GECKOD_URL}/v${GECKOD_VER}/geckodriver-v${GECKOD_VER}-linux64.tar.gz\" \\\n && rm -rf /opt/geckodriver* \\\n && tar -C /opt -xvzf geckodriver.tar.gz \\\n && chmod +x /opt/geckodriver \\\n && cp /opt/geckodriver /usr/bin/geckodriver \\\n && chown seluser:seluser /opt/geckodriver \\\n && chown seluser:seluser /usr/bin/geckodriver \\\n && rm geckodriver.tar.gz\nCOPY bin/fail /usr/bin/\n# ===============\n#  Google Chrome\n# ===============\n#  TODO: Use Google fingerprint to verify downloads\n#   https://www.google.de/linuxrepositories/\nARG EXPECTED_CHROME_VERSION=\"75.0.3770.80\"\nENV CHROME_URL=\"https://dl.google.com/linux/direct\" \\\n    CHROME_BASE_DEB_PATH=\"/home/seluser/chrome-deb/google-chrome\" \\\n    GREP_ONLY_NUMS_VER=\"[0-9.]{2,20}\"\nLABEL selenium_chrome_version=\"\\\"${EXPECTED_CHROME_VERSION}\\\"\"\n#  Layer size: huge: 196.3 MB\nRUN apt-get -qqy update \\\n && mkdir -p chrome-deb \\\n && wget -nv \"${CHROME_URL}/google-chrome-stable_current_amd64.deb\" -O \"./chrome-deb/google-chrome-stable_current_amd64.deb\" \\\n && apt-get -qyy --no-install-recommends install \"${CHROME_BASE_DEB_PATH}-stable_current_amd64.deb\" \\\n && rm \"${CHROME_BASE_DEB_PATH}-stable_current_amd64.deb\" \\\n && rm -rf ./chrome-deb \\\n && apt-get -qyy autoremove \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean \\\n && export CH_STABLE_VER=$( /usr/bin/google-chrome-stable --version | grep -iEo \"${GREP_ONLY_NUMS_VER}\" ;) \\\n && echo \"CH_STABLE_VER:'${CH_STABLE_VER}' vs EXPECTED_CHROME_VERSION:'${EXPECTED_CHROME_VERSION}'\" \\\n && [ \"${CH_STABLE_VER}\" = \"${EXPECTED_CHROME_VERSION}\" ] || fail\n#  We have a wrapper for /opt/google/chrome/google-chrome\nRUN mv /opt/google/chrome/google-chrome /opt/google/chrome/google-chrome-base\nCOPY selenium-node-chrome/opt /opt\nCOPY lib/* /usr/lib/\n#  Use a custom wallpaper for Fluxbox\nCOPY images/wallpaper-dosel.png /usr/share/images/fluxbox/ubuntu-light.png\nCOPY images/wallpaper-zalenium.png /usr/share/images/fluxbox/\nRUN chown -R seluser:seluser /usr/share/images/fluxbox/ \\\n && chmod -R 777 /usr/share/images/fluxbox\n# ===================================================\n#  Run the following commands as non-privileged user\n# ===================================================\nUSER seluser\n# ==================\n#  Chrome webdriver\n# ==================\n#  How to get cpu arch dynamically: $(lscpu | grep Architecture | sed \"s/^.*_//\")\nARG CHROME_DRIVER_VERSION=\"75.0.3770.8\"\nENV CHROME_DRIVER_BASE=\"chromedriver.storage.googleapis.com\" \\\n    CPU_ARCH=\"64\"\nENV CHROME_DRIVER_FILE=\"chromedriver_linux${CPU_ARCH}.zip\"\nENV CHROME_DRIVER_URL=\"https://${CHROME_DRIVER_BASE}/${CHROME_DRIVER_VERSION}/${CHROME_DRIVER_FILE}\"\n#  Gets latest chrome driver version. Or you can hard-code it, e.g. 2.15\n#  Layer size: small: 6.932 MB\nRUN wget -nv -O chromedriver_linux${CPU_ARCH}.zip ${CHROME_DRIVER_URL} \\\n && unzip chromedriver_linux${CPU_ARCH}.zip \\\n && rm chromedriver_linux${CPU_ARCH}.zip \\\n && mv chromedriver chromedriver-${CHROME_DRIVER_VERSION} \\\n && chmod 755 chromedriver-${CHROME_DRIVER_VERSION} \\\n && ln -s chromedriver-${CHROME_DRIVER_VERSION} chromedriver \\\n && sudo ln -s /home/seluser/chromedriver /usr/bin\n# =================\n#  Supervisor conf\n# =================\nCOPY supervisor/etc/supervisor/supervisord.conf /etc/supervisor/\nCOPY **/etc/supervisor/conf.d/* /etc/supervisor/conf.d/\n# ===================\n#  DNS & hosts stuff\n# ===================\nCOPY ./dns/etc/hosts /tmp/hosts\n# ======\n#  Envs\n# ======\nENV DEFAULT_SELENIUM_HUB_PORT=\"24444\" \\\n    DEFAULT_SELENIUM_NODE_CH_PORT=\"25550\" \\\n    DEFAULT_SELENIUM_NODE_FF_PORT=\"25551\" \\\n    DEFAULT_SELENIUM_MULTINODE_PORT=\"25552\" \\\n    DEFAULT_VNC_PORT=\"25900\" \\\n    DEFAULT_NOVNC_PORT=\"26080\" \\\n    DEFAULT_SUPERVISOR_HTTP_PORT=\"19001\"\n#  Commented for now; all these versions are still available at\n#    https://github.com/elgalu/docker-selenium/releases/tag/2.47.1m\n#  CHROME_FLAVOR \"stable\"\n#    Default chrome flavor, options no longer available: beta|unstable\n#  PICK_ALL_RANDOM_PORTS \"true\" / \"false\"\n#    Randomize all ports, i.e. pick unused unprivileged ones\n#  RANDOM_PORT_FROM\n#  RANDOM_PORT_TO\n#    When using PICK_ALL_RANDOM_PORTS=true the ports will\n#    be from a range to avoid collisions\n#  MEM_JAVA_PERCENT \"80\"\n#    Because the JVM uses only 1/4 of system memory by default\n#  WAIT_FOREGROUND_RETRY\n#  WAIT_VNC_FOREGROUND_RETRY\n#    Max amount of time to wait on Xvfb or Xmanager while retrying\n#  XVFB_STARTRETRIES\n#  XMANAGER\n#    We used to support 2 X managers: fluxbox | openbox\n#    But after version 3.0.1 we only support fluxbox\n#    to save disk space\n#  XMANAGER_STARTRETRIES\n#  XMANAGER_STARTSECS\n#    Supervisor processes retry attemps (0 means do not retry)\n#  WAIT_TIMEOUT\n#    Max amount of time to wait for other processes dependencies\n#  DISP_N\n#    Display number; see entry.sh for $DISPLAY\n#  MAX_DISPLAY_SEARCH\n#    Maximum searches for a free DISPLAY number\n#  SELENIUM_HUB_PORT\n#    Even though you can change them below, don't worry too much about container\n#    internal ports since you can map them to the host via `docker run -p`\n#  SELENIUM_HUB_PROTO\n#  SELENIUM_HUB_HOST\n#  SELENIUM_NODE_HOST\n#    You may want to connect to another hub\n#  SELENIUM_HUB_PARAMS\n#  SELENIUM_NODE_PARAMS\n#  SELENIUM_NODE_PROXY_PARAMS\n#    Selenium additional params:\n#  CHROME_ARGS\n#    \"--no-sandbox --disable-gpu\" To taggle issue #58 see https://goo.gl/fz6RTu\n#    more: \"--ignore-certificate-errors\"\n#  CHROME_VERBOSELOGGING\n#    Will be passed with: -Dwebdriver.chrome.verboseLogging\n#      SELENIUM_NODE_CHROME_PARAMS='-Dselenium.chrome.args=\"--no-sandbox\"' \\\n#      WEBDRIVER_NODE_CHROME_PARAMS='-Dwebdriver.chrome.args=\"--no-sandbox\"' \\\n#      Selenium capabilities descriptive (to avoid opera/ie warnings)\n#       docs at https://code.google.com/p/selenium/wiki/Grid2\n#  SEL_RELEASE_TIMEOUT_SECS\n#    -timeout AKA GRID_TIMEOUT TODO fix with, ping @allanatadministrate\n#    https://github.com/SeleniumHQ/docker-selenium/pull/393\n#  SEL_BROWSER_TIMEOUT_SECS\n#  SELENIUM_NODE_REGISTER_CYCLE\n#    How often in ms the node will try to register itself again.\n#    Allow to restart the hub without having to restart the nodes.\n#     (node) in ms. Selenium default: 5000\n#  SEL_CLEANUPCYCLE_MS\n#    How often a proxy will check for timed out thread.\n#     (node) in ms. Selenium default: 5000\n#  SEL_NODEPOLLING_MS\n#    Interval between alive checks of node how often the hub checks if the node is still alive.\n#     (node) in ms. Selenium default: 5000\n#  SEL_UNREGISTER_IF_STILL_DOWN_AFTER\n#    If the node remains down for more than unregisterIfStillDownAfter millisec\n#     it will disappear from the hub. in ms. Default: 1min\n#  no_proxy\n#  HUB_ENV_no_proxy\n#    Docker for Mac beta - containers do not start #227\n#  VNC_FROM_PORT\n#  VNC_TO_PORT\n#    We need a fixed port range to expose VNC due to a bug in Docker for Mac beta (1.12)\n#    https://forums.docker.com/t/docker-for-mac-beta-not-forwarding-ports/8658/6\n#  VNC_CLI_OPTS\n#    e.g. VNC_CLI_OPTS=\"-noipv6 -no6 -forever -shared\"\n#    e.g. VNC_CLI_OPTS=\"-forever -shared\"\n#  VNC_PASSWORD\n#    - \"no\" means no password; less secure but not a big deal\n#    - \"\" (empty string) means it will be randomly generated\n#    - \"some-value\" will use that password \"some-value\" or whatever\n#  LOG_LEVEL\n#    Supervisor loglevel and also general docker log level\n#    can be: debug, warn, trace, info\n#  DISABLE_ROLLBACK\n#    When DISABLE_ROLLBACK=true it will:\n#     - output logs\n#     - exec bash to permit troubleshooting\n#  LOGS_DIR\n#    Logs are now managed by supervisord.conf, see\n#     ${LOGS_DIR}/*.log\n#  FFMPEG_FRAME_RATE\n#    ffmpeg encoding options\n#  FFMPEG_CODEC_ARGS\n#    Video size can be lowered down via re-encoding, see\n#     http://askubuntu.com/a/365221/134645\n#  FFMPEG_DRAW_MOUSE\n#     Specify whether to draw the mouse pointer. Default: 1\n#  VIDEO GRID CHROME FIREFOX RC_CHROME RC_FIREFOX\n#    true/false which services should start upon docker run\n#  VIDEO_FILE_EXTENSION\n#    Video file and extension, e.g. mp4, mkv\n#  TAIL_LOG_LINES\n#    Amount of lines to display when startup errors\n#  SHM_TRY_MOUNT_UNMOUNT\n#    Fix small tiny 64mb shm issue\n#  ETHERNET_DEVICE_NAME\n#    When docker run --net=host the network name may be different\n#  XMANAGER_STOP_SIGNAL\n#  XVFB_STOP_SIGNAL\n#  XTERM_START\n#   Wheather to start an xterm in the windows manager. For debugging.\n#  XTERM_STOP_SIGNAL\n#  SELENIUM_NODE_FIREFOX_STOP_SIGNAL\n#  SELENIUM_NODE_CHROME_STOP_SIGNAL\n#  SELENIUM_MULTINODE_STOP_SIGNAL\n#  SELENIUM_HUB_STOP_SIGNAL\n#  VNC_STOP_SIGNAL\n#  NOVNC_STOP_SIGNAL\n#  VIDEO_REC_STOP_SIGNAL\n#  DOCKER_SOCK\n#    Run docker from inside docker\n#    Usage: docker run -v /var/run/docker.sock:/var/run/docker.sock\n#                      -v $(which docker):/usr/bin/docker\n#  TEST_SLEEPS\n#    Used internally due to flaky tests, should be removed in the future\n#  SEND_ANONYMOUS_USAGE_INFO\n#  GA_TRACKING_ID\n#  GA_ENDPOINT\n#  GA_API_VERSION\n#    All Google Analytics related, see LICENSE.md & Analytics.md for more info\nENV FIREFOX_VERSION=\"${FF_VER}\" \\\n    USE_SELENIUM=\"3\" \\\n    CHROME_FLAVOR=\"stable\" \\\n    DEBUG=\"false\" \\\n    PICK_ALL_RANDOM_PORTS=\"false\" \\\n    RANDOM_PORT_FROM=\"23100\" \\\n    RANDOM_PORT_TO=\"29999\" \\\n    USER=\"seluser\" \\\n    HOME=\"/home/seluser\" \\\n    VNC_STORE_PWD_FILE=\"/home/seluser/.vnc/passwd\" \\\n    BIN_UTILS=\"/usr/bin\" \\\n    MEM_JAVA_PERCENT=\"80\" \\\n    WAIT_FOREGROUND_RETRY=\"2s\" \\\n    WAIT_VNC_FOREGROUND_RETRY=\"6s\" \\\n    XVFB_STARTRETRIES=\"0\" \\\n    XMANAGER_STARTSECS=\"2\" \\\n    XMANAGER_STARTRETRIES=\"3\" \\\n    WAIT_TIMEOUT=\"45s\" \\\n    SCREEN_WIDTH=\"1900\" \\\n    SCREEN_HEIGHT=\"1880\" \\\n    SCREEN_MAIN_DEPTH=\"24\" \\\n    SCREEN_SUB_DEPTH=\"32\" \\\n    DISP_N=\"-1\" \\\n    MAX_DISPLAY_SEARCH=\"99\" \\\n    SCREEN_NUM=\"0\" \\\n    SELENIUM_HUB_PORT=\"${DEFAULT_SELENIUM_HUB_PORT}\" \\\n    SELENIUM_HUB_PROTO=\"http\" \\\n    SELENIUM_HUB_HOST=\"127.0.0.1\" \\\n    SELENIUM_NODE_HOST=\"0.0.0.0\" \\\n    SELENIUM_NODE_CH_PORT=\"${DEFAULT_SELENIUM_NODE_CH_PORT}\" \\\n    SELENIUM_NODE_FF_PORT=\"${DEFAULT_SELENIUM_NODE_FF_PORT}\" \\\n    SELENIUM_MULTINODE_PORT=\"${DEFAULT_SELENIUM_MULTINODE_PORT}\" \\\n    SELENIUM_HUB_PARAMS=\"\" \\\n    SELENIUM_NODE_PARAMS=\"\" \\\n    SELENIUM_NODE_PROXY_PARAMS=\"\" \\\n    CHROME_ARGS=\"--no-sandbox --disable-setuid-sandbox --disable-gpu --disable-infobars\" \\\n    CHROME_ADDITIONAL_ARGS=\"\" \\\n    CHROME_VERBOSELOGGING=\"true\" \\\n    MAX_INSTANCES=\"1\" \\\n    MAX_SESSIONS=\"1\" \\\n    SEL_RELEASE_TIMEOUT_SECS=\"19000\" \\\n    SEL_BROWSER_TIMEOUT_SECS=\"16000\" \\\n    SELENIUM_NODE_REGISTER_CYCLE=\"5000\" \\\n    SEL_CLEANUPCYCLE_MS=\"5000\" \\\n    SEL_NODEPOLLING_MS=\"5000\" \\\n    SEL_UNREGISTER_IF_STILL_DOWN_AFTER=\"2500\" \\\n    no_proxy=\"localhost\" \\\n    HUB_ENV_no_proxy=\"localhost\" \\\n    XVFB_CLI_OPTS_TCP=\"-nolisten tcp -nolisten inet6\" \\\n    XVFB_CLI_OPTS_BASE=\"-ac -r -cc 4 -accessx -xinerama\" \\\n    XVFB_CLI_OPTS_EXT=\"+extension Composite +extension RANDR +extension GLX\" \\\n    VNC_START=\"true\" \\\n    VNC_PORT=\"${DEFAULT_VNC_PORT}\" \\\n    VNC_FROM_PORT=\"\" \\\n    VNC_TO_PORT=\"\" \\\n    VNC_CLI_OPTS=\"-forever -shared\" \\\n    VNC_PASSWORD=\"no\" \\\n    NOVNC_PORT=\"${DEFAULT_NOVNC_PORT}\" \\\n    NOVNC=\"false\" \\\n    NOVNC_WAIT_TIMEOUT=\"5s\" \\\n    SUPERVISOR_HTTP_PORT=\"${DEFAULT_SUPERVISOR_HTTP_PORT}\" \\\n    SUPERVISOR_HTTP_USERNAME=\"supervisorweb\" \\\n    SUPERVISOR_HTTP_PASSWORD=\"somehttpbasicauthpwd\" \\\n    SUPERVISOR_REQUIRED_SRV_LIST=\"xmanager\" \\\n    SUPERVISOR_NOT_REQUIRED_SRV_LIST1=\"ignoreMe\" \\\n    SUPERVISOR_NOT_REQUIRED_SRV_LIST2=\"ignoreMe\" \\\n    SLEEP_SECS_AFTER_KILLING_SUPERVISORD=\"3\" \\\n    SUPERVISOR_STOPWAITSECS=\"20\" \\\n    SUPERVISOR_STOPSIGNAL=\"TERM\" \\\n    SUPERVISOR_KILLASGROUP=\"false\" \\\n    SUPERVISOR_STOPASGROUP=\"false\" \\\n    LOG_LEVEL=\"info\" \\\n    DISABLE_ROLLBACK=\"false\" \\\n    LOGFILE_MAXBYTES=\"10MB\" \\\n    LOGFILE_BACKUPS=\"5\" \\\n    LOGS_DIR=\"/var/log/cont\" \\\n    VIDEO=\"false\" \\\n    GRID=\"true\" \\\n    CHROME=\"true\" \\\n    FIREFOX=\"true\" \\\n    MULTINODE=\"false\" \\\n    FFMPEG_FRAME_RATE=\"10\" \\\n    FFMPEG_CODEC_ARGS=\"-vcodec libx264 -preset ultrafast -pix_fmt yuv420p\" \\\n    FFMPEG_FINAL_CRF=\"0\" \\\n    FFMPEG_DRAW_MOUSE=\"1\" \\\n    VIDEO_TMP_FILE_EXTENSION=\"mkv\" \\\n    VIDEO_FILE_EXTENSION=\"mp4\" \\\n    MP4_INTERLEAVES_MEDIA_DATA_CHUNKS_SECS=\"500\" \\\n    VIDEO_FILE_NAME=\"\" \\\n    VIDEO_BEFORE_STOP_SLEEP_SECS=\"1\" \\\n    VIDEO_AFTER_STOP_SLEEP_SECS=\"0.5\" \\\n    VIDEO_STOPWAITSECS=\"50\" \\\n    VIDEO_CONVERSION_MAX_WAIT=\"20s\" \\\n    VIDEO_MP4_FIX_MAX_WAIT=\"8s\" \\\n    VIDEO_WAIT_VID_TOOL_PID_1st_sig_UP_TO_SECS=\"6s\" \\\n    VIDEO_WAIT_VID_TOOL_PID_2nd_sig_UP_TO_SECS=\"2s\" \\\n    VIDEO_WAIT_VID_TOOL_PID_3rd_sig_UP_TO_SECS=\"1s\" \\\n    VIDEO_STOP_1st_sig_TYPE=\"SIGTERM\" \\\n    VIDEO_STOP_2nd_sig_TYPE=\"SIGINT\" \\\n    VIDEO_STOP_3rd_sig_TYPE=\"SIGKILL\" \\\n    WAIT_TIME_OUT_VIDEO_STOP=\"20s\" \\\n    VIDEOS_DIR=\"/home/seluser/videos\" \\\n    XMANAGER=\"fluxbox\" \\\n    FLUXBOX_START_MAX_RETRIES=\"5\" \\\n    TAIL_LOG_LINES=\"50\" \\\n    SHM_TRY_MOUNT_UNMOUNT=\"false\" \\\n    SHM_SIZE=\"512M\" \\\n    ETHERNET_DEVICE_NAME=\"eth0\" \\\n    XMANAGER_STOP_SIGNAL=\"TERM\" \\\n    XVFB_STOP_SIGNAL=\"TERM\" \\\n    XTERM_START=\"false\" \\\n    XTERM_STOP_SIGNAL=\"INT\" \\\n    SELENIUM_NODE_FIREFOX_STOP_SIGNAL=\"TERM\" \\\n    SELENIUM_NODE_CHROME_STOP_SIGNAL=\"TERM\" \\\n    SELENIUM_MULTINODE_STOP_SIGNAL=\"TERM\" \\\n    SELENIUM_HUB_STOP_SIGNAL=\"TERM\" \\\n    VNC_STOP_SIGNAL=\"TERM\" \\\n    NOVNC_STOP_SIGNAL=\"TERM\" \\\n    VIDEO_REC_STOP_SIGNAL=\"INT\" \\\n    DOCKER_SOCK=\"/var/run/docker.sock\" \\\n    TEST_SLEEPS=\"0.1\" \\\n    ZALENIUM=\"false\" \\\n    SEND_ANONYMOUS_USAGE_INFO=\"true\" \\\n    GA_TRACKING_ID=\"UA-18144954-9\" \\\n    GA_ENDPOINT=\"https://www.google-analytics.com/collect\" \\\n    GA_API_VERSION=\"1\" \\\n    LD_LIBRARY_PATH=\"/usr/lib/x86_64-linux-gnu/\" \\\n    DEBIAN_FRONTEND=\"\" \\\n    USE_KUBERNETES=\"false\" \\\n    REMOVE_SELUSER_FROM_SUDOERS_FOR_TESTING=\"false\" \\\n    DEBCONF_NONINTERACTIVE_SEEN=\"\"\n# ================================\n#  Expose Container's Directories\n# ================================\n#  VOLUME ${LOGS_DIR}\n#  Removed HEALTHCHECK because is providing no value to us but\n#  rather problems. When Zalenium starts N containers at the some time\n#  the --interval will make docker check the health of all of them\n#  at the same time and this causes an unnecessary CPU overhead.\n#  HEALTHCHECK --interval=2m --timeout=50s --retries=2 \\\n#    CMD wait_all_done 30s\n# ================\n#  Binary scripts\n# ================\nCOPY bin/* ${BIN_UTILS}/\nCOPY **/bin/* ${BIN_UTILS}/\nCOPY host-scripts/* /host-scripts/\nCOPY test/* /test/\nCOPY test/run_test.sh /usr/bin/run_test\nCOPY test/selenium_test.sh /usr/bin/selenium_test\nCOPY test/python_test.py /usr/bin/python_test\nCOPY images ./images\nCOPY LICENSE.md /home/seluser/\nCOPY Analytics.md /home/seluser/\n#  Include current version\nCOPY GLOBAL_PATCH_LEVEL.txt /home/seluser/\nRUN echo \"${SEL_VER}-$( cat GLOBAL_PATCH_LEVEL.txt ;)\" > /home/seluser/VERSION\n#  Moved from entry.sh\nENV SUPERVISOR_PIDFILE=\"${RUN_DIR}/supervisord.pid\" \\\n    DOCKER_SELENIUM_STATUS=\"${LOGS_DIR}/docker-selenium-status.log\" \\\n    VNC_TRYOUT_ERR_LOG=\"${LOGS_DIR}/vnc-tryouts-stderr\" \\\n    VNC_TRYOUT_OUT_LOG=\"${LOGS_DIR}/vnc-tryouts-stdout\"\n# ===================================\n#  Fix dirs (again) and final chores\n# ===================================\n#  The .X11-unix stuff is useful when using Xephyr\nRUN mkdir -p /home/seluser/.vnc \\\n && sudo touch /capabilities.json \\\n && sudo chown seluser:seluser /capabilities.json \\\n && generate_capabilities_json > /capabilities.json \\\n && cp /capabilities.json /home/seluser/capabilities.json \\\n && cp /capabilities.json /home/seluser/capabilities \\\n && cp /capabilities.json /home/seluser/caps.json \\\n && cp /capabilities.json /home/seluser/caps \\\n && mkdir -p ${VIDEOS_DIR} \\\n && sudo ln -s ${VIDEOS_DIR} /videos \\\n && sudo mkdir -p ${LOGS_DIR} \\\n && sudo mkdir -p ${RUN_DIR} \\\n && sudo mkdir -p /tmp/.X11-unix /tmp/.ICE-unix \\\n && sudo fixperms.sh \\\n && echo \"\"\n# =====================================================\n#  Meta JSON file to hold commit info of current build\n# =====================================================\nCOPY scm-source.json /\n#  Ensure the file is up-to-date else you should update it by running\n#   ./host-scripts/gen-scm-source.sh\n#  on the host machine\n# ==================\n#  ENTRYPOINT & CMD\n# ==================\n#  IMPORTANT: Using the string form `CMD \"entry.sh\"` without\n#  brackets [] causes Docker to run your process\n#  And using `bash` which doesn’t handle signals properly\nCMD [\"entry.sh\"]\n","injectedSmells":[],"originalDockerfileHash":"fc066a38861d557b39cee55ed814794a","successfullyInjectedSmells":[],"originalDockerfileUglified":"#  == FROM instructions support variables that are declared by\n#   any ARG instructions that occur before the first FROM\n#   ref: https://docs.docker.com/engine/reference/builder/#understand-how-arg-and-from-interact\n#\n#   To overwrite the build args use:\n#    docker build ... --build-arg UBUNTU_DATE=20171006\nARG UBUNTU_FLAVOR=xenial\nARG UBUNTU_DATE=20181113\n#  == Ubuntu xenial is 16.04, i.e. FROM ubuntu:16.04\n#   Find latest images at https://hub.docker.com/r/library/ubuntu/\n#   Layer size: ~122 MB\nFROM ubuntu:${UBUNTU_FLAVOR}-${UBUNTU_DATE}\n#  == An ARG declared before a FROM is outside of a build stage,\n#   so it can’t be used in any instruction after a FROM. To use\n#   the default value of an ARG declared before the first\n#   FROM use an ARG instruction without a value inside of a build stage\n#   ref: https://docs.docker.com/engine/reference/builder/#understand-how-arg-and-from-interact\nARG UBUNTU_FLAVOR\nARG UBUNTU_DATE\n#   Docker build debug logging, green colored\nRUN printf \"\\033[1;32mFROM ubuntu:${UBUNTU_FLAVOR}-${UBUNTU_DATE} \\033[0m\\n\"\n#  == Ubuntu flavors - common\nRUN echo \"deb http://archive.ubuntu.com/ubuntu ${UBUNTU_FLAVOR} main universe\\n\" > /etc/apt/sources.list \\\n && echo \"deb http://archive.ubuntu.com/ubuntu ${UBUNTU_FLAVOR}-updates main universe\\n\" >> /etc/apt/sources.list \\\n && echo \"deb http://archive.ubuntu.com/ubuntu ${UBUNTU_FLAVOR}-security main universe\\n\" >> /etc/apt/sources.list\nMAINTAINER Diego Molina <diemol@gmail.com>\nMAINTAINER Leo Gallucci <elgalu3+dosel@gmail.com>\n#   https://github.com/docker/docker/pull/25466#discussion-diff-74622923R677\nLABEL maintainer=\"\\\"Diego Molina <diemol@gmail.com>\\\"\"\nLABEL maintainer=\"\\\"Leo Gallucci <elgalu3+dosel@gmail.com>\\\"\"\n#   No interactive frontend during docker build\nENV DEBIAN_FRONTEND=\"noninteractive\" \\\n    DEBCONF_NONINTERACTIVE_SEEN=\"true\"\n#   GPG servers aren't too reliable (especially in out test builds)\n#   so fallback servers are needed\n#    ref: https://github.com/nodejs/docker-node/issues/340#issuecomment-321669029\n#    ref: http://askubuntu.com/a/235911/134645\n#    ref: https://github.com/moby/moby/issues/20022#issuecomment-182169732\n#   How to remove keys? e.g. sudo apt-key del 2EA8F35793D8809A\nRUN set -ex \\\n && for key in 2EA8F35793D8809A 40976EAF437D05B5 3B4FE6ACC0B21F32 A2F683C52980AECF F76221572C52609D 58118E89F3A912897C070ADBF76221572C52609D; do gpg --keyserver keyserver.ubuntu.com --recv-keys \"$key\" || gpg --keyserver pgp.mit.edu --recv-keys \"$key\" || gpg --keyserver keyserver.pgp.com --recv-keys \"$key\" || gpg --keyserver ha.pool.sks-keyservers.net --recv-keys \"$key\" ; done\n#  ========================\n#   Miscellaneous packages\n#  ========================\n#   libltdl7        0.3 MB\n#     allows to run docker alongside docker\n#   netcat-openbsd  0.5 MB\n#     inlcues `nc` an arbitrary TCP and UDP connections and listens\n#   pwgen           0.4 MB\n#     generates random, meaningless but pronounceable passwords\n#   bc              0.5 MB\n#     An arbitrary precision calculator language\n#   unzip           0.7 MB\n#     uncompress zip files\n#   bzip2           1.29 MB\n#     uncompress bzip files\n#   apt-utils       1.0 MB\n#     commandline utilities related to package management with APT\n#   net-tools       0.8 MB\n#     arp, hostname, ifconfig, netstat, route, plipconfig, iptunnel\n#   jq              1.1 MB\n#     jq is like sed for JSON data, you can use it to slice and filter and map\n#   sudo            1.3 MB\n#     sudo binary\n#   psmisc          1.445 MB\n#     fuser – identifies what processes are using files.\n#     killall – kills a process by its name, similar to a pkill Unices.\n#     pstree – Shows currently running processes in a tree format.\n#     peekfd – Peek at file descriptors of running processes.\n#   iproute2        2.971 MB\n#     to use `ip` command\n#   iputils-ping    3.7 MB\n#     ping, ping6 - send ICMP ECHO_REQUEST to network hosts\n#   dbus-x11        4.6 MB\n#     is needed to avoid http://askubuntu.com/q/237893/134645\n#   wget            7.3 MB\n#     The non-interactive network downloader\n#   curl             17 MB (real +diff when with wget: 7 MB)\n#     transfer URL data using various Internet protocols\n#   ---------------------------------------------------------\n#   If we install them separately the total SUM() gives 39 MB\n#   If we install them together   the total SUM() gives 25 MB\n#   ---------------------------------------------------------\n#   Removed packages:\n#     telnet          5.2 MB\n#       for debugging firewall issues\n#     grc              33 MB !!\n#       is a terminal colorizer that works nice with tail https://github.com/garabik/grc\n#     moreutils        44 MB !!\n#       has `ts` that will prepend a timestamp to every line of input you give it\n#   Layer size: medium: 29.8 MB\n#   Layer size: medium: 27.9 MB (with --no-install-recommends)\nRUN apt-get update -qqy \\\n && apt-get install libltdl7 libhavege1 netcat-openbsd pwgen bc unzip bzip2 apt-utils net-tools jq sudo psmisc iproute2 iputils-ping dbus-x11 wget curl -qqy \\\n && apt-get -qyy autoremove \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#  ==============================\n#   Locale and encoding settings\n#  ==============================\n#   TODO: Allow to change instance language OS and Browser level\n#    see if this helps: https://github.com/rogaha/docker-desktop/blob/68d7ca9df47b98f3ba58184c951e49098024dc24/Dockerfile#L57\nENV LANG_WHICH=\"en\"\nENV LANG_WHERE=\"US\"\nENV ENCODING=\"UTF-8\"\nENV LANGUAGE=\"${LANG_WHICH}_${LANG_WHERE}.${ENCODING}\"\nENV LANG=\"${LANGUAGE}\"\n#   Layer size: small: ~9 MB\n#   Layer size: small: ~9 MB MB (with --no-install-recommends)\nRUN apt-get update -qqy \\\n && apt-get install --no-install-recommends language-pack-en tzdata locales -qqy \\\n && locale-gen ${LANGUAGE} \\\n && dpkg-reconfigure --frontend noninteractive locales \\\n && apt-get -qyy autoremove \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#  ===================\n#   Timezone settings\n#  ===================\n#   Full list at https://en.wikipedia.org/wiki/List_of_tz_database_time_zones\n#    e.g. \"US/Pacific\" for Los Angeles, California, USA\n#   e.g. ENV TZ \"US/Pacific\"\nENV TZ=\"Europe/Berlin\"\n#   Apply TimeZone\n#   Layer size: tiny: 1.339 MB\nRUN echo \"Setting time zone to '${TZ}'\" \\\n && echo \"${TZ}\" > /etc/timezone \\\n && dpkg-reconfigure --frontend noninteractive tzdata\n#  ========================================\n#   Add normal user with passwordless sudo\n#  ========================================\n#   Layer size: tiny: 0.3 MB\nRUN useradd seluser --shell /bin/bash --create-home \\\n && usermod -a -G sudo seluser \\\n && gpasswd -a seluser video \\\n && echo 'seluser:secret' | chpasswd \\\n && useradd extrauser --shell /bin/bash \\\n && usermod -a -G sudo extrauser \\\n && gpasswd -a extrauser video \\\n && gpasswd -a extrauser seluser \\\n && echo 'extrauser:secret' | chpasswd \\\n && echo 'ALL ALL = (ALL) NOPASSWD: ALL' >> /etc/sudoers\n#  ==============================\n#   Java8 - OpenJDK JRE headless\n#   Minimal runtime used for executing non GUI Java programs\n#  ==============================\n#   Regarding urandom see\n#    http://stackoverflow.com/q/26021181/511069\n#    https://github.com/SeleniumHQ/docker-selenium/issues/14#issuecomment-67414070\n#   Layer size: big: 132.2 MB\n#   Layer size: big: 132.2 MB (with --no-install-recommends)\nRUN apt-get update -qqy \\\n && apt-get install openjdk-8-jre-headless -qqy \\\n && sed -i 's/securerandom.source=file:\\/dev\\/urandom/securerandom.source=file:\\/dev\\/.\\/urandom/g' /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/security/java.security \\\n && sed -i 's/securerandom.source=file:\\/dev\\/random/securerandom.source=file:\\/dev\\/.\\/urandom/g' /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/security/java.security \\\n && apt-get -qyy autoremove \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#  ==================\n#   Java8 - Oracle\n#  ==================\n#   Regarding urandom see\n#    http://stackoverflow.com/q/26021181/511069\n#    https://github.com/SeleniumHQ/docker-selenium/issues/14#issuecomment-67414070\n#   Layer size: huge: 618.6 MB (with --no-install-recommends)\n#   Layer size: huge: 661.1 MB\n#   RUN apt-get -qqy update \\\n#     && apt-get -qqy --no-install-recommends install \\\n#       software-properties-common \\\n#     && echo debconf shared/accepted-oracle-license-v1-1 \\\n#         select true | debconf-set-selections \\\n#     && echo debconf shared/accepted-oracle-license-v1-1 \\\n#         seen true | debconf-set-selections \\\n#     && add-apt-repository ppa:webupd8team/java \\\n#     && apt-get -qqy update \\\n#     && apt-get -qqy install \\\n#       oracle-java8-installer \\\n#     && sed -i 's/securerandom.source=file:\\/dev\\/urandom/securerandom.source=file:\\/dev\\/.\\/urandom/g' \\\n#          /usr/lib/jvm/java-8-oracle/jre/lib/security/java.security \\\n#     && sed -i 's/securerandom.source=file:\\/dev\\/random/securerandom.source=file:\\/dev\\/.\\/urandom/g' \\\n#          /usr/lib/jvm/java-8-oracle/jre/lib/security/java.security \\\n#     && apt-get -qqy install \\\n#       oracle-java8-set-default \\\n#     && apt-get -qyy autoremove \\\n#     && rm -rf /var/lib/apt/lists/* \\\n#     && apt-get -qyy clean\n#  ==============================================\n#   Java blocks until kernel have enough entropy\n#   to generate the /dev/random seed\n#  ==============================================\n#   See: SeleniumHQ/docker-selenium/issues/14\n#   Layer size: tiny: 0.8 MB\nRUN apt-get update -qqy \\\n && apt-key update -qqy \\\n && apt-get install haveged rng-tools -qqy \\\n && service haveged start \\\n && update-rc.d haveged defaults \\\n && apt-get -qyy autoremove \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#  ===================================================\n#   Run the following commands as non-privileged user\n#  ===================================================\nUSER seluser\nWORKDIR /home/seluser\n#   Docker backward compatibility\nRUN echo \"${UBUNTU_FLAVOR}\" > UBUNTU_FLAVOR \\\n && echo \"${UBUNTU_DATE}\" > UBUNTU_DATE\n#  =================\n#   Selenium latest\n#  =================\n#   Layer size: medium ~22 MB\nARG SEL_DIRECTORY=\"3.14\"\nENV SEL_VER=\"3.141.59\"\nRUN wget -nv \"https://github.com/dosel/selenium/releases/download/selenium-3.141.59-patch-d47e74d6f2/selenium.jar\" \\\n && ln -s \"selenium.jar\" \"selenium-server-standalone-${SEL_VER}.jar\" \\\n && ln -s \"selenium.jar\" \"selenium-server-standalone-3.jar\"\n#   TODO: Enable this again when Selenium 4.0 is released\n#  RUN echo $SEL_VER\n#  RUN  export SELBASE=\"https://selenium-release.storage.googleapis.com\" \\\n#    && export SELPATH=\"${SEL_DIRECTORY}/selenium-server-standalone-${SEL_VER}.jar\" \\\n#    && wget -nv ${SELBASE}/${SELPATH} \\\n#    && ln -s \"selenium-server-standalone-${SEL_VER}.jar\" \\\n#             \"selenium-server-standalone-3.jar\"\nLABEL selenium_version=\"\\\"${SEL_VER}\\\"\"\n#  =============================\n#   sudo by default from now on\n#  =============================\nUSER root\n#  =========================================================\n#   Python2 for Supervisor, selenium tests, and other stuff\n#  =========================================================\n#   Layer size: big.: 79.39 MB (with --no-install-recommends)\n#   Layer size: huge: 296 MB\n#   RUN apt-get -qqy update \\\n#     && apt-get -qqy --no-install-recommends install \\\n#       python2.7 \\\n#       python-pip \\\n#       python-openssl \\\n#       libssl-dev \\\n#       libffi-dev \\\n#     && pip install --upgrade pip==9.0.3 \\\n#     && pip install --upgrade setuptools \\\n#     && rm -rf /var/lib/apt/lists/* \\\n#     && apt-get -qyy clean\n#  =========================================================\n#   Python3 for Supervisor, selenium tests, and other stuff\n#  =========================================================\n#   Note Python2 comes already installed with Oracle Java\n#    so better stick to it to avoid occupying more disk space\n#   Note Python3 fails installing mozInstall==1.12 with\n#    NameError: name 'file' is not defined\n#   After install, make some useful symlinks that are expected to exist\n#   Layer size: big.: 138.9 MB (with --no-install-recommends)\n#   Layer size: huge: 309.9 MB\nCOPY test/requirements.txt /test/\nRUN apt-get update -qqy \\\n && apt-get install --no-install-recommends python3 python3-pip python3-dev python3-openssl libssl-dev libffi-dev -qqy \\\n && pip3 install --no-cache --upgrade pip==9.0.3 \\\n && pip3 install --no-cache setuptools \\\n && pip3 install --no-cache numpy \\\n && pip3 install --no-cache --requirement /test/requirements.txt \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\nRUN cd /usr/local/bin \\\n && { [ -e easy_install ] || ln -s easy_install-* easy_install ; } \\\n && ln -s idle3 idle \\\n && ln -s pydoc3 pydoc \\\n && ln -s python3 python \\\n && ln -s python3-config python-config \\\n && ln -s /usr/bin/python3 /usr/bin/python \\\n && python --version \\\n && pip --version\n#  ====================\n#   Supervisor install\n#  ====================\n#   TODO: Upgrade to supervisor stable 4.0 as soon as is released\n#   Check every now and then if version 4 is finally the stable one\n#    https://pypi.python.org/pypi/supervisor\n#    https://github.com/Supervisor/supervisor\n#   RUN apt-get -qqy update \\\n#     && apt-get -qqy install \\\n#       supervisor \\\n#   2018-09-28 commit: 837c159ae51f3b, supervisor/version.txt: 4.0.0.dev0\n#   2018-06-01 commit: ec495be4e28c69, supervisor/version.txt: 4.0.0.dev0\n#   2017-10-21 commit: 3f04badc3237f0, supervisor/version.txt: 4.0.0.dev0\n#   2017-05-30 commit: 946d9cf3be4db3, supervisor/version.txt: 4.0.0.dev0\nENV RUN_DIR=\"/var/run/sele\"\nRUN SHA=\"837c159ae51f3bf12c1d30a8cb44f3450611983c\" \\\n && pip install \"https://github.com/Supervisor/supervisor/zipball/${SHA}\" --no-cache || pip install \"https://github.com/Supervisor/supervisor/zipball/${SHA}\" --no-cache \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#  ================\n#   Font libraries\n#  ================\n#   libfontconfig            ~1 MB\n#   libfreetype6             ~1 MB\n#   xfonts-cyrillic          ~2 MB\n#   xfonts-scalable          ~2 MB\n#   fonts-liberation         ~3 MB\n#   fonts-ipafont-gothic     ~13 MB\n#   fonts-wqy-zenhei         ~17 MB\n#   ttf-ubuntu-font-family   ~5 MB\n#     Ubuntu Font Family, sans-serif typeface hinted for clarity\n#   Removed packages:\n#   xfonts-100dpi            ~6 MB\n#   xfonts-75dpi             ~6 MB\n#   Regarding fonts-liberation see:\n#    https://github.com/SeleniumHQ/docker-selenium/issues/383#issuecomment-278367069\n#   Layer size: small: 36.28 MB (with --no-install-recommends)\n#   Layer size: small: 36.28 MB\nRUN apt-get update -qqy \\\n && apt-get install --no-install-recommends libfontconfig libfreetype6 xfonts-cyrillic xfonts-scalable fonts-liberation fonts-ipafont-gothic fonts-wqy-zenhei ttf-ubuntu-font-family -qqy \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#  =========\n#   Openbox\n#   A lightweight window manager using freedesktop standards\n#  =========\n#   Let's disable this as is only filling disk space\n#   Layer size: huge: 153.4 MB (with --no-install-recommends)\n#   Layer size: huge: 224.4 MB\n#   RUN apt-get -qqy update \\\n#     && apt-get -qqy --no-install-recommends install \\\n#       openbox obconf menu \\\n#     && rm -rf /var/lib/apt/lists/* \\\n#     && apt-get -qyy clean\n#  =========\n#   fluxbox\n#   A fast, lightweight and responsive window manager\n#  =========\n#   xfce4-notifyd adds 5mb but allows `notify-send` notifications\n#   Layer size: small: 9.659 MB\n#   Layer size: small: 6.592 MB (with --no-install-recommends)\nRUN apt-get update -qqy \\\n && apt-get install fluxbox xfce4-notifyd -qqy \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#  ============================\n#   Xvfb X virtual framebuffer\n#  ============================\n#   xvfb: Xvfb or X virtual framebuffer is a display server\n#    + implements the X11 display server protocol\n#    + performs all graphical operations in memory\n#   Packages that used to be together in this layer\n#     xvfb                      75.69 MB  no-recommends: 68.2 MB\n#     xorg                      160.3 MB  no-recommends: 134.6 MB\n#     xserver-xorg-video-dummy  116.7 MB  no-recommends: 90.52 MB\n#   Layer size: big: 136.9 MB (with --no-install-recommends)\n#   Layer size: big: 162.6 MB\nRUN apt-get update -qqy \\\n && apt-get install --no-install-recommends xvfb xorg -qqy \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#  ============\n#   VNC Server\n#  ============\n#   Layer size: medium: 12.67 MB\n#   Layer size: medium: 10.08 MB (with --no-install-recommends)\nRUN apt-get update -qqy \\\n && apt-get install x11vnc -qqy \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#  ===================================================\n#   Run the following commands as non-privileged user\n#  ===================================================\nUSER seluser\n#  #######################################\n#   noVNC to expose VNC via an html page #\n#  #######################################\n#   Download elgalu/noVNC dated 2016-11-18 commit 9223e8f2d1c207fb74cb4b8cc243e59d84f9e2f6\n#   Download kanaka/noVNC dated 2016-11-10 commit 80b7dde665cac937aa0929d2b75aa482fc0e10ad\n#   Download kanaka/noVNC dated 2016-02-24 commit b403cb92fb8de82d04f305b4f14fa978003890d7\n#   Download kanaka/websockify dated 2016-10-10 commit cb1508fa495bea4b333173705772c1997559ae4b\n#   Download kanaka/websockify dated 2015-06-02 commit 558a6439f14b0d85a31145541745e25c255d576b\n#   Layer size: small: 2.919 MB\nENV NOVNC_SHA=\"9223e8f2d1c207fb74cb4b8cc243e59d84f9e2f6\" \\\n    WEBSOCKIFY_SHA=\"cb1508fa495bea4b333173705772c1997559ae4b\"\nRUN wget -nv -O noVNC.zip \"https://github.com/elgalu/noVNC/archive/${NOVNC_SHA}.zip\" \\\n && unzip -x noVNC.zip \\\n && mv noVNC-${NOVNC_SHA} noVNC \\\n && rm noVNC.zip \\\n && wget -nv -O websockify.zip \"https://github.com/kanaka/websockify/archive/${WEBSOCKIFY_SHA}.zip\" \\\n && unzip -x websockify.zip \\\n && rm websockify.zip \\\n && mv websockify-${WEBSOCKIFY_SHA} ./noVNC/utils/websockify\n#  =============================\n#   sudo by default from now on\n#  =============================\nUSER root\n#  =========================\n#   Browser video libraries\n#  =========================\n#   gstreamer (gstreamer1.0-libav)\n#     for mp4 & html5 video browser support: https://www.youtube.com/html5\n#   TODO: Add test to see what the browser supports by opening\n#         https://www.youtube.com/html5\n#   Layer size: big: 149.9 MB\n#   Layer size: big: 135.4 MB (with --no-install-recommends)\nRUN apt-get update -qqy \\\n && apt-get install --no-install-recommends gstreamer1.0-libav -qqy \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#  =================================================\n#   ffmpeg/libav/avconv video codecs & dependencies\n#  =================================================\n#   MP4Box (gpac) to clean the video credits to @taskworld @dtinth\n#   ponchio/untrunc dependencies to restore a damaged (truncated) video\n#     libavformat-dev libavcodec-dev libavutil-dev libqt4-dev make g++ libz-dev\n#   Layer size: medium: ~12 MB (with --no-install-recommends)\n#   Layer size: medium: ~21 MB\n#   RUN apt-get -qqy update \\\n#     && apt-get -qqy --no-install-recommends install \\\n#       libx264-dev \\\n#       libvorbis-dev \\\n#       libx11-dev \\\n#       gpac \\\n#     && rm -rf /var/lib/apt/lists/* \\\n#     && apt-get -qyy clean\n#  ========\n#   ffmpeg\n#  ========\n#   MP4Box (gpac) to clean the video credits to @taskworld @dtinth\n#   ffmpeg (ffmpeg): Is a better alternative to Pyvnc2swf\n#     (use in Ubuntu >= 15) packages: ffmpeg\n#   Layer size: medium: ~12 MB (with --no-install-recommends)\n#   Layer size: medium: ~17 MB\nRUN apt-get update -qqy \\\n && apt-get install ffmpeg gpac -qqy \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#  ==============\n#   libav/avconv\n#  ==============\n#   Layer size: medium: 11.58 MB (with --no-install-recommends)\n#   Layer size: medium: 16.75 MB\n#   libav-tools (avconv): a fork of ffmpeg\n#     a better alternative to Pyvnc2swf\n#     (use in Ubuntu <= 14) packages: libav-tools libx264-142\nRUN apt-get update -qqy \\\n && apt-get install --no-install-recommends libav-tools -qqy \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#   ------------------------#\n#   Sauce Connect Tunneling #\n#   ------------------------#\n#   Please use https://github.com/zalando/zalenium\n#   -----------------------#\n#   BrowserStack Tunneling #\n#   -----------------------#\n#   Please use https://github.com/zalando/zalenium\n#  -----------------#\n#   Mozilla\n#\n#  -----------------#\n#   Install all Firefox dependencies\n#   Layer size: big: 83.51 MB\n#   Adding libasound2 and others, credits to @jackTheRipper\n#    https://github.com/SeleniumHQ/docker-selenium/pull/418\n#   libasound2 \\\n#   libpulse-dev \\\n#   xul-ext-ubufox \\\nRUN apt-get update -qqy \\\n && apt-get install --no-install-recommends `apt-cache depends firefox | awk '/Depends:/{print$2}' ` -qqy \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean\n#  ===================================================\n#   Run the following commands as non-privileged user\n#  ===================================================\nUSER seluser\n#  --- Nightly\n#   ENV FF_VER=\"52.0a0\" \\\n#       FF_PLATFORM=\"linux-i686\" \\\n#       FF_INNER_PATH=\"firefox/nightly/latest-mozilla-central\"\n#   ENV FF_COMP=\"firefox-${FF_VER}.${FF_LANG}.${FF_PLATFORM}.tar.bz2\"\n#   ENV FF_URL=\"${FF_BASE_URL}/${FF_INNER_PATH}/${FF_COMP}\"\n#\n#   Where to find latest version:\n#    https://archive.mozilla.org/pub/mozilla.org/firefox/releases/latest/linux-x86_64/en-US/\n#    https://download-installer.cdn.mozilla.net/pub/mozilla.org/firefox/releases/latest/linux-x86_64/en-US/\n#    https://ftp.mozilla.org/pub/mozilla.org/firefox/releases/latest/linux-x86_64/en-US/\n#   e.g. 44.0 instead of latest\n#    https://archive.mozilla.org/pub/firefox/releases/44.0/linux-x86_64/en-US/firefox-44.0.tar.bz2\n#   FF_LANG can be either en-US // de // fr and so on\n#   Regarding the pip packages, see released versions at:\n#    https://github.com/mozilla/mozdownload/releases\n#  =============================\n#   sudo by default from now on\n#  =============================\nUSER root\nENV FF_LANG=\"en-US\" \\\n    FF_BASE_URL=\"https://archive.mozilla.org/pub\" \\\n    FF_PLATFORM=\"linux-x86_64\" \\\n    FF_INNER_PATH=\"firefox/releases\"\n#  --- For Selenium 3\n#   Layer size: big: 108.2 MB\nARG FF_VER=\"67.0\"\nENV FF_COMP=\"firefox-${FF_VER}.tar.bz2\"\nENV FF_URL=\"${FF_BASE_URL}/${FF_INNER_PATH}/${FF_VER}/${FF_PLATFORM}/${FF_LANG}/${FF_COMP}\"\nRUN cd /opt \\\n && wget -nv \"${FF_URL}\" -O \"firefox.tar.bz2\" \\\n && bzip2 -d \"firefox.tar.bz2\" \\\n && tar xf \"firefox.tar\" \\\n && rm \"firefox.tar\" \\\n && ln -fs /opt/firefox/firefox /usr/bin/firefox \\\n && chown -R seluser:seluser /opt/firefox \\\n && chmod -R 777 /opt/firefox\nLABEL selenium_firefox_version=\"\\\"${FF_VER}\\\"\"\n#  ============\n#   GeckoDriver\n#  ============\n#   Layer size: tiny: ~4 MB\nARG GECKOD_VER=\"0.24.0\"\nENV GECKOD_URL=\"https://github.com/mozilla/geckodriver/releases/download\"\nRUN wget --no-verbose -O geckodriver.tar.gz \"${GECKOD_URL}/v${GECKOD_VER}/geckodriver-v${GECKOD_VER}-linux64.tar.gz\" \\\n && rm -rf /opt/geckodriver* \\\n && tar -C /opt -xvzf geckodriver.tar.gz \\\n && chmod +x /opt/geckodriver \\\n && cp /opt/geckodriver /usr/bin/geckodriver \\\n && chown seluser:seluser /opt/geckodriver \\\n && chown seluser:seluser /usr/bin/geckodriver \\\n && rm geckodriver.tar.gz\nCOPY bin/fail /usr/bin/\n#  ===============\n#   Google Chrome\n#  ===============\n#   TODO: Use Google fingerprint to verify downloads\n#    https://www.google.de/linuxrepositories/\nARG EXPECTED_CHROME_VERSION=\"75.0.3770.80\"\nENV CHROME_URL=\"https://dl.google.com/linux/direct\" \\\n    CHROME_BASE_DEB_PATH=\"/home/seluser/chrome-deb/google-chrome\" \\\n    GREP_ONLY_NUMS_VER=\"[0-9.]{2,20}\"\nLABEL selenium_chrome_version=\"\\\"${EXPECTED_CHROME_VERSION}\\\"\"\n#   Layer size: huge: 196.3 MB\nRUN apt-get update -qqy \\\n && mkdir -p chrome-deb \\\n && wget -nv \"${CHROME_URL}/google-chrome-stable_current_amd64.deb\" -O \"./chrome-deb/google-chrome-stable_current_amd64.deb\" \\\n && apt-get install --no-install-recommends \"${CHROME_BASE_DEB_PATH}-stable_current_amd64.deb\" -qyy \\\n && rm \"${CHROME_BASE_DEB_PATH}-stable_current_amd64.deb\" \\\n && rm -rf ./chrome-deb \\\n && apt-get -qyy autoremove \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get -qyy clean \\\n && export CH_STABLE_VER=$( /usr/bin/google-chrome-stable --version | grep -iEo \"${GREP_ONLY_NUMS_VER}\" ;) \\\n && echo \"CH_STABLE_VER:'${CH_STABLE_VER}' vs EXPECTED_CHROME_VERSION:'${EXPECTED_CHROME_VERSION}'\" \\\n && [ \"${CH_STABLE_VER}\" = \"${EXPECTED_CHROME_VERSION}\" ] || fail\n#   We have a wrapper for /opt/google/chrome/google-chrome\nRUN mv /opt/google/chrome/google-chrome /opt/google/chrome/google-chrome-base\nCOPY selenium-node-chrome/opt /opt\nCOPY lib/* /usr/lib/\n#   Use a custom wallpaper for Fluxbox\nCOPY images/wallpaper-dosel.png /usr/share/images/fluxbox/ubuntu-light.png\nCOPY images/wallpaper-zalenium.png /usr/share/images/fluxbox/\nRUN chown -R seluser:seluser /usr/share/images/fluxbox/ \\\n && chmod -R 777 /usr/share/images/fluxbox\n#  ===================================================\n#   Run the following commands as non-privileged user\n#  ===================================================\nUSER seluser\n#  ==================\n#   Chrome webdriver\n#  ==================\n#   How to get cpu arch dynamically: $(lscpu | grep Architecture | sed \"s/^.*_//\")\nARG CHROME_DRIVER_VERSION=\"75.0.3770.8\"\nENV CHROME_DRIVER_BASE=\"chromedriver.storage.googleapis.com\" \\\n    CPU_ARCH=\"64\"\nENV CHROME_DRIVER_FILE=\"chromedriver_linux${CPU_ARCH}.zip\"\nENV CHROME_DRIVER_URL=\"https://${CHROME_DRIVER_BASE}/${CHROME_DRIVER_VERSION}/${CHROME_DRIVER_FILE}\"\n#   Gets latest chrome driver version. Or you can hard-code it, e.g. 2.15\n#   Layer size: small: 6.932 MB\nRUN wget -nv -O chromedriver_linux${CPU_ARCH}.zip ${CHROME_DRIVER_URL} \\\n && unzip chromedriver_linux${CPU_ARCH}.zip \\\n && rm chromedriver_linux${CPU_ARCH}.zip \\\n && mv chromedriver chromedriver-${CHROME_DRIVER_VERSION} \\\n && chmod 755 chromedriver-${CHROME_DRIVER_VERSION} \\\n && ln -s chromedriver-${CHROME_DRIVER_VERSION} chromedriver \\\n && sudo ln -s /home/seluser/chromedriver /usr/bin\n#  =================\n#   Supervisor conf\n#  =================\nCOPY supervisor/etc/supervisor/supervisord.conf /etc/supervisor/\nCOPY **/etc/supervisor/conf.d/* /etc/supervisor/conf.d/\n#  ===================\n#   DNS & hosts stuff\n#  ===================\nCOPY ./dns/etc/hosts /tmp/hosts\n#  ======\n#   Envs\n#  ======\nENV DEFAULT_SELENIUM_HUB_PORT=\"24444\" \\\n    DEFAULT_SELENIUM_NODE_CH_PORT=\"25550\" \\\n    DEFAULT_SELENIUM_NODE_FF_PORT=\"25551\" \\\n    DEFAULT_SELENIUM_MULTINODE_PORT=\"25552\" \\\n    DEFAULT_VNC_PORT=\"25900\" \\\n    DEFAULT_NOVNC_PORT=\"26080\" \\\n    DEFAULT_SUPERVISOR_HTTP_PORT=\"19001\"\n#   Commented for now; all these versions are still available at\n#     https://github.com/elgalu/docker-selenium/releases/tag/2.47.1m\n#   CHROME_FLAVOR \"stable\"\n#     Default chrome flavor, options no longer available: beta|unstable\n#   PICK_ALL_RANDOM_PORTS \"true\" / \"false\"\n#     Randomize all ports, i.e. pick unused unprivileged ones\n#   RANDOM_PORT_FROM\n#   RANDOM_PORT_TO\n#     When using PICK_ALL_RANDOM_PORTS=true the ports will\n#     be from a range to avoid collisions\n#   MEM_JAVA_PERCENT \"80\"\n#     Because the JVM uses only 1/4 of system memory by default\n#   WAIT_FOREGROUND_RETRY\n#   WAIT_VNC_FOREGROUND_RETRY\n#     Max amount of time to wait on Xvfb or Xmanager while retrying\n#   XVFB_STARTRETRIES\n#   XMANAGER\n#     We used to support 2 X managers: fluxbox | openbox\n#     But after version 3.0.1 we only support fluxbox\n#     to save disk space\n#   XMANAGER_STARTRETRIES\n#   XMANAGER_STARTSECS\n#     Supervisor processes retry attemps (0 means do not retry)\n#   WAIT_TIMEOUT\n#     Max amount of time to wait for other processes dependencies\n#   DISP_N\n#     Display number; see entry.sh for $DISPLAY\n#   MAX_DISPLAY_SEARCH\n#     Maximum searches for a free DISPLAY number\n#   SELENIUM_HUB_PORT\n#     Even though you can change them below, don't worry too much about container\n#     internal ports since you can map them to the host via `docker run -p`\n#   SELENIUM_HUB_PROTO\n#   SELENIUM_HUB_HOST\n#   SELENIUM_NODE_HOST\n#     You may want to connect to another hub\n#   SELENIUM_HUB_PARAMS\n#   SELENIUM_NODE_PARAMS\n#   SELENIUM_NODE_PROXY_PARAMS\n#     Selenium additional params:\n#   CHROME_ARGS\n#     \"--no-sandbox --disable-gpu\" To taggle issue #58 see https://goo.gl/fz6RTu\n#     more: \"--ignore-certificate-errors\"\n#   CHROME_VERBOSELOGGING\n#     Will be passed with: -Dwebdriver.chrome.verboseLogging\n#       SELENIUM_NODE_CHROME_PARAMS='-Dselenium.chrome.args=\"--no-sandbox\"' \\\n#       WEBDRIVER_NODE_CHROME_PARAMS='-Dwebdriver.chrome.args=\"--no-sandbox\"' \\\n#       Selenium capabilities descriptive (to avoid opera/ie warnings)\n#        docs at https://code.google.com/p/selenium/wiki/Grid2\n#   SEL_RELEASE_TIMEOUT_SECS\n#     -timeout AKA GRID_TIMEOUT TODO fix with, ping @allanatadministrate\n#     https://github.com/SeleniumHQ/docker-selenium/pull/393\n#   SEL_BROWSER_TIMEOUT_SECS\n#   SELENIUM_NODE_REGISTER_CYCLE\n#     How often in ms the node will try to register itself again.\n#     Allow to restart the hub without having to restart the nodes.\n#      (node) in ms. Selenium default: 5000\n#   SEL_CLEANUPCYCLE_MS\n#     How often a proxy will check for timed out thread.\n#      (node) in ms. Selenium default: 5000\n#   SEL_NODEPOLLING_MS\n#     Interval between alive checks of node how often the hub checks if the node is still alive.\n#      (node) in ms. Selenium default: 5000\n#   SEL_UNREGISTER_IF_STILL_DOWN_AFTER\n#     If the node remains down for more than unregisterIfStillDownAfter millisec\n#      it will disappear from the hub. in ms. Default: 1min\n#   no_proxy\n#   HUB_ENV_no_proxy\n#     Docker for Mac beta - containers do not start #227\n#   VNC_FROM_PORT\n#   VNC_TO_PORT\n#     We need a fixed port range to expose VNC due to a bug in Docker for Mac beta (1.12)\n#     https://forums.docker.com/t/docker-for-mac-beta-not-forwarding-ports/8658/6\n#   VNC_CLI_OPTS\n#     e.g. VNC_CLI_OPTS=\"-noipv6 -no6 -forever -shared\"\n#     e.g. VNC_CLI_OPTS=\"-forever -shared\"\n#   VNC_PASSWORD\n#     - \"no\" means no password; less secure but not a big deal\n#     - \"\" (empty string) means it will be randomly generated\n#     - \"some-value\" will use that password \"some-value\" or whatever\n#   LOG_LEVEL\n#     Supervisor loglevel and also general docker log level\n#     can be: debug, warn, trace, info\n#   DISABLE_ROLLBACK\n#     When DISABLE_ROLLBACK=true it will:\n#      - output logs\n#      - exec bash to permit troubleshooting\n#   LOGS_DIR\n#     Logs are now managed by supervisord.conf, see\n#      ${LOGS_DIR}/*.log\n#   FFMPEG_FRAME_RATE\n#     ffmpeg encoding options\n#   FFMPEG_CODEC_ARGS\n#     Video size can be lowered down via re-encoding, see\n#      http://askubuntu.com/a/365221/134645\n#   FFMPEG_DRAW_MOUSE\n#      Specify whether to draw the mouse pointer. Default: 1\n#   VIDEO GRID CHROME FIREFOX RC_CHROME RC_FIREFOX\n#     true/false which services should start upon docker run\n#   VIDEO_FILE_EXTENSION\n#     Video file and extension, e.g. mp4, mkv\n#   TAIL_LOG_LINES\n#     Amount of lines to display when startup errors\n#   SHM_TRY_MOUNT_UNMOUNT\n#     Fix small tiny 64mb shm issue\n#   ETHERNET_DEVICE_NAME\n#     When docker run --net=host the network name may be different\n#   XMANAGER_STOP_SIGNAL\n#   XVFB_STOP_SIGNAL\n#   XTERM_START\n#    Wheather to start an xterm in the windows manager. For debugging.\n#   XTERM_STOP_SIGNAL\n#   SELENIUM_NODE_FIREFOX_STOP_SIGNAL\n#   SELENIUM_NODE_CHROME_STOP_SIGNAL\n#   SELENIUM_MULTINODE_STOP_SIGNAL\n#   SELENIUM_HUB_STOP_SIGNAL\n#   VNC_STOP_SIGNAL\n#   NOVNC_STOP_SIGNAL\n#   VIDEO_REC_STOP_SIGNAL\n#   DOCKER_SOCK\n#     Run docker from inside docker\n#     Usage: docker run -v /var/run/docker.sock:/var/run/docker.sock\n#                       -v $(which docker):/usr/bin/docker\n#   TEST_SLEEPS\n#     Used internally due to flaky tests, should be removed in the future\n#   SEND_ANONYMOUS_USAGE_INFO\n#   GA_TRACKING_ID\n#   GA_ENDPOINT\n#   GA_API_VERSION\n#     All Google Analytics related, see LICENSE.md & Analytics.md for more info\nENV FIREFOX_VERSION=\"${FF_VER}\" \\\n    USE_SELENIUM=\"3\" \\\n    CHROME_FLAVOR=\"stable\" \\\n    DEBUG=\"false\" \\\n    PICK_ALL_RANDOM_PORTS=\"false\" \\\n    RANDOM_PORT_FROM=\"23100\" \\\n    RANDOM_PORT_TO=\"29999\" \\\n    USER=\"seluser\" \\\n    HOME=\"/home/seluser\" \\\n    VNC_STORE_PWD_FILE=\"/home/seluser/.vnc/passwd\" \\\n    BIN_UTILS=\"/usr/bin\" \\\n    MEM_JAVA_PERCENT=\"80\" \\\n    WAIT_FOREGROUND_RETRY=\"2s\" \\\n    WAIT_VNC_FOREGROUND_RETRY=\"6s\" \\\n    XVFB_STARTRETRIES=\"0\" \\\n    XMANAGER_STARTSECS=\"2\" \\\n    XMANAGER_STARTRETRIES=\"3\" \\\n    WAIT_TIMEOUT=\"45s\" \\\n    SCREEN_WIDTH=\"1900\" \\\n    SCREEN_HEIGHT=\"1880\" \\\n    SCREEN_MAIN_DEPTH=\"24\" \\\n    SCREEN_SUB_DEPTH=\"32\" \\\n    DISP_N=\"-1\" \\\n    MAX_DISPLAY_SEARCH=\"99\" \\\n    SCREEN_NUM=\"0\" \\\n    SELENIUM_HUB_PORT=\"${DEFAULT_SELENIUM_HUB_PORT}\" \\\n    SELENIUM_HUB_PROTO=\"http\" \\\n    SELENIUM_HUB_HOST=\"127.0.0.1\" \\\n    SELENIUM_NODE_HOST=\"0.0.0.0\" \\\n    SELENIUM_NODE_CH_PORT=\"${DEFAULT_SELENIUM_NODE_CH_PORT}\" \\\n    SELENIUM_NODE_FF_PORT=\"${DEFAULT_SELENIUM_NODE_FF_PORT}\" \\\n    SELENIUM_MULTINODE_PORT=\"${DEFAULT_SELENIUM_MULTINODE_PORT}\" \\\n    SELENIUM_HUB_PARAMS=\"\" \\\n    SELENIUM_NODE_PARAMS=\"\" \\\n    SELENIUM_NODE_PROXY_PARAMS=\"\" \\\n    CHROME_ARGS=\"--no-sandbox --disable-setuid-sandbox --disable-gpu --disable-infobars\" \\\n    CHROME_ADDITIONAL_ARGS=\"\" \\\n    CHROME_VERBOSELOGGING=\"true\" \\\n    MAX_INSTANCES=\"1\" \\\n    MAX_SESSIONS=\"1\" \\\n    SEL_RELEASE_TIMEOUT_SECS=\"19000\" \\\n    SEL_BROWSER_TIMEOUT_SECS=\"16000\" \\\n    SELENIUM_NODE_REGISTER_CYCLE=\"5000\" \\\n    SEL_CLEANUPCYCLE_MS=\"5000\" \\\n    SEL_NODEPOLLING_MS=\"5000\" \\\n    SEL_UNREGISTER_IF_STILL_DOWN_AFTER=\"2500\" \\\n    no_proxy=\"localhost\" \\\n    HUB_ENV_no_proxy=\"localhost\" \\\n    XVFB_CLI_OPTS_TCP=\"-nolisten tcp -nolisten inet6\" \\\n    XVFB_CLI_OPTS_BASE=\"-ac -r -cc 4 -accessx -xinerama\" \\\n    XVFB_CLI_OPTS_EXT=\"+extension Composite +extension RANDR +extension GLX\" \\\n    VNC_START=\"true\" \\\n    VNC_PORT=\"${DEFAULT_VNC_PORT}\" \\\n    VNC_FROM_PORT=\"\" \\\n    VNC_TO_PORT=\"\" \\\n    VNC_CLI_OPTS=\"-forever -shared\" \\\n    VNC_PASSWORD=\"no\" \\\n    NOVNC_PORT=\"${DEFAULT_NOVNC_PORT}\" \\\n    NOVNC=\"false\" \\\n    NOVNC_WAIT_TIMEOUT=\"5s\" \\\n    SUPERVISOR_HTTP_PORT=\"${DEFAULT_SUPERVISOR_HTTP_PORT}\" \\\n    SUPERVISOR_HTTP_USERNAME=\"supervisorweb\" \\\n    SUPERVISOR_HTTP_PASSWORD=\"somehttpbasicauthpwd\" \\\n    SUPERVISOR_REQUIRED_SRV_LIST=\"xmanager\" \\\n    SUPERVISOR_NOT_REQUIRED_SRV_LIST1=\"ignoreMe\" \\\n    SUPERVISOR_NOT_REQUIRED_SRV_LIST2=\"ignoreMe\" \\\n    SLEEP_SECS_AFTER_KILLING_SUPERVISORD=\"3\" \\\n    SUPERVISOR_STOPWAITSECS=\"20\" \\\n    SUPERVISOR_STOPSIGNAL=\"TERM\" \\\n    SUPERVISOR_KILLASGROUP=\"false\" \\\n    SUPERVISOR_STOPASGROUP=\"false\" \\\n    LOG_LEVEL=\"info\" \\\n    DISABLE_ROLLBACK=\"false\" \\\n    LOGFILE_MAXBYTES=\"10MB\" \\\n    LOGFILE_BACKUPS=\"5\" \\\n    LOGS_DIR=\"/var/log/cont\" \\\n    VIDEO=\"false\" \\\n    GRID=\"true\" \\\n    CHROME=\"true\" \\\n    FIREFOX=\"true\" \\\n    MULTINODE=\"false\" \\\n    FFMPEG_FRAME_RATE=\"10\" \\\n    FFMPEG_CODEC_ARGS=\"-vcodec libx264 -preset ultrafast -pix_fmt yuv420p\" \\\n    FFMPEG_FINAL_CRF=\"0\" \\\n    FFMPEG_DRAW_MOUSE=\"1\" \\\n    VIDEO_TMP_FILE_EXTENSION=\"mkv\" \\\n    VIDEO_FILE_EXTENSION=\"mp4\" \\\n    MP4_INTERLEAVES_MEDIA_DATA_CHUNKS_SECS=\"500\" \\\n    VIDEO_FILE_NAME=\"\" \\\n    VIDEO_BEFORE_STOP_SLEEP_SECS=\"1\" \\\n    VIDEO_AFTER_STOP_SLEEP_SECS=\"0.5\" \\\n    VIDEO_STOPWAITSECS=\"50\" \\\n    VIDEO_CONVERSION_MAX_WAIT=\"20s\" \\\n    VIDEO_MP4_FIX_MAX_WAIT=\"8s\" \\\n    VIDEO_WAIT_VID_TOOL_PID_1st_sig_UP_TO_SECS=\"6s\" \\\n    VIDEO_WAIT_VID_TOOL_PID_2nd_sig_UP_TO_SECS=\"2s\" \\\n    VIDEO_WAIT_VID_TOOL_PID_3rd_sig_UP_TO_SECS=\"1s\" \\\n    VIDEO_STOP_1st_sig_TYPE=\"SIGTERM\" \\\n    VIDEO_STOP_2nd_sig_TYPE=\"SIGINT\" \\\n    VIDEO_STOP_3rd_sig_TYPE=\"SIGKILL\" \\\n    WAIT_TIME_OUT_VIDEO_STOP=\"20s\" \\\n    VIDEOS_DIR=\"/home/seluser/videos\" \\\n    XMANAGER=\"fluxbox\" \\\n    FLUXBOX_START_MAX_RETRIES=\"5\" \\\n    TAIL_LOG_LINES=\"50\" \\\n    SHM_TRY_MOUNT_UNMOUNT=\"false\" \\\n    SHM_SIZE=\"512M\" \\\n    ETHERNET_DEVICE_NAME=\"eth0\" \\\n    XMANAGER_STOP_SIGNAL=\"TERM\" \\\n    XVFB_STOP_SIGNAL=\"TERM\" \\\n    XTERM_START=\"false\" \\\n    XTERM_STOP_SIGNAL=\"INT\" \\\n    SELENIUM_NODE_FIREFOX_STOP_SIGNAL=\"TERM\" \\\n    SELENIUM_NODE_CHROME_STOP_SIGNAL=\"TERM\" \\\n    SELENIUM_MULTINODE_STOP_SIGNAL=\"TERM\" \\\n    SELENIUM_HUB_STOP_SIGNAL=\"TERM\" \\\n    VNC_STOP_SIGNAL=\"TERM\" \\\n    NOVNC_STOP_SIGNAL=\"TERM\" \\\n    VIDEO_REC_STOP_SIGNAL=\"INT\" \\\n    DOCKER_SOCK=\"/var/run/docker.sock\" \\\n    TEST_SLEEPS=\"0.1\" \\\n    ZALENIUM=\"false\" \\\n    SEND_ANONYMOUS_USAGE_INFO=\"true\" \\\n    GA_TRACKING_ID=\"UA-18144954-9\" \\\n    GA_ENDPOINT=\"https://www.google-analytics.com/collect\" \\\n    GA_API_VERSION=\"1\" \\\n    LD_LIBRARY_PATH=\"/usr/lib/x86_64-linux-gnu/\" \\\n    DEBIAN_FRONTEND=\"\" \\\n    USE_KUBERNETES=\"false\" \\\n    REMOVE_SELUSER_FROM_SUDOERS_FOR_TESTING=\"false\" \\\n    DEBCONF_NONINTERACTIVE_SEEN=\"\"\n#  ================================\n#   Expose Container's Directories\n#  ================================\n#   VOLUME ${LOGS_DIR}\n#   Removed HEALTHCHECK because is providing no value to us but\n#   rather problems. When Zalenium starts N containers at the some time\n#   the --interval will make docker check the health of all of them\n#   at the same time and this causes an unnecessary CPU overhead.\n#   HEALTHCHECK --interval=2m --timeout=50s --retries=2 \\\n#     CMD wait_all_done 30s\n#  ================\n#   Binary scripts\n#  ================\nCOPY bin/* ${BIN_UTILS}/\nCOPY **/bin/* ${BIN_UTILS}/\nCOPY host-scripts/* /host-scripts/\nCOPY test/* /test/\nCOPY test/run_test.sh /usr/bin/run_test\nCOPY test/selenium_test.sh /usr/bin/selenium_test\nCOPY test/python_test.py /usr/bin/python_test\nCOPY images ./images\nCOPY LICENSE.md /home/seluser/\nCOPY Analytics.md /home/seluser/\n#   Include current version\nCOPY GLOBAL_PATCH_LEVEL.txt /home/seluser/\nRUN echo \"${SEL_VER}-$( cat GLOBAL_PATCH_LEVEL.txt ;)\" > /home/seluser/VERSION\n#   Moved from entry.sh\nENV SUPERVISOR_PIDFILE=\"${RUN_DIR}/supervisord.pid\" \\\n    DOCKER_SELENIUM_STATUS=\"${LOGS_DIR}/docker-selenium-status.log\" \\\n    VNC_TRYOUT_ERR_LOG=\"${LOGS_DIR}/vnc-tryouts-stderr\" \\\n    VNC_TRYOUT_OUT_LOG=\"${LOGS_DIR}/vnc-tryouts-stdout\"\n#  ===================================\n#   Fix dirs (again) and final chores\n#  ===================================\n#   The .X11-unix stuff is useful when using Xephyr\nRUN mkdir -p /home/seluser/.vnc \\\n && sudo touch /capabilities.json \\\n && sudo chown seluser:seluser /capabilities.json \\\n && generate_capabilities_json > /capabilities.json \\\n && cp /capabilities.json /home/seluser/capabilities.json \\\n && cp /capabilities.json /home/seluser/capabilities \\\n && cp /capabilities.json /home/seluser/caps.json \\\n && cp /capabilities.json /home/seluser/caps \\\n && mkdir -p ${VIDEOS_DIR} \\\n && sudo ln -s ${VIDEOS_DIR} /videos \\\n && sudo mkdir -p ${LOGS_DIR} \\\n && sudo mkdir -p ${RUN_DIR} \\\n && sudo mkdir -p /tmp/.X11-unix /tmp/.ICE-unix \\\n && sudo fixperms.sh \\\n && echo \"\"\n#  =====================================================\n#   Meta JSON file to hold commit info of current build\n#  =====================================================\nCOPY scm-source.json /\n#   Ensure the file is up-to-date else you should update it by running\n#    ./host-scripts/gen-scm-source.sh\n#   on the host machine\n#  ==================\n#   ENTRYPOINT & CMD\n#  ==================\n#   IMPORTANT: Using the string form `CMD \"entry.sh\"` without\n#   brackets [] causes Docker to run your process\n#   And using `bash` which doesn’t handle signals properly\nCMD [\"entry.sh\"]\n","originalDockerfileUglifiedHash":"834cd6368afe0558dac9d1c34113018b","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/ef443c637bc6863efdb74572c10b64ff7192ec61.dockerfile"}