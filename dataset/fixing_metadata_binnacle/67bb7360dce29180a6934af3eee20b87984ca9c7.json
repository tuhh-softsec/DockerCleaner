{"seed":2441697340,"processedDockerfileHash":"cb0a58a036bbd1ceda382d9657907d6f","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["pin-package-manager-versions-pip","pin-package-manager-versions-npm","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"FROM centos:centos6.9\nMAINTAINER pinguoops <pinguo-ops@camera360.com>\n#   -----------------------------------------------------------------------------\n#   Make src dir\n#   -----------------------------------------------------------------------------\nENV HOME=\"/home/worker\"\nENV SRC_DIR=\"$HOME/src\"\nRUN mkdir -p ${SRC_DIR}\n#  ADD src ${SRC_DIR}\n#   -----------------------------------------------------------------------------\n#   Install Development tools\n#   -----------------------------------------------------------------------------\nRUN rpm --import /etc/pki/rpm-gpg/RPM* \\\n && curl --silent --location https://raw.githubusercontent.com/nodesource/distributions/master/rpm/setup_6.x | bash - \\\n && yum -y update \\\n && yum groupinstall -y \"Development tools\" \\\n && yum install -y gcc-c++ zlib-devel bzip2-devel openssl openssl-devel ncurses-devel sqlite-devel wget \\\n && rm -rf /var/cache/{yum,ldconfig}/* \\\n && rm -rf /etc/ld.so.cache \\\n && yum clean all\n#   -----------------------------------------------------------------------------\n#   Update Python to 2.7.x\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O Python-2.7.13.tgz http://mirrors.sohu.com/python/2.7.13/Python-2.7.13.tgz \\\n && tar zxf Python-2.7.13.tgz \\\n && cd Python-2.7.13 \\\n && ./configure \\\n && make \\\n && make install \\\n && mv /usr/bin/python /usr/bin/python.old \\\n && rm -f /usr/bin/python-config \\\n && ln -s /usr/local/bin/python /usr/bin/python \\\n && ln -s /usr/local/bin/python-config /usr/bin/python-config \\\n && ln -s /usr/local/include/python2.7/ /usr/include/python2.7 \\\n && wget https://bootstrap.pypa.io/ez_setup.py -O - | python \\\n && easy_install pip \\\n && sed -in-place '1s%.*%#!/usr/bin/python2.6%' /usr/bin/yum \\\n && cp -r /usr/lib/python2.6/site-packages/yum /usr/local/lib/python2.7/site-packages/ \\\n && cp -r /usr/lib/python2.6/site-packages/rpmUtils /usr/local/lib/python2.7/site-packages/ \\\n && cp -r /usr/lib/python2.6/site-packages/iniparse /usr/local/lib/python2.7/site-packages/ \\\n && cp -r /usr/lib/python2.6/site-packages/urlgrabber /usr/local/lib/python2.7/site-packages/ \\\n && cp -r /usr/lib64/python2.6/site-packages/rpm /usr/local/lib/python2.7/site-packages/ \\\n && cp -r /usr/lib64/python2.6/site-packages/curl /usr/local/lib/python2.7/site-packages/ \\\n && cp -p /usr/lib64/python2.6/site-packages/pycurl.so /usr/local/lib/python2.7/site-packages/ \\\n && cp -p /usr/lib64/python2.6/site-packages/_sqlitecache.so /usr/local/lib/python2.7/site-packages/ \\\n && cp -p /usr/lib64/python2.6/site-packages/sqlitecachec.py /usr/local/lib/python2.7/site-packages/ \\\n && cp -p /usr/lib64/python2.6/site-packages/sqlitecachec.pyc /usr/local/lib/python2.7/site-packages/ \\\n && cp -p /usr/lib64/python2.6/site-packages/sqlitecachec.pyo /usr/local/lib/python2.7/site-packages/ \\\n && rm -rf ${SRC_DIR}/Python*\n#   -----------------------------------------------------------------------------\n#   Devel libraries for delelopment tools like php & nginx ...\n#   -----------------------------------------------------------------------------\nRUN yum -y install tar gzip bzip2 unzip file perl-devel perl-ExtUtils-Embed pcre openssh-server openssh sudo screen vim git telnet expat lemon net-snmp net-snmp-devel ca-certificates perl-CPAN m4 gd libjpeg libpng zlib libevent net-snmp net-snmp-devel net-snmp-libs freetype libtool-tldl libxml2 unixODBC libxslt libmcrypt freetds gd-devel libjpeg-devel libpng-devel zlib-devel freetype-devel libtool-ltdl libtool-ltdl-devel libxml2-devel zlib-devel bzip2-devel gettext-devel curl-devel gettext-devel libevent-devel libxslt-devel expat-devel unixODBC-devel openssl-devel libmcrypt-devel freetds-devel pcre-devel openldap openldap-devel libc-client-devel jemalloc jemalloc-devel inotify-tools nodejs apr-util yum-utils tree \\\n && ln -s /usr/lib64/libc-client.so /usr/lib/libc-client.so \\\n && rm -rf /var/cache/{yum,ldconfig}/* \\\n && rm -rf /etc/ld.so.cache \\\n && yum clean all\n#   -----------------------------------------------------------------------------\n#   Install supervisor and distribute ...\n#   -----------------------------------------------------------------------------\nRUN pip install supervisor==4.2.5 distribute==0.7.3 \\\n && rm -rf /tmp/*\n#   -----------------------------------------------------------------------------\n#   Configure, timezone/sshd/passwd/networking\n#   -----------------------------------------------------------------------------\nRUN ln -sf /usr/share/zoneinfo/Asia/Chongqing /etc/localtime \\\n && sed -i -e 's/^UsePAM yes/#UsePAM yes/g' -e 's/^#UsePAM no/UsePAM no/g' -e 's/#UsePrivilegeSeparation.*/UsePrivilegeSeparation no/g' -e 's/^#UseDNS yes/UseDNS no/g' /etc/ssh/sshd_config \\\n && echo \"root\" | passwd --stdin root \\\n && ssh-keygen -q -b 1024 -N '' -t rsa -f /etc/ssh/ssh_host_rsa_key \\\n && ssh-keygen -q -b 1024 -N '' -t dsa -f /etc/ssh/ssh_host_dsa_key \\\n && echo \"NETWORKING=yes\" > /etc/sysconfig/network\n#   -----------------------------------------------------------------------------\n#   Install curl\n#   -----------------------------------------------------------------------------\nENV CURL_INSTALL_DIR=\"${HOME}/libcurl\"\nRUN cd ${SRC_DIR} \\\n && wget -q -O curl-7.55.1.tar.gz http://curl.askapache.com/download/curl-7.55.1.tar.gz \\\n && tar xzf curl-7.55.1.tar.gz \\\n && cd curl-7.55.1 \\\n && ./configure --prefix=${CURL_INSTALL_DIR} \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/curl*\n#   -----------------------------------------------------------------------------\n#   Install Nginx\n#   -----------------------------------------------------------------------------\nENV nginx_version=\"1.12.2\"\nENV NGINX_INSTALL_DIR=\"${HOME}/nginx\"\nRUN cd ${SRC_DIR} \\\n && wget -q -O nginx-${nginx_version}.tar.gz http://nginx.org/download/nginx-${nginx_version}.tar.gz \\\n && wget -q -O nginx-http-concat.zip https://github.com/alibaba/nginx-http-concat/archive/master.zip \\\n && wget -q -O nginx-logid.zip https://github.com/pinguo-liuzhaohui/nginx-logid/archive/master.zip \\\n && wget -q -O ngx_devel_kit-0.3.0.tar.gz https://github.com/simpl/ngx_devel_kit/archive/v0.3.0.tar.gz \\\n && wget -q -O lua-nginx-module-0.10.11.tar.gz https://github.com/openresty/lua-nginx-module/archive/v0.10.11.tar.gz \\\n && wget -q -O LuaJIT-2.0.5.tar.gz http://luajit.org/download/LuaJIT-2.0.5.tar.gz \\\n && tar zxf nginx-${nginx_version}.tar.gz \\\n && unzip nginx-http-concat.zip -d nginx-http-concat \\\n && unzip nginx-logid.zip -d nginx-logid \\\n && tar zxf ngx_devel_kit-0.3.0.tar.gz \\\n && tar zxf lua-nginx-module-0.10.11.tar.gz \\\n && tar zxf LuaJIT-2.0.5.tar.gz \\\n && cd LuaJIT-2.0.5 \\\n && make PREFIX=${HOME}/LuaJIT-2.0.5 1> /dev/null \\\n && make install PREFIX=${HOME}/LuaJIT-2.0.5 \\\n && cd ${HOME} \\\n && ln -s LuaJIT-2.0.5 luajit \\\n && export LUAJIT_LIB=${HOME}/luajit/lib \\\n && export LUAJIT_INC=${HOME}/luajit/include/luajit-2.0 \\\n && cd ${SRC_DIR}/nginx-${nginx_version} \\\n && ./configure --prefix=$NGINX_INSTALL_DIR --with-http_stub_status_module --with-http_ssl_module --add-module=../nginx-http-concat/nginx-http-concat-master --add-module=../nginx-logid/nginx-logid-master --with-ld-opt=\"-Wl,-rpath,${HOME}/luajit/lib\" --add-module=../ngx_devel_kit-0.3.0 --add-module=../lua-nginx-module-0.10.11 1> /dev/null \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/nginx-* ${SRC_DIR}/ngx_devel_kit* ${SRC_DIR}/lua-nginx-module* ${SRC_DIR}/LuaJIT*\n#   -----------------------------------------------------------------------------\n#   Install Redis\n#   -----------------------------------------------------------------------------\nENV redis_version=\"3.2.11\"\nENV REDIS_INSTALL_DIR=\"${HOME}/redis\"\nRUN cd ${SRC_DIR} \\\n && wget -q -O redis-${redis_version}.tar.gz http://download.redis.io/releases/redis-${redis_version}.tar.gz \\\n && tar xzf redis-${redis_version}.tar.gz \\\n && cd redis-${redis_version} \\\n && make 1> /dev/null \\\n && make PREFIX=$REDIS_INSTALL_DIR install \\\n && rm -rf ${SRC_DIR}/redis-*\n#   -----------------------------------------------------------------------------\n#   Install ImageMagick\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O ImageMagick.tar.gz https://www.imagemagick.org/download/ImageMagick.tar.gz \\\n && tar zxf ImageMagick.tar.gz \\\n && rm -rf ImageMagick.tar.gz \\\n && ImageMagickPath=`ls ` \\\n && cd ${ImageMagickPath} \\\n && ./configure \\\n && make \\\n && make install \\\n && rm -rf $SRC_DIR/ImageMagick*\n#   -----------------------------------------------------------------------------\n#   Install hiredis\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O hiredis-0.13.3.tar.gz https://github.com/redis/hiredis/archive/v0.13.3.tar.gz \\\n && tar zxvf hiredis-0.13.3.tar.gz \\\n && cd hiredis-0.13.3 \\\n && make \\\n && make install \\\n && echo \"/usr/local/lib\" > /etc/ld.so.conf.d/local.conf \\\n && ldconfig \\\n && rm -rf $SRC_DIR/hiredis-*\n#   -----------------------------------------------------------------------------\n#   Install libmemcached using by php-memcached\n#   -----------------------------------------------------------------------------\nENV LIB_MEMCACHED_INSTALL_DIR=\"/usr/local/\"\nRUN cd ${SRC_DIR} \\\n && wget -q -O libmemcached-1.0.18.tar.gz https://launchpad.net/libmemcached/1.0/1.0.18/+download/libmemcached-1.0.18.tar.gz \\\n && tar xzf libmemcached-1.0.18.tar.gz \\\n && cd libmemcached-1.0.18 \\\n && ./configure --prefix=$LIB_MEMCACHED_INSTALL_DIR --with-memcached 1> /dev/null \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/libmemcached*\n#   -----------------------------------------------------------------------------\n#   Install libmcrypt using by php-mcrypt\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O libmcrypt-2.5.8.tar.gz https://nchc.dl.sourceforge.net/project/mcrypt/Libmcrypt/2.5.8/libmcrypt-2.5.8.tar.gz \\\n && tar xzf libmcrypt-2.5.8.tar.gz \\\n && cd libmcrypt-2.5.8 \\\n && ./configure 1> /dev/null \\\n && make 1> /dev/null \\\n && make install \\\n && echo \"/usr/local/lib64\" >> /etc/ld.so.conf.d/local.conf \\\n && echo \"/usr/local/src/libmcrypt-2.5.8/lib/.libs\" >> /etc/ld.so.conf.d/local.conf \\\n && chmod gu+x /etc/ld.so.conf.d/local.conf \\\n && ldconfig -v\n#   -----------------------------------------------------------------------------\n#   Install re2c for PHP\n#   -----------------------------------------------------------------------------\nRUN cd $SRC_DIR \\\n && wget -q -O re2c-1.0.tar.gz https://excellmedia.dl.sourceforge.net/project/re2c/old/re2c-1.0.tar.gz \\\n && tar xzf re2c-1.0.tar.gz \\\n && cd re2c-1.0 \\\n && ./configure \\\n && make \\\n && make install \\\n && rm -rf ${SRC_DIR}/re2c*\n#   -----------------------------------------------------------------------------\n#   Install PHP\n#   -----------------------------------------------------------------------------\nENV phpversion=\"7.1.9\"\nENV PHP_INSTALL_DIR=\"${HOME}/php\"\nRUN cd ${SRC_DIR} \\\n && ls -l \\\n && wget -q -O php-${phpversion}.tar.gz http://cn2.php.net/distributions/php-${phpversion}.tar.gz \\\n && tar xzf php-${phpversion}.tar.gz \\\n && cd php-${phpversion} \\\n && ./configure --prefix=${PHP_INSTALL_DIR} --with-config-file-path=${PHP_INSTALL_DIR}/etc --with-config-file-scan-dir=${PHP_INSTALL_DIR}/etc/php.d --sysconfdir=${PHP_INSTALL_DIR}/etc --with-libdir=lib64 --enable-mysqlnd --enable-zip --enable-exif --enable-ftp --enable-mbstring --enable-mbregex --enable-fpm --enable-bcmath --enable-pcntl --enable-soap --enable-sockets --enable-shmop --enable-sysvmsg --enable-sysvsem --enable-sysvshm --enable-gd-native-ttf --enable-wddx --enable-opcache --with-gettext --with-xsl --with-libexpat-dir --with-xmlrpc --with-snmp --with-ldap --enable-mysqlnd --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd --with-pdo-odbc=unixODBC,/usr --with-gd --with-jpeg-dir --with-png-dir --with-zlib-dir --with-freetype-dir --with-zlib --with-bz2 --with-openssl --with-curl=${CURL_INSTALL_DIR} --with-mcrypt --with-mhash \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${PHP_INSTALL_DIR}/lib/php.ini \\\n && cp -f php.ini-development ${PHP_INSTALL_DIR}/lib/php.ini \\\n && rm -rf ${SRC_DIR}/php* ${SRC_DIR}/libmcrypt*\n#   -----------------------------------------------------------------------------\n#   Install yaml and PHP yaml extension\n#   -----------------------------------------------------------------------------\nRUN cd $SRC_DIR \\\n && wget -q -O yaml-0.1.7.tar.gz http://pyyaml.org/download/libyaml/yaml-0.1.7.tar.gz \\\n && tar xzf yaml-0.1.7.tar.gz \\\n && cd yaml-0.1.7 \\\n && ./configure --prefix=/usr/local \\\n && make > /dev/null \\\n && make install \\\n && cd $SRC_DIR \\\n && wget -q -O yaml-2.0.2.tgz https://pecl.php.net/get/yaml-2.0.2.tgz \\\n && tar xzf yaml-2.0.2.tgz \\\n && cd yaml-2.0.2 \\\n && $PHP_INSTALL_DIR/bin/phpize \\\n && ./configure --with-yaml=/usr/local --with-php-config=$PHP_INSTALL_DIR/bin/php-config \\\n && make > /dev/null \\\n && make install \\\n && rm -rf $SRC_DIR/yaml-*\n#   -----------------------------------------------------------------------------\n#   Install PHP mongodb extensions\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O mongodb-1.3.2.tgz https://pecl.php.net/get/mongodb-1.3.2.tgz \\\n && tar zxf mongodb-1.3.2.tgz \\\n && cd mongodb-1.3.2 \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --with-php-config=$PHP_INSTALL_DIR/bin/php-config 1> /dev/null \\\n && make clean \\\n && make \\\n && make install \\\n && rm -rf ${SRC_DIR}/mongodb-*\n#   -----------------------------------------------------------------------------\n#   -----------------------------------------------------------------------------\n#   Install PHP redis extensions\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O redis-3.1.3.tgz https://pecl.php.net/get/redis-3.1.3.tgz \\\n && tar zxf redis-3.1.3.tgz \\\n && cd redis-3.1.3 \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --with-php-config=$PHP_INSTALL_DIR/bin/php-config 1> /dev/null \\\n && make clean \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/redis-*\n#   -----------------------------------------------------------------------------\n#   Install PHP imagick extensions\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O imagick-3.4.3.tgz https://pecl.php.net/get/imagick-3.4.3.tgz \\\n && tar zxf imagick-3.4.3.tgz \\\n && cd imagick-3.4.3 \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --with-php-config=$PHP_INSTALL_DIR/bin/php-config --with-imagick 1> /dev/null \\\n && make clean \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/imagick-*\n#   -----------------------------------------------------------------------------\n#   Install PHP xdebug extensions\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O xdebug-2.5.5.tgz https://pecl.php.net/get/xdebug-2.5.5.tgz \\\n && tar zxf xdebug-2.5.5.tgz \\\n && cd xdebug-2.5.5 \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --with-php-config=$PHP_INSTALL_DIR/bin/php-config 1> /dev/null \\\n && make clean \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/xdebug-*\n#   -----------------------------------------------------------------------------\n#   Install PHP igbinary extensions\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O igbinary-2.0.1.tgz https://pecl.php.net/get/igbinary-2.0.1.tgz \\\n && tar zxf igbinary-2.0.1.tgz \\\n && cd igbinary-2.0.1 \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --with-php-config=$PHP_INSTALL_DIR/bin/php-config 1> /dev/null \\\n && make clean \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/igbinary-*\n#   -----------------------------------------------------------------------------\n#   Install PHP memcached extensions\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O memcached-3.0.3.tgz https://pecl.php.net/get/memcached-3.0.3.tgz \\\n && tar xzf memcached-3.0.3.tgz \\\n && cd memcached-3.0.3 \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --enable-memcached --with-php-config=$PHP_INSTALL_DIR/bin/php-config --with-libmemcached-dir=$LIB_MEMCACHED_INSTALL_DIR --disable-memcached-sasl 1> /dev/null \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/memcached-*\n#   -----------------------------------------------------------------------------\n#   Install PHP yac extensions\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O yac-2.0.2.tgz https://pecl.php.net/get/yac-2.0.2.tgz \\\n && tar zxf yac-2.0.2.tgz \\\n && cd yac-2.0.2 \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --with-php-config=$PHP_INSTALL_DIR/bin/php-config \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf $SRC_DIR/yac-*\n#   -----------------------------------------------------------------------------\n#   Install PHP swoole extensions\n#   -----------------------------------------------------------------------------\nENV swooleVersion=\"1.9.22\"\nRUN cd ${SRC_DIR} \\\n && wget -q -O swoole-${swooleVersion}.tar.gz https://github.com/swoole/swoole-src/archive/v${swooleVersion}.tar.gz \\\n && tar zxf swoole-${swooleVersion}.tar.gz \\\n && cd swoole-src-${swooleVersion}/ \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --with-php-config=$PHP_INSTALL_DIR/bin/php-config --enable-async-redis --enable-openssl \\\n && make clean 1> /dev/null \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/swoole*\n#   -----------------------------------------------------------------------------\n#   Install PHP inotify extensions\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O inotify-2.0.0.tgz https://pecl.php.net/get/inotify-2.0.0.tgz \\\n && tar zxf inotify-2.0.0.tgz \\\n && cd inotify-2.0.0 \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --with-php-config=$PHP_INSTALL_DIR/bin/php-config 1> /dev/null \\\n && make clean \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/inotify-*\n#   -----------------------------------------------------------------------------\n#   Install phpunit\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O phpunit.phar https://phar.phpunit.de/phpunit.phar \\\n && mv phpunit.phar ${PHP_INSTALL_DIR}/bin/phpunit \\\n && chmod +x ${PHP_INSTALL_DIR}/bin/phpunit\n#   -----------------------------------------------------------------------------\n#   Install php composer\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && curl -sS https://getcomposer.org/installer | $PHP_INSTALL_DIR/bin/php \\\n && chmod +x composer.phar \\\n && mv composer.phar ${PHP_INSTALL_DIR}/bin/composer\n#   -----------------------------------------------------------------------------\n#   Install PhpDocumentor\n#   -----------------------------------------------------------------------------\nRUN $PHP_INSTALL_DIR/bin/pear install -a PhpDocumentor\nRUN cd ${PHP_INSTALL_DIR} \\\n && bin/php bin/composer self-update \\\n && bin/pear install PHP_CodeSniffer-2.3.4 \\\n && rm -rf /tmp/*\n#   -----------------------------------------------------------------------------\n#   Install jq\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O jq-1.5.tar.gz https://github.com/stedolan/jq/archive/jq-1.5.tar.gz \\\n && tar zxf jq-1.5.tar.gz \\\n && cd jq-jq-1.5 \\\n && ./configure --disable-maintainer-mode \\\n && make \\\n && make install \\\n && rm -rf ${SRC_DIR}/jq-*\n#   -----------------------------------------------------------------------------\n#   Install Apache ab\n#   -----------------------------------------------------------------------------\nRUN cd ${HOME} \\\n && yum -y remove httpd \\\n && mkdir httpd \\\n && cd httpd \\\n && yumdownloader httpd-tools \\\n && rpm2cpio httpd-tools* | cpio -idmv \\\n && mkdir -p /home/worker/bin \\\n && mv ./usr/bin/ab /home/worker/bin \\\n && cd ${HOME} \\\n && rm -rf /home/worker/httpd\n#   -----------------------------------------------------------------------------\n#   Update Git\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && yum -y remove git subversion \\\n && wget -q -O git-2.14.1.tar.gz https://github.com/git/git/archive/v2.14.1.tar.gz \\\n && tar zxf git-2.14.1.tar.gz \\\n && cd git-2.14.1 \\\n && make configure \\\n && ./configure --without-iconv --prefix=/usr/local/ --with-curl=${CURL_INSTALL_DIR} \\\n && make \\\n && make install \\\n && rm -rf $SRC_DIR/git-2*\n#   -----------------------------------------------------------------------------\n#   Install Node and apidoc and nodemon\n#   -----------------------------------------------------------------------------\nRUN npm install apidoc@0.54.0 nodemon@2.0.22 -g\n#   -----------------------------------------------------------------------------\n#   Copy Config\n#   -----------------------------------------------------------------------------\nCOPY run.sh /\nCOPY config /home/worker/\n#   -----------------------------------------------------------------------------\n#   Add user worker\n#   -----------------------------------------------------------------------------\nRUN useradd -M -u 1000 worker \\\n && echo \"worker\" | passwd --stdin worker \\\n && echo 'worker ALL=(ALL) NOPASSWD: ALL' > /etc/sudoers.d/worker \\\n && sed -i -e 's/^#PermitRootLogin yes/PermitRootLogin no/g' -e 's/^PermitRootLogin yes/PermitRootLogin no/g' -e 's/^#PermitUserEnvironment no/PermitUserEnvironment yes/g' -e 's/^PermitUserEnvironment no/PermitUserEnvironment yes/g' /etc/ssh/sshd_config \\\n && chmod a+x /run.sh \\\n && chmod a+x ${PHP_INSTALL_DIR}/bin/checkstyle \\\n && chmod a+x ${PHP_INSTALL_DIR}/bin/mergeCoverReport\n#   -----------------------------------------------------------------------------\n#   clean tmp file\n#   -----------------------------------------------------------------------------\nRUN rm -rf ${SRC_DIR}/*\nRUN rm -rf /tmp/*\nENTRYPOINT [\"/run.sh\"]\nEXPOSE 22/tcp 80/tcp 443/tcp\nCMD [\"/usr/sbin/sshd\", \"-D\"]\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"FROM centos:centos6.9\nMAINTAINER pinguoops <pinguo-ops@camera360.com>\n#  -----------------------------------------------------------------------------\n#  Make src dir\n#  -----------------------------------------------------------------------------\nENV HOME=\"/home/worker\"\nENV SRC_DIR=\"$HOME/src\"\nRUN mkdir -p ${SRC_DIR}\n# ADD src ${SRC_DIR}\n#  -----------------------------------------------------------------------------\n#  Install Development tools\n#  -----------------------------------------------------------------------------\nRUN rpm --import /etc/pki/rpm-gpg/RPM* \\\n && curl --silent --location https://raw.githubusercontent.com/nodesource/distributions/master/rpm/setup_6.x | bash - \\\n && yum -y update \\\n && yum groupinstall -y \"Development tools\" \\\n && yum install -y gcc-c++ zlib-devel bzip2-devel openssl openssl-devel ncurses-devel sqlite-devel wget \\\n && rm -rf /var/cache/{yum,ldconfig}/* \\\n && rm -rf /etc/ld.so.cache \\\n && yum clean all\n#  -----------------------------------------------------------------------------\n#  Update Python to 2.7.x\n#  -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O Python-2.7.13.tgz http://mirrors.sohu.com/python/2.7.13/Python-2.7.13.tgz \\\n && tar zxf Python-2.7.13.tgz \\\n && cd Python-2.7.13 \\\n && ./configure \\\n && make \\\n && make install \\\n && mv /usr/bin/python /usr/bin/python.old \\\n && rm -f /usr/bin/python-config \\\n && ln -s /usr/local/bin/python /usr/bin/python \\\n && ln -s /usr/local/bin/python-config /usr/bin/python-config \\\n && ln -s /usr/local/include/python2.7/ /usr/include/python2.7 \\\n && wget https://bootstrap.pypa.io/ez_setup.py -O - | python \\\n && easy_install pip \\\n && sed -in-place '1s%.*%#!/usr/bin/python2.6%' /usr/bin/yum \\\n && cp -r /usr/lib/python2.6/site-packages/yum /usr/local/lib/python2.7/site-packages/ \\\n && cp -r /usr/lib/python2.6/site-packages/rpmUtils /usr/local/lib/python2.7/site-packages/ \\\n && cp -r /usr/lib/python2.6/site-packages/iniparse /usr/local/lib/python2.7/site-packages/ \\\n && cp -r /usr/lib/python2.6/site-packages/urlgrabber /usr/local/lib/python2.7/site-packages/ \\\n && cp -r /usr/lib64/python2.6/site-packages/rpm /usr/local/lib/python2.7/site-packages/ \\\n && cp -r /usr/lib64/python2.6/site-packages/curl /usr/local/lib/python2.7/site-packages/ \\\n && cp -p /usr/lib64/python2.6/site-packages/pycurl.so /usr/local/lib/python2.7/site-packages/ \\\n && cp -p /usr/lib64/python2.6/site-packages/_sqlitecache.so /usr/local/lib/python2.7/site-packages/ \\\n && cp -p /usr/lib64/python2.6/site-packages/sqlitecachec.py /usr/local/lib/python2.7/site-packages/ \\\n && cp -p /usr/lib64/python2.6/site-packages/sqlitecachec.pyc /usr/local/lib/python2.7/site-packages/ \\\n && cp -p /usr/lib64/python2.6/site-packages/sqlitecachec.pyo /usr/local/lib/python2.7/site-packages/ \\\n && rm -rf ${SRC_DIR}/Python*\n#  -----------------------------------------------------------------------------\n#  Devel libraries for delelopment tools like php & nginx ...\n#  -----------------------------------------------------------------------------\nRUN yum -y install tar gzip bzip2 unzip file perl-devel perl-ExtUtils-Embed pcre openssh-server openssh sudo screen vim git telnet expat lemon net-snmp net-snmp-devel ca-certificates perl-CPAN m4 gd libjpeg libpng zlib libevent net-snmp net-snmp-devel net-snmp-libs freetype libtool-tldl libxml2 unixODBC libxslt libmcrypt freetds gd-devel libjpeg-devel libpng-devel zlib-devel freetype-devel libtool-ltdl libtool-ltdl-devel libxml2-devel zlib-devel bzip2-devel gettext-devel curl-devel gettext-devel libevent-devel libxslt-devel expat-devel unixODBC-devel openssl-devel libmcrypt-devel freetds-devel pcre-devel openldap openldap-devel libc-client-devel jemalloc jemalloc-devel inotify-tools nodejs apr-util yum-utils tree \\\n && ln -s /usr/lib64/libc-client.so /usr/lib/libc-client.so \\\n && rm -rf /var/cache/{yum,ldconfig}/* \\\n && rm -rf /etc/ld.so.cache \\\n && yum clean all\n#  -----------------------------------------------------------------------------\n#  Install supervisor and distribute ...\n#  -----------------------------------------------------------------------------\nRUN pip install supervisor distribute \\\n && rm -rf /tmp/*\n#  -----------------------------------------------------------------------------\n#  Configure, timezone/sshd/passwd/networking\n#  -----------------------------------------------------------------------------\nRUN ln -sf /usr/share/zoneinfo/Asia/Chongqing /etc/localtime \\\n && sed -i -e 's/^UsePAM yes/#UsePAM yes/g' -e 's/^#UsePAM no/UsePAM no/g' -e 's/#UsePrivilegeSeparation.*/UsePrivilegeSeparation no/g' -e 's/^#UseDNS yes/UseDNS no/g' /etc/ssh/sshd_config \\\n && echo \"root\" | passwd --stdin root \\\n && ssh-keygen -q -b 1024 -N '' -t rsa -f /etc/ssh/ssh_host_rsa_key \\\n && ssh-keygen -q -b 1024 -N '' -t dsa -f /etc/ssh/ssh_host_dsa_key \\\n && echo \"NETWORKING=yes\" > /etc/sysconfig/network\n#  -----------------------------------------------------------------------------\n#  Install curl\n#  -----------------------------------------------------------------------------\nENV CURL_INSTALL_DIR=\"${HOME}/libcurl\"\nRUN cd ${SRC_DIR} \\\n && wget -q -O curl-7.55.1.tar.gz http://curl.askapache.com/download/curl-7.55.1.tar.gz \\\n && tar xzf curl-7.55.1.tar.gz \\\n && cd curl-7.55.1 \\\n && ./configure --prefix=${CURL_INSTALL_DIR} \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/curl*\n#  -----------------------------------------------------------------------------\n#  Install Nginx\n#  -----------------------------------------------------------------------------\nENV nginx_version=\"1.12.2\"\nENV NGINX_INSTALL_DIR=\"${HOME}/nginx\"\nRUN cd ${SRC_DIR} \\\n && wget -q -O nginx-${nginx_version}.tar.gz http://nginx.org/download/nginx-${nginx_version}.tar.gz \\\n && wget -q -O nginx-http-concat.zip https://github.com/alibaba/nginx-http-concat/archive/master.zip \\\n && wget -q -O nginx-logid.zip https://github.com/pinguo-liuzhaohui/nginx-logid/archive/master.zip \\\n && wget -q -O ngx_devel_kit-0.3.0.tar.gz https://github.com/simpl/ngx_devel_kit/archive/v0.3.0.tar.gz \\\n && wget -q -O lua-nginx-module-0.10.11.tar.gz https://github.com/openresty/lua-nginx-module/archive/v0.10.11.tar.gz \\\n && wget -q -O LuaJIT-2.0.5.tar.gz http://luajit.org/download/LuaJIT-2.0.5.tar.gz \\\n && tar zxf nginx-${nginx_version}.tar.gz \\\n && unzip nginx-http-concat.zip -d nginx-http-concat \\\n && unzip nginx-logid.zip -d nginx-logid \\\n && tar zxf ngx_devel_kit-0.3.0.tar.gz \\\n && tar zxf lua-nginx-module-0.10.11.tar.gz \\\n && tar zxf LuaJIT-2.0.5.tar.gz \\\n && cd LuaJIT-2.0.5 \\\n && make PREFIX=${HOME}/LuaJIT-2.0.5 1> /dev/null \\\n && make install PREFIX=${HOME}/LuaJIT-2.0.5 \\\n && cd ${HOME} \\\n && ln -s LuaJIT-2.0.5 luajit \\\n && export LUAJIT_LIB=${HOME}/luajit/lib \\\n && export LUAJIT_INC=${HOME}/luajit/include/luajit-2.0 \\\n && cd ${SRC_DIR}/nginx-${nginx_version} \\\n && ./configure --prefix=$NGINX_INSTALL_DIR --with-http_stub_status_module --with-http_ssl_module --add-module=../nginx-http-concat/nginx-http-concat-master --add-module=../nginx-logid/nginx-logid-master --with-ld-opt=\"-Wl,-rpath,${HOME}/luajit/lib\" --add-module=../ngx_devel_kit-0.3.0 --add-module=../lua-nginx-module-0.10.11 1> /dev/null \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/nginx-* ${SRC_DIR}/ngx_devel_kit* ${SRC_DIR}/lua-nginx-module* ${SRC_DIR}/LuaJIT*\n#  -----------------------------------------------------------------------------\n#  Install Redis\n#  -----------------------------------------------------------------------------\nENV redis_version=\"3.2.11\"\nENV REDIS_INSTALL_DIR=\"${HOME}/redis\"\nRUN cd ${SRC_DIR} \\\n && wget -q -O redis-${redis_version}.tar.gz http://download.redis.io/releases/redis-${redis_version}.tar.gz \\\n && tar xzf redis-${redis_version}.tar.gz \\\n && cd redis-${redis_version} \\\n && make 1> /dev/null \\\n && make PREFIX=$REDIS_INSTALL_DIR install \\\n && rm -rf ${SRC_DIR}/redis-*\n#  -----------------------------------------------------------------------------\n#  Install ImageMagick\n#  -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O ImageMagick.tar.gz https://www.imagemagick.org/download/ImageMagick.tar.gz \\\n && tar zxf ImageMagick.tar.gz \\\n && rm -rf ImageMagick.tar.gz \\\n && ImageMagickPath=`ls ` \\\n && cd ${ImageMagickPath} \\\n && ./configure \\\n && make \\\n && make install \\\n && rm -rf $SRC_DIR/ImageMagick*\n#  -----------------------------------------------------------------------------\n#  Install hiredis\n#  -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O hiredis-0.13.3.tar.gz https://github.com/redis/hiredis/archive/v0.13.3.tar.gz \\\n && tar zxvf hiredis-0.13.3.tar.gz \\\n && cd hiredis-0.13.3 \\\n && make \\\n && make install \\\n && echo \"/usr/local/lib\" > /etc/ld.so.conf.d/local.conf \\\n && ldconfig \\\n && rm -rf $SRC_DIR/hiredis-*\n#  -----------------------------------------------------------------------------\n#  Install libmemcached using by php-memcached\n#  -----------------------------------------------------------------------------\nENV LIB_MEMCACHED_INSTALL_DIR=\"/usr/local/\"\nRUN cd ${SRC_DIR} \\\n && wget -q -O libmemcached-1.0.18.tar.gz https://launchpad.net/libmemcached/1.0/1.0.18/+download/libmemcached-1.0.18.tar.gz \\\n && tar xzf libmemcached-1.0.18.tar.gz \\\n && cd libmemcached-1.0.18 \\\n && ./configure --prefix=$LIB_MEMCACHED_INSTALL_DIR --with-memcached 1> /dev/null \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/libmemcached*\n#  -----------------------------------------------------------------------------\n#  Install libmcrypt using by php-mcrypt\n#  -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O libmcrypt-2.5.8.tar.gz https://nchc.dl.sourceforge.net/project/mcrypt/Libmcrypt/2.5.8/libmcrypt-2.5.8.tar.gz \\\n && tar xzf libmcrypt-2.5.8.tar.gz \\\n && cd libmcrypt-2.5.8 \\\n && ./configure 1> /dev/null \\\n && make 1> /dev/null \\\n && make install \\\n && echo \"/usr/local/lib64\" >> /etc/ld.so.conf.d/local.conf \\\n && echo \"/usr/local/src/libmcrypt-2.5.8/lib/.libs\" >> /etc/ld.so.conf.d/local.conf \\\n && chmod gu+x /etc/ld.so.conf.d/local.conf \\\n && ldconfig -v\n#  -----------------------------------------------------------------------------\n#  Install re2c for PHP\n#  -----------------------------------------------------------------------------\nRUN cd $SRC_DIR \\\n && wget -q -O re2c-1.0.tar.gz https://excellmedia.dl.sourceforge.net/project/re2c/old/re2c-1.0.tar.gz \\\n && tar xzf re2c-1.0.tar.gz \\\n && cd re2c-1.0 \\\n && ./configure \\\n && make \\\n && make install \\\n && rm -rf ${SRC_DIR}/re2c*\n#  -----------------------------------------------------------------------------\n#  Install PHP\n#  -----------------------------------------------------------------------------\nENV phpversion=\"7.1.9\"\nENV PHP_INSTALL_DIR=\"${HOME}/php\"\nRUN cd ${SRC_DIR} \\\n && ls -l \\\n && wget -q -O php-${phpversion}.tar.gz http://cn2.php.net/distributions/php-${phpversion}.tar.gz \\\n && tar xzf php-${phpversion}.tar.gz \\\n && cd php-${phpversion} \\\n && ./configure --prefix=${PHP_INSTALL_DIR} --with-config-file-path=${PHP_INSTALL_DIR}/etc --with-config-file-scan-dir=${PHP_INSTALL_DIR}/etc/php.d --sysconfdir=${PHP_INSTALL_DIR}/etc --with-libdir=lib64 --enable-mysqlnd --enable-zip --enable-exif --enable-ftp --enable-mbstring --enable-mbregex --enable-fpm --enable-bcmath --enable-pcntl --enable-soap --enable-sockets --enable-shmop --enable-sysvmsg --enable-sysvsem --enable-sysvshm --enable-gd-native-ttf --enable-wddx --enable-opcache --with-gettext --with-xsl --with-libexpat-dir --with-xmlrpc --with-snmp --with-ldap --enable-mysqlnd --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd --with-pdo-odbc=unixODBC,/usr --with-gd --with-jpeg-dir --with-png-dir --with-zlib-dir --with-freetype-dir --with-zlib --with-bz2 --with-openssl --with-curl=${CURL_INSTALL_DIR} --with-mcrypt --with-mhash \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${PHP_INSTALL_DIR}/lib/php.ini \\\n && cp -f php.ini-development ${PHP_INSTALL_DIR}/lib/php.ini \\\n && rm -rf ${SRC_DIR}/php* ${SRC_DIR}/libmcrypt*\n#  -----------------------------------------------------------------------------\n#  Install yaml and PHP yaml extension\n#  -----------------------------------------------------------------------------\nRUN cd $SRC_DIR \\\n && wget -q -O yaml-0.1.7.tar.gz http://pyyaml.org/download/libyaml/yaml-0.1.7.tar.gz \\\n && tar xzf yaml-0.1.7.tar.gz \\\n && cd yaml-0.1.7 \\\n && ./configure --prefix=/usr/local \\\n && make > /dev/null \\\n && make install \\\n && cd $SRC_DIR \\\n && wget -q -O yaml-2.0.2.tgz https://pecl.php.net/get/yaml-2.0.2.tgz \\\n && tar xzf yaml-2.0.2.tgz \\\n && cd yaml-2.0.2 \\\n && $PHP_INSTALL_DIR/bin/phpize \\\n && ./configure --with-yaml=/usr/local --with-php-config=$PHP_INSTALL_DIR/bin/php-config \\\n && make > /dev/null \\\n && make install \\\n && rm -rf $SRC_DIR/yaml-*\n#  -----------------------------------------------------------------------------\n#  Install PHP mongodb extensions\n#  -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O mongodb-1.3.2.tgz https://pecl.php.net/get/mongodb-1.3.2.tgz \\\n && tar zxf mongodb-1.3.2.tgz \\\n && cd mongodb-1.3.2 \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --with-php-config=$PHP_INSTALL_DIR/bin/php-config 1> /dev/null \\\n && make clean \\\n && make \\\n && make install \\\n && rm -rf ${SRC_DIR}/mongodb-*\n#  -----------------------------------------------------------------------------\n#  -----------------------------------------------------------------------------\n#  Install PHP redis extensions\n#  -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O redis-3.1.3.tgz https://pecl.php.net/get/redis-3.1.3.tgz \\\n && tar zxf redis-3.1.3.tgz \\\n && cd redis-3.1.3 \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --with-php-config=$PHP_INSTALL_DIR/bin/php-config 1> /dev/null \\\n && make clean \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/redis-*\n#  -----------------------------------------------------------------------------\n#  Install PHP imagick extensions\n#  -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O imagick-3.4.3.tgz https://pecl.php.net/get/imagick-3.4.3.tgz \\\n && tar zxf imagick-3.4.3.tgz \\\n && cd imagick-3.4.3 \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --with-php-config=$PHP_INSTALL_DIR/bin/php-config --with-imagick 1> /dev/null \\\n && make clean \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/imagick-*\n#  -----------------------------------------------------------------------------\n#  Install PHP xdebug extensions\n#  -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O xdebug-2.5.5.tgz https://pecl.php.net/get/xdebug-2.5.5.tgz \\\n && tar zxf xdebug-2.5.5.tgz \\\n && cd xdebug-2.5.5 \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --with-php-config=$PHP_INSTALL_DIR/bin/php-config 1> /dev/null \\\n && make clean \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/xdebug-*\n#  -----------------------------------------------------------------------------\n#  Install PHP igbinary extensions\n#  -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O igbinary-2.0.1.tgz https://pecl.php.net/get/igbinary-2.0.1.tgz \\\n && tar zxf igbinary-2.0.1.tgz \\\n && cd igbinary-2.0.1 \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --with-php-config=$PHP_INSTALL_DIR/bin/php-config 1> /dev/null \\\n && make clean \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/igbinary-*\n#  -----------------------------------------------------------------------------\n#  Install PHP memcached extensions\n#  -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O memcached-3.0.3.tgz https://pecl.php.net/get/memcached-3.0.3.tgz \\\n && tar xzf memcached-3.0.3.tgz \\\n && cd memcached-3.0.3 \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --enable-memcached --with-php-config=$PHP_INSTALL_DIR/bin/php-config --with-libmemcached-dir=$LIB_MEMCACHED_INSTALL_DIR --disable-memcached-sasl 1> /dev/null \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/memcached-*\n#  -----------------------------------------------------------------------------\n#  Install PHP yac extensions\n#  -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O yac-2.0.2.tgz https://pecl.php.net/get/yac-2.0.2.tgz \\\n && tar zxf yac-2.0.2.tgz \\\n && cd yac-2.0.2 \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --with-php-config=$PHP_INSTALL_DIR/bin/php-config \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf $SRC_DIR/yac-*\n#  -----------------------------------------------------------------------------\n#  Install PHP swoole extensions\n#  -----------------------------------------------------------------------------\nENV swooleVersion=\"1.9.22\"\nRUN cd ${SRC_DIR} \\\n && wget -q -O swoole-${swooleVersion}.tar.gz https://github.com/swoole/swoole-src/archive/v${swooleVersion}.tar.gz \\\n && tar zxf swoole-${swooleVersion}.tar.gz \\\n && cd swoole-src-${swooleVersion}/ \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --with-php-config=$PHP_INSTALL_DIR/bin/php-config --enable-async-redis --enable-openssl \\\n && make clean 1> /dev/null \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/swoole*\n#  -----------------------------------------------------------------------------\n#  Install PHP inotify extensions\n#  -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O inotify-2.0.0.tgz https://pecl.php.net/get/inotify-2.0.0.tgz \\\n && tar zxf inotify-2.0.0.tgz \\\n && cd inotify-2.0.0 \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --with-php-config=$PHP_INSTALL_DIR/bin/php-config 1> /dev/null \\\n && make clean \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/inotify-*\n#  -----------------------------------------------------------------------------\n#  Install phpunit\n#  -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O phpunit.phar https://phar.phpunit.de/phpunit.phar \\\n && mv phpunit.phar ${PHP_INSTALL_DIR}/bin/phpunit \\\n && chmod +x ${PHP_INSTALL_DIR}/bin/phpunit\n#  -----------------------------------------------------------------------------\n#  Install php composer\n#  -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && curl -sS https://getcomposer.org/installer | $PHP_INSTALL_DIR/bin/php \\\n && chmod +x composer.phar \\\n && mv composer.phar ${PHP_INSTALL_DIR}/bin/composer\n#  -----------------------------------------------------------------------------\n#  Install PhpDocumentor\n#  -----------------------------------------------------------------------------\nRUN $PHP_INSTALL_DIR/bin/pear install -a PhpDocumentor\nRUN cd ${PHP_INSTALL_DIR} \\\n && bin/php bin/composer self-update \\\n && bin/pear install PHP_CodeSniffer-2.3.4 \\\n && rm -rf /tmp/*\n#  -----------------------------------------------------------------------------\n#  Install jq\n#  -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O jq-1.5.tar.gz https://github.com/stedolan/jq/archive/jq-1.5.tar.gz \\\n && tar zxf jq-1.5.tar.gz \\\n && cd jq-jq-1.5 \\\n && ./configure --disable-maintainer-mode \\\n && make \\\n && make install \\\n && rm -rf ${SRC_DIR}/jq-*\n#  -----------------------------------------------------------------------------\n#  Install Apache ab\n#  -----------------------------------------------------------------------------\nRUN cd ${HOME} \\\n && yum -y remove httpd \\\n && mkdir httpd \\\n && cd httpd \\\n && yumdownloader httpd-tools \\\n && rpm2cpio httpd-tools* | cpio -idmv \\\n && mkdir -p /home/worker/bin \\\n && mv ./usr/bin/ab /home/worker/bin \\\n && cd ${HOME} \\\n && rm -rf /home/worker/httpd\n#  -----------------------------------------------------------------------------\n#  Update Git\n#  -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && yum -y remove git subversion \\\n && wget -q -O git-2.14.1.tar.gz https://github.com/git/git/archive/v2.14.1.tar.gz \\\n && tar zxf git-2.14.1.tar.gz \\\n && cd git-2.14.1 \\\n && make configure \\\n && ./configure --without-iconv --prefix=/usr/local/ --with-curl=${CURL_INSTALL_DIR} \\\n && make \\\n && make install \\\n && rm -rf $SRC_DIR/git-2*\n#  -----------------------------------------------------------------------------\n#  Install Node and apidoc and nodemon\n#  -----------------------------------------------------------------------------\nRUN npm install apidoc nodemon -g\n#  -----------------------------------------------------------------------------\n#  Copy Config\n#  -----------------------------------------------------------------------------\nADD run.sh /\nADD config /home/worker/\n#  -----------------------------------------------------------------------------\n#  Add user worker\n#  -----------------------------------------------------------------------------\nRUN useradd -M -u 1000 worker \\\n && echo \"worker\" | passwd --stdin worker \\\n && echo 'worker ALL=(ALL) NOPASSWD: ALL' > /etc/sudoers.d/worker \\\n && sed -i -e 's/^#PermitRootLogin yes/PermitRootLogin no/g' -e 's/^PermitRootLogin yes/PermitRootLogin no/g' -e 's/^#PermitUserEnvironment no/PermitUserEnvironment yes/g' -e 's/^PermitUserEnvironment no/PermitUserEnvironment yes/g' /etc/ssh/sshd_config \\\n && chmod a+x /run.sh \\\n && chmod a+x ${PHP_INSTALL_DIR}/bin/checkstyle \\\n && chmod a+x ${PHP_INSTALL_DIR}/bin/mergeCoverReport\n#  -----------------------------------------------------------------------------\n#  clean tmp file\n#  -----------------------------------------------------------------------------\nRUN rm -rf ${SRC_DIR}/*\nRUN rm -rf /tmp/*\nENTRYPOINT [\"/run.sh\"]\nEXPOSE 22/tcp 80/tcp 443/tcp\nCMD [\"/usr/sbin/sshd\", \"-D\"]\n","injectedSmells":[],"originalDockerfileHash":"adda3c166bd855741fd1f7c79189583c","successfullyInjectedSmells":[],"originalDockerfileUglified":"FROM centos:centos6.9\nMAINTAINER pinguoops <pinguo-ops@camera360.com>\n#   -----------------------------------------------------------------------------\n#   Make src dir\n#   -----------------------------------------------------------------------------\nENV HOME=\"/home/worker\"\nENV SRC_DIR=\"$HOME/src\"\nRUN mkdir -p ${SRC_DIR}\n#  ADD src ${SRC_DIR}\n#   -----------------------------------------------------------------------------\n#   Install Development tools\n#   -----------------------------------------------------------------------------\nRUN rpm --import /etc/pki/rpm-gpg/RPM* \\\n && curl --silent --location https://raw.githubusercontent.com/nodesource/distributions/master/rpm/setup_6.x | bash - \\\n && yum -y update \\\n && yum groupinstall -y \"Development tools\" \\\n && yum install -y gcc-c++ zlib-devel bzip2-devel openssl openssl-devel ncurses-devel sqlite-devel wget \\\n && rm -rf /var/cache/{yum,ldconfig}/* \\\n && rm -rf /etc/ld.so.cache \\\n && yum clean all\n#   -----------------------------------------------------------------------------\n#   Update Python to 2.7.x\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O Python-2.7.13.tgz http://mirrors.sohu.com/python/2.7.13/Python-2.7.13.tgz \\\n && tar zxf Python-2.7.13.tgz \\\n && cd Python-2.7.13 \\\n && ./configure \\\n && make \\\n && make install \\\n && mv /usr/bin/python /usr/bin/python.old \\\n && rm -f /usr/bin/python-config \\\n && ln -s /usr/local/bin/python /usr/bin/python \\\n && ln -s /usr/local/bin/python-config /usr/bin/python-config \\\n && ln -s /usr/local/include/python2.7/ /usr/include/python2.7 \\\n && wget https://bootstrap.pypa.io/ez_setup.py -O - | python \\\n && easy_install pip \\\n && sed -in-place '1s%.*%#!/usr/bin/python2.6%' /usr/bin/yum \\\n && cp -r /usr/lib/python2.6/site-packages/yum /usr/local/lib/python2.7/site-packages/ \\\n && cp -r /usr/lib/python2.6/site-packages/rpmUtils /usr/local/lib/python2.7/site-packages/ \\\n && cp -r /usr/lib/python2.6/site-packages/iniparse /usr/local/lib/python2.7/site-packages/ \\\n && cp -r /usr/lib/python2.6/site-packages/urlgrabber /usr/local/lib/python2.7/site-packages/ \\\n && cp -r /usr/lib64/python2.6/site-packages/rpm /usr/local/lib/python2.7/site-packages/ \\\n && cp -r /usr/lib64/python2.6/site-packages/curl /usr/local/lib/python2.7/site-packages/ \\\n && cp -p /usr/lib64/python2.6/site-packages/pycurl.so /usr/local/lib/python2.7/site-packages/ \\\n && cp -p /usr/lib64/python2.6/site-packages/_sqlitecache.so /usr/local/lib/python2.7/site-packages/ \\\n && cp -p /usr/lib64/python2.6/site-packages/sqlitecachec.py /usr/local/lib/python2.7/site-packages/ \\\n && cp -p /usr/lib64/python2.6/site-packages/sqlitecachec.pyc /usr/local/lib/python2.7/site-packages/ \\\n && cp -p /usr/lib64/python2.6/site-packages/sqlitecachec.pyo /usr/local/lib/python2.7/site-packages/ \\\n && rm -rf ${SRC_DIR}/Python*\n#   -----------------------------------------------------------------------------\n#   Devel libraries for delelopment tools like php & nginx ...\n#   -----------------------------------------------------------------------------\nRUN yum -y install tar gzip bzip2 unzip file perl-devel perl-ExtUtils-Embed pcre openssh-server openssh sudo screen vim git telnet expat lemon net-snmp net-snmp-devel ca-certificates perl-CPAN m4 gd libjpeg libpng zlib libevent net-snmp net-snmp-devel net-snmp-libs freetype libtool-tldl libxml2 unixODBC libxslt libmcrypt freetds gd-devel libjpeg-devel libpng-devel zlib-devel freetype-devel libtool-ltdl libtool-ltdl-devel libxml2-devel zlib-devel bzip2-devel gettext-devel curl-devel gettext-devel libevent-devel libxslt-devel expat-devel unixODBC-devel openssl-devel libmcrypt-devel freetds-devel pcre-devel openldap openldap-devel libc-client-devel jemalloc jemalloc-devel inotify-tools nodejs apr-util yum-utils tree \\\n && ln -s /usr/lib64/libc-client.so /usr/lib/libc-client.so \\\n && rm -rf /var/cache/{yum,ldconfig}/* \\\n && rm -rf /etc/ld.so.cache \\\n && yum clean all\n#   -----------------------------------------------------------------------------\n#   Install supervisor and distribute ...\n#   -----------------------------------------------------------------------------\nRUN pip install supervisor distribute \\\n && rm -rf /tmp/*\n#   -----------------------------------------------------------------------------\n#   Configure, timezone/sshd/passwd/networking\n#   -----------------------------------------------------------------------------\nRUN ln -sf /usr/share/zoneinfo/Asia/Chongqing /etc/localtime \\\n && sed -i -e 's/^UsePAM yes/#UsePAM yes/g' -e 's/^#UsePAM no/UsePAM no/g' -e 's/#UsePrivilegeSeparation.*/UsePrivilegeSeparation no/g' -e 's/^#UseDNS yes/UseDNS no/g' /etc/ssh/sshd_config \\\n && echo \"root\" | passwd --stdin root \\\n && ssh-keygen -q -b 1024 -N '' -t rsa -f /etc/ssh/ssh_host_rsa_key \\\n && ssh-keygen -q -b 1024 -N '' -t dsa -f /etc/ssh/ssh_host_dsa_key \\\n && echo \"NETWORKING=yes\" > /etc/sysconfig/network\n#   -----------------------------------------------------------------------------\n#   Install curl\n#   -----------------------------------------------------------------------------\nENV CURL_INSTALL_DIR=\"${HOME}/libcurl\"\nRUN cd ${SRC_DIR} \\\n && wget -q -O curl-7.55.1.tar.gz http://curl.askapache.com/download/curl-7.55.1.tar.gz \\\n && tar xzf curl-7.55.1.tar.gz \\\n && cd curl-7.55.1 \\\n && ./configure --prefix=${CURL_INSTALL_DIR} \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/curl*\n#   -----------------------------------------------------------------------------\n#   Install Nginx\n#   -----------------------------------------------------------------------------\nENV nginx_version=\"1.12.2\"\nENV NGINX_INSTALL_DIR=\"${HOME}/nginx\"\nRUN cd ${SRC_DIR} \\\n && wget -q -O nginx-${nginx_version}.tar.gz http://nginx.org/download/nginx-${nginx_version}.tar.gz \\\n && wget -q -O nginx-http-concat.zip https://github.com/alibaba/nginx-http-concat/archive/master.zip \\\n && wget -q -O nginx-logid.zip https://github.com/pinguo-liuzhaohui/nginx-logid/archive/master.zip \\\n && wget -q -O ngx_devel_kit-0.3.0.tar.gz https://github.com/simpl/ngx_devel_kit/archive/v0.3.0.tar.gz \\\n && wget -q -O lua-nginx-module-0.10.11.tar.gz https://github.com/openresty/lua-nginx-module/archive/v0.10.11.tar.gz \\\n && wget -q -O LuaJIT-2.0.5.tar.gz http://luajit.org/download/LuaJIT-2.0.5.tar.gz \\\n && tar zxf nginx-${nginx_version}.tar.gz \\\n && unzip nginx-http-concat.zip -d nginx-http-concat \\\n && unzip nginx-logid.zip -d nginx-logid \\\n && tar zxf ngx_devel_kit-0.3.0.tar.gz \\\n && tar zxf lua-nginx-module-0.10.11.tar.gz \\\n && tar zxf LuaJIT-2.0.5.tar.gz \\\n && cd LuaJIT-2.0.5 \\\n && make PREFIX=${HOME}/LuaJIT-2.0.5 1> /dev/null \\\n && make install PREFIX=${HOME}/LuaJIT-2.0.5 \\\n && cd ${HOME} \\\n && ln -s LuaJIT-2.0.5 luajit \\\n && export LUAJIT_LIB=${HOME}/luajit/lib \\\n && export LUAJIT_INC=${HOME}/luajit/include/luajit-2.0 \\\n && cd ${SRC_DIR}/nginx-${nginx_version} \\\n && ./configure --prefix=$NGINX_INSTALL_DIR --with-http_stub_status_module --with-http_ssl_module --add-module=../nginx-http-concat/nginx-http-concat-master --add-module=../nginx-logid/nginx-logid-master --with-ld-opt=\"-Wl,-rpath,${HOME}/luajit/lib\" --add-module=../ngx_devel_kit-0.3.0 --add-module=../lua-nginx-module-0.10.11 1> /dev/null \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/nginx-* ${SRC_DIR}/ngx_devel_kit* ${SRC_DIR}/lua-nginx-module* ${SRC_DIR}/LuaJIT*\n#   -----------------------------------------------------------------------------\n#   Install Redis\n#   -----------------------------------------------------------------------------\nENV redis_version=\"3.2.11\"\nENV REDIS_INSTALL_DIR=\"${HOME}/redis\"\nRUN cd ${SRC_DIR} \\\n && wget -q -O redis-${redis_version}.tar.gz http://download.redis.io/releases/redis-${redis_version}.tar.gz \\\n && tar xzf redis-${redis_version}.tar.gz \\\n && cd redis-${redis_version} \\\n && make 1> /dev/null \\\n && make PREFIX=$REDIS_INSTALL_DIR install \\\n && rm -rf ${SRC_DIR}/redis-*\n#   -----------------------------------------------------------------------------\n#   Install ImageMagick\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O ImageMagick.tar.gz https://www.imagemagick.org/download/ImageMagick.tar.gz \\\n && tar zxf ImageMagick.tar.gz \\\n && rm -rf ImageMagick.tar.gz \\\n && ImageMagickPath=`ls ` \\\n && cd ${ImageMagickPath} \\\n && ./configure \\\n && make \\\n && make install \\\n && rm -rf $SRC_DIR/ImageMagick*\n#   -----------------------------------------------------------------------------\n#   Install hiredis\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O hiredis-0.13.3.tar.gz https://github.com/redis/hiredis/archive/v0.13.3.tar.gz \\\n && tar zxvf hiredis-0.13.3.tar.gz \\\n && cd hiredis-0.13.3 \\\n && make \\\n && make install \\\n && echo \"/usr/local/lib\" > /etc/ld.so.conf.d/local.conf \\\n && ldconfig \\\n && rm -rf $SRC_DIR/hiredis-*\n#   -----------------------------------------------------------------------------\n#   Install libmemcached using by php-memcached\n#   -----------------------------------------------------------------------------\nENV LIB_MEMCACHED_INSTALL_DIR=\"/usr/local/\"\nRUN cd ${SRC_DIR} \\\n && wget -q -O libmemcached-1.0.18.tar.gz https://launchpad.net/libmemcached/1.0/1.0.18/+download/libmemcached-1.0.18.tar.gz \\\n && tar xzf libmemcached-1.0.18.tar.gz \\\n && cd libmemcached-1.0.18 \\\n && ./configure --prefix=$LIB_MEMCACHED_INSTALL_DIR --with-memcached 1> /dev/null \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/libmemcached*\n#   -----------------------------------------------------------------------------\n#   Install libmcrypt using by php-mcrypt\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O libmcrypt-2.5.8.tar.gz https://nchc.dl.sourceforge.net/project/mcrypt/Libmcrypt/2.5.8/libmcrypt-2.5.8.tar.gz \\\n && tar xzf libmcrypt-2.5.8.tar.gz \\\n && cd libmcrypt-2.5.8 \\\n && ./configure 1> /dev/null \\\n && make 1> /dev/null \\\n && make install \\\n && echo \"/usr/local/lib64\" >> /etc/ld.so.conf.d/local.conf \\\n && echo \"/usr/local/src/libmcrypt-2.5.8/lib/.libs\" >> /etc/ld.so.conf.d/local.conf \\\n && chmod gu+x /etc/ld.so.conf.d/local.conf \\\n && ldconfig -v\n#   -----------------------------------------------------------------------------\n#   Install re2c for PHP\n#   -----------------------------------------------------------------------------\nRUN cd $SRC_DIR \\\n && wget -q -O re2c-1.0.tar.gz https://excellmedia.dl.sourceforge.net/project/re2c/old/re2c-1.0.tar.gz \\\n && tar xzf re2c-1.0.tar.gz \\\n && cd re2c-1.0 \\\n && ./configure \\\n && make \\\n && make install \\\n && rm -rf ${SRC_DIR}/re2c*\n#   -----------------------------------------------------------------------------\n#   Install PHP\n#   -----------------------------------------------------------------------------\nENV phpversion=\"7.1.9\"\nENV PHP_INSTALL_DIR=\"${HOME}/php\"\nRUN cd ${SRC_DIR} \\\n && ls -l \\\n && wget -q -O php-${phpversion}.tar.gz http://cn2.php.net/distributions/php-${phpversion}.tar.gz \\\n && tar xzf php-${phpversion}.tar.gz \\\n && cd php-${phpversion} \\\n && ./configure --prefix=${PHP_INSTALL_DIR} --with-config-file-path=${PHP_INSTALL_DIR}/etc --with-config-file-scan-dir=${PHP_INSTALL_DIR}/etc/php.d --sysconfdir=${PHP_INSTALL_DIR}/etc --with-libdir=lib64 --enable-mysqlnd --enable-zip --enable-exif --enable-ftp --enable-mbstring --enable-mbregex --enable-fpm --enable-bcmath --enable-pcntl --enable-soap --enable-sockets --enable-shmop --enable-sysvmsg --enable-sysvsem --enable-sysvshm --enable-gd-native-ttf --enable-wddx --enable-opcache --with-gettext --with-xsl --with-libexpat-dir --with-xmlrpc --with-snmp --with-ldap --enable-mysqlnd --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd --with-pdo-odbc=unixODBC,/usr --with-gd --with-jpeg-dir --with-png-dir --with-zlib-dir --with-freetype-dir --with-zlib --with-bz2 --with-openssl --with-curl=${CURL_INSTALL_DIR} --with-mcrypt --with-mhash \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${PHP_INSTALL_DIR}/lib/php.ini \\\n && cp -f php.ini-development ${PHP_INSTALL_DIR}/lib/php.ini \\\n && rm -rf ${SRC_DIR}/php* ${SRC_DIR}/libmcrypt*\n#   -----------------------------------------------------------------------------\n#   Install yaml and PHP yaml extension\n#   -----------------------------------------------------------------------------\nRUN cd $SRC_DIR \\\n && wget -q -O yaml-0.1.7.tar.gz http://pyyaml.org/download/libyaml/yaml-0.1.7.tar.gz \\\n && tar xzf yaml-0.1.7.tar.gz \\\n && cd yaml-0.1.7 \\\n && ./configure --prefix=/usr/local \\\n && make > /dev/null \\\n && make install \\\n && cd $SRC_DIR \\\n && wget -q -O yaml-2.0.2.tgz https://pecl.php.net/get/yaml-2.0.2.tgz \\\n && tar xzf yaml-2.0.2.tgz \\\n && cd yaml-2.0.2 \\\n && $PHP_INSTALL_DIR/bin/phpize \\\n && ./configure --with-yaml=/usr/local --with-php-config=$PHP_INSTALL_DIR/bin/php-config \\\n && make > /dev/null \\\n && make install \\\n && rm -rf $SRC_DIR/yaml-*\n#   -----------------------------------------------------------------------------\n#   Install PHP mongodb extensions\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O mongodb-1.3.2.tgz https://pecl.php.net/get/mongodb-1.3.2.tgz \\\n && tar zxf mongodb-1.3.2.tgz \\\n && cd mongodb-1.3.2 \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --with-php-config=$PHP_INSTALL_DIR/bin/php-config 1> /dev/null \\\n && make clean \\\n && make \\\n && make install \\\n && rm -rf ${SRC_DIR}/mongodb-*\n#   -----------------------------------------------------------------------------\n#   -----------------------------------------------------------------------------\n#   Install PHP redis extensions\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O redis-3.1.3.tgz https://pecl.php.net/get/redis-3.1.3.tgz \\\n && tar zxf redis-3.1.3.tgz \\\n && cd redis-3.1.3 \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --with-php-config=$PHP_INSTALL_DIR/bin/php-config 1> /dev/null \\\n && make clean \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/redis-*\n#   -----------------------------------------------------------------------------\n#   Install PHP imagick extensions\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O imagick-3.4.3.tgz https://pecl.php.net/get/imagick-3.4.3.tgz \\\n && tar zxf imagick-3.4.3.tgz \\\n && cd imagick-3.4.3 \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --with-php-config=$PHP_INSTALL_DIR/bin/php-config --with-imagick 1> /dev/null \\\n && make clean \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/imagick-*\n#   -----------------------------------------------------------------------------\n#   Install PHP xdebug extensions\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O xdebug-2.5.5.tgz https://pecl.php.net/get/xdebug-2.5.5.tgz \\\n && tar zxf xdebug-2.5.5.tgz \\\n && cd xdebug-2.5.5 \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --with-php-config=$PHP_INSTALL_DIR/bin/php-config 1> /dev/null \\\n && make clean \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/xdebug-*\n#   -----------------------------------------------------------------------------\n#   Install PHP igbinary extensions\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O igbinary-2.0.1.tgz https://pecl.php.net/get/igbinary-2.0.1.tgz \\\n && tar zxf igbinary-2.0.1.tgz \\\n && cd igbinary-2.0.1 \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --with-php-config=$PHP_INSTALL_DIR/bin/php-config 1> /dev/null \\\n && make clean \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/igbinary-*\n#   -----------------------------------------------------------------------------\n#   Install PHP memcached extensions\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O memcached-3.0.3.tgz https://pecl.php.net/get/memcached-3.0.3.tgz \\\n && tar xzf memcached-3.0.3.tgz \\\n && cd memcached-3.0.3 \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --enable-memcached --with-php-config=$PHP_INSTALL_DIR/bin/php-config --with-libmemcached-dir=$LIB_MEMCACHED_INSTALL_DIR --disable-memcached-sasl 1> /dev/null \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/memcached-*\n#   -----------------------------------------------------------------------------\n#   Install PHP yac extensions\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O yac-2.0.2.tgz https://pecl.php.net/get/yac-2.0.2.tgz \\\n && tar zxf yac-2.0.2.tgz \\\n && cd yac-2.0.2 \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --with-php-config=$PHP_INSTALL_DIR/bin/php-config \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf $SRC_DIR/yac-*\n#   -----------------------------------------------------------------------------\n#   Install PHP swoole extensions\n#   -----------------------------------------------------------------------------\nENV swooleVersion=\"1.9.22\"\nRUN cd ${SRC_DIR} \\\n && wget -q -O swoole-${swooleVersion}.tar.gz https://github.com/swoole/swoole-src/archive/v${swooleVersion}.tar.gz \\\n && tar zxf swoole-${swooleVersion}.tar.gz \\\n && cd swoole-src-${swooleVersion}/ \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --with-php-config=$PHP_INSTALL_DIR/bin/php-config --enable-async-redis --enable-openssl \\\n && make clean 1> /dev/null \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/swoole*\n#   -----------------------------------------------------------------------------\n#   Install PHP inotify extensions\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O inotify-2.0.0.tgz https://pecl.php.net/get/inotify-2.0.0.tgz \\\n && tar zxf inotify-2.0.0.tgz \\\n && cd inotify-2.0.0 \\\n && ${PHP_INSTALL_DIR}/bin/phpize \\\n && ./configure --with-php-config=$PHP_INSTALL_DIR/bin/php-config 1> /dev/null \\\n && make clean \\\n && make 1> /dev/null \\\n && make install \\\n && rm -rf ${SRC_DIR}/inotify-*\n#   -----------------------------------------------------------------------------\n#   Install phpunit\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O phpunit.phar https://phar.phpunit.de/phpunit.phar \\\n && mv phpunit.phar ${PHP_INSTALL_DIR}/bin/phpunit \\\n && chmod +x ${PHP_INSTALL_DIR}/bin/phpunit\n#   -----------------------------------------------------------------------------\n#   Install php composer\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && curl -sS https://getcomposer.org/installer | $PHP_INSTALL_DIR/bin/php \\\n && chmod +x composer.phar \\\n && mv composer.phar ${PHP_INSTALL_DIR}/bin/composer\n#   -----------------------------------------------------------------------------\n#   Install PhpDocumentor\n#   -----------------------------------------------------------------------------\nRUN $PHP_INSTALL_DIR/bin/pear install -a PhpDocumentor\nRUN cd ${PHP_INSTALL_DIR} \\\n && bin/php bin/composer self-update \\\n && bin/pear install PHP_CodeSniffer-2.3.4 \\\n && rm -rf /tmp/*\n#   -----------------------------------------------------------------------------\n#   Install jq\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && wget -q -O jq-1.5.tar.gz https://github.com/stedolan/jq/archive/jq-1.5.tar.gz \\\n && tar zxf jq-1.5.tar.gz \\\n && cd jq-jq-1.5 \\\n && ./configure --disable-maintainer-mode \\\n && make \\\n && make install \\\n && rm -rf ${SRC_DIR}/jq-*\n#   -----------------------------------------------------------------------------\n#   Install Apache ab\n#   -----------------------------------------------------------------------------\nRUN cd ${HOME} \\\n && yum -y remove httpd \\\n && mkdir httpd \\\n && cd httpd \\\n && yumdownloader httpd-tools \\\n && rpm2cpio httpd-tools* | cpio -idmv \\\n && mkdir -p /home/worker/bin \\\n && mv ./usr/bin/ab /home/worker/bin \\\n && cd ${HOME} \\\n && rm -rf /home/worker/httpd\n#   -----------------------------------------------------------------------------\n#   Update Git\n#   -----------------------------------------------------------------------------\nRUN cd ${SRC_DIR} \\\n && yum -y remove git subversion \\\n && wget -q -O git-2.14.1.tar.gz https://github.com/git/git/archive/v2.14.1.tar.gz \\\n && tar zxf git-2.14.1.tar.gz \\\n && cd git-2.14.1 \\\n && make configure \\\n && ./configure --without-iconv --prefix=/usr/local/ --with-curl=${CURL_INSTALL_DIR} \\\n && make \\\n && make install \\\n && rm -rf $SRC_DIR/git-2*\n#   -----------------------------------------------------------------------------\n#   Install Node and apidoc and nodemon\n#   -----------------------------------------------------------------------------\nRUN npm install apidoc nodemon -g\n#   -----------------------------------------------------------------------------\n#   Copy Config\n#   -----------------------------------------------------------------------------\nADD run.sh /\nADD config /home/worker/\n#   -----------------------------------------------------------------------------\n#   Add user worker\n#   -----------------------------------------------------------------------------\nRUN useradd -M -u 1000 worker \\\n && echo \"worker\" | passwd --stdin worker \\\n && echo 'worker ALL=(ALL) NOPASSWD: ALL' > /etc/sudoers.d/worker \\\n && sed -i -e 's/^#PermitRootLogin yes/PermitRootLogin no/g' -e 's/^PermitRootLogin yes/PermitRootLogin no/g' -e 's/^#PermitUserEnvironment no/PermitUserEnvironment yes/g' -e 's/^PermitUserEnvironment no/PermitUserEnvironment yes/g' /etc/ssh/sshd_config \\\n && chmod a+x /run.sh \\\n && chmod a+x ${PHP_INSTALL_DIR}/bin/checkstyle \\\n && chmod a+x ${PHP_INSTALL_DIR}/bin/mergeCoverReport\n#   -----------------------------------------------------------------------------\n#   clean tmp file\n#   -----------------------------------------------------------------------------\nRUN rm -rf ${SRC_DIR}/*\nRUN rm -rf /tmp/*\nENTRYPOINT [\"/run.sh\"]\nEXPOSE 22/tcp 80/tcp 443/tcp\nCMD [\"/usr/sbin/sshd\", \"-D\"]\n","originalDockerfileUglifiedHash":"ad654832b7ae66ff9a80dbaf252864f2","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/67bb7360dce29180a6934af3eee20b87984ca9c7.dockerfile"}