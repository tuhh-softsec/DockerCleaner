{"seed":2815429097,"processedDockerfileHash":"c3189818453106b8540d0a2258f2939c","fixedSmells":["use-no-install-recommends","do-not-use-apt-get-update-alone","pin-package-manager-versions-apt-get","pin-package-manager-versions-pip","pin-package-manager-versions-npm","pin-package-manager-versions-gem","pin-package-manager-versions-apk","use-copy-instead-of-add","use-wget-instead-of-add","do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["use-no-install-recommends","pin-package-manager-versions-gem","use-copy-instead-of-add","have-a-healthcheck","have-a-user"],"processedDockerfile":"#   AUTHOR:           Nicholas Long\n#   DESCRIPTION:      OpenStudio Server Docker Container\n#   TO_BUILD_AND_RUN: docker-compose up\n#   NOTES:            Currently this is one big dockerfile and non-optimal.\n#  may include suffix\nARG OPENSTUDIO_VERSION\nFROM nrel/openstudio:$OPENSTUDIO_VERSION AS base\nMAINTAINER Nicholas Long nicholas.long@nrel.gov\n#   Install required libaries.\n#     realpath - needed for wait-for-it\nRUN sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 7F0CEB10 \\\n && echo \"deb http://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/3.0 multiverse\" | sudo tee /etc/apt/sources.list.d/mongodb-org-3.0.list \\\n && apt-get update \\\n && apt-get install --no-install-recommends apt-transport-https autoconf bison build-essential bzip2 ca-certificates curl default-jdk dos2unix imagemagick gdebi-core git libbz2-dev libcurl4-openssl-dev libdbus-glib-1-2 libgdbm3 libgdbm-dev libglib2.0-dev libglu1 libgsl0-dev libncurses-dev libreadline-dev libxml2-dev libxslt-dev libffi-dev libssl-dev libyaml-dev libice-dev libsm-dev mongodb-org-tools procps realpath tar unzip wget zip zlib1g-dev -y \\\n && rm -rf /var/lib/apt/lists/*\n#   Install passenger (this also installs nginx)\nENV PASSENGER_VERSION=\"5.0.25\"\n#   Install Rack. Silly workaround for not having ruby 2.2.2. Rack 1.6.4 is the\n#   latest for Ruby <= 2.0\nRUN gem install rack --version 3.0.7 -v=1.6.4\nRUN gem install passenger --version 6.0.17\nRUN passenger-install-nginx-module\n#   Configure the nginx server\nRUN mkdir /var/log/nginx\nCOPY /docker/server/nginx.conf /opt/nginx/conf/nginx.conf\n#   Radiance env vars. RUBYLIB is set in the base openstudio container\nENV OPENSTUDIO_SERVER=\"'true'\"\nENV OS_RAYPATH=\"/usr/local/openstudio-$OPENSTUDIO_VERSION/Radiance\"\nENV PERL_EXE_PATH=\"/usr/bin\"\n#   Specify a couple arguments here, after running the majority of the installation above\nARG rails_env=docker\nARG bundle_args=\"--without development test\"\n#   Set the rails env var\nENV RAILS_ENV=\"$rails_env\"\n#  ### OpenStudio Server Code\n#   First upload the Gemfile* so that it can cache the Gems -- do this first because it is slow\nCOPY /bin /opt/openstudio/bin\nCOPY /server/Gemfile /opt/openstudio/server/Gemfile\nWORKDIR /opt/openstudio/server\nRUN bundle _${OS_BUNDLER_VERSION}_ install --jobs=3 --retry=3 $bundle_args\n#   Add the app assets and precompile assets. Do it this way so that when the app changes the assets don't\n#   have to be recompiled everytime\nCOPY /server/Rakefile /opt/openstudio/server/Rakefile\nCOPY /server/config/ /opt/openstudio/server/config/\nCOPY /server/app/assets/ /opt/openstudio/server/app/assets/\n#   Now call precompile\nRUN mkdir /opt/openstudio/server/log\nRUN bundle exec rake assets:precompile\n#   Bundle app source\nCOPY /server /opt/openstudio/server\nCOPY .rubocop.yml /opt/openstudio/.rubocop.yml\n#   Run bundle again, because if the user has a local Gemfile.lock it will have been overriden\nRUN rm Gemfile.lock\nRUN bundle install --jobs=3 --retry=3\n#   Configure IPVS keepalive\nCOPY /docker/server/ipvs-keepalive.conf /etc/sysctl.d/ipvs-keepalive.conf\nRUN sudo sysctl --system\n#   Add in scripts for running server. This includes the wait-for-it scripts to ensure other processes (mongo, redis) have\n#   started before starting the main process.\nCOPY /docker/server/wait-for-it.sh /usr/local/bin/wait-for-it\nCOPY /docker/server/start-server.sh /usr/local/bin/start-server\nCOPY /docker/server/run-server-tests.sh /usr/local/bin/run-server-tests\nCOPY /docker/server/rails-entrypoint.sh /usr/local/bin/rails-entrypoint\nCOPY /docker/server/start-web-background.sh /usr/local/bin/start-web-background\nCOPY /docker/server/start-workers.sh /usr/local/bin/start-workers\nCOPY /docker/server/memfix-controller.rb /usr/local/lib/memfix-controller.rb\nCOPY /docker/server/memfix.rb /usr/local/lib/memfix.rb\nRUN chmod 755 /usr/local/bin/wait-for-it\nRUN chmod +x /usr/local/bin/start-server\nRUN chmod +x /usr/local/bin/run-server-tests\nRUN chmod 755 /usr/local/bin/rails-entrypoint\nRUN chmod 755 /usr/local/bin/start-web-background\nRUN chmod 755 /usr/local/bin/start-workers\nRUN chmod +x /usr/local/lib/memfix-controller.rb\nRUN chmod +x /usr/local/lib/memfix.rb\n#   set the permissions for windows users\nRUN chmod +x /opt/openstudio/server/bin/*\nENTRYPOINT [\"rails-entrypoint\"]\nCMD [\"/usr/local/bin/start-server\"]\n#   Expose ports.\nEXPOSE 8080/tcp 9090/tcp\n#   Multistage build includes test library. To build without testing run\n#   docker build --target base -t some-tag .\nFROM base\nENV GECKODRIVER_VERSION=\"v0.21.0\"\n#   Install vfb and firefox requirement if docker-test env\nRUN echo \"Running in testing environment - Installing Firefox and Gecko Driver\" \\\n && apt-get update \\\n && apt-get install --no-install-recommends xvfb x11-xkb-utils xfonts-100dpi xfonts-75dpi xfonts-scalable xfonts-cyrillic firefox -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && cd /usr/local/bin \\\n && wget http://github.com/mozilla/geckodriver/releases/download/$GECKODRIVER_VERSION/geckodriver-$GECKODRIVER_VERSION-linux64.tar.gz \\\n && tar -xvzf geckodriver-$GECKODRIVER_VERSION-linux64.tar.gz \\\n && rm geckodriver-$GECKODRIVER_VERSION-linux64.tar.gz \\\n && chmod +x geckodriver\n#   Test adding the git repo to the container for coveralls\n#   The #TEST# will be removed in the travis test script to be run in the test container\n#  TEST#COPY .git /opt/openstudio/.git\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#  AUTHOR:           Nicholas Long\n#  DESCRIPTION:      OpenStudio Server Docker Container\n#  TO_BUILD_AND_RUN: docker-compose up\n#  NOTES:            Currently this is one big dockerfile and non-optimal.\n# may include suffix\nARG OPENSTUDIO_VERSION\nFROM nrel/openstudio:$OPENSTUDIO_VERSION AS base\nMAINTAINER Nicholas Long nicholas.long@nrel.gov\n#  Install required libaries.\n#    realpath - needed for wait-for-it\nRUN sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 7F0CEB10 \\\n && echo \"deb http://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/3.0 multiverse\" | sudo tee /etc/apt/sources.list.d/mongodb-org-3.0.list \\\n && apt-get update \\\n && apt-get install --no-install-recommends apt-transport-https autoconf bison build-essential bzip2 ca-certificates curl default-jdk dos2unix imagemagick gdebi-core git libbz2-dev libcurl4-openssl-dev libdbus-glib-1-2 libgdbm3 libgdbm-dev libglib2.0-dev libglu1 libgsl0-dev libncurses-dev libreadline-dev libxml2-dev libxslt-dev libffi-dev libssl-dev libyaml-dev libice-dev libsm-dev mongodb-org-tools procps realpath tar unzip wget zip zlib1g-dev -y \\\n && rm -rf /var/lib/apt/lists/*\n#  Install passenger (this also installs nginx)\nENV PASSENGER_VERSION=\"5.0.25\"\n#  Install Rack. Silly workaround for not having ruby 2.2.2. Rack 1.6.4 is the\n#  latest for Ruby <= 2.0\nRUN gem install rack -v=1.6.4\nRUN gem install passenger\nRUN passenger-install-nginx-module\n#  Configure the nginx server\nRUN mkdir /var/log/nginx\nADD /docker/server/nginx.conf /opt/nginx/conf/nginx.conf\n#  Radiance env vars. RUBYLIB is set in the base openstudio container\nENV OPENSTUDIO_SERVER=\"'true'\"\nENV OS_RAYPATH=\"/usr/local/openstudio-$OPENSTUDIO_VERSION/Radiance\"\nENV PERL_EXE_PATH=\"/usr/bin\"\n#  Specify a couple arguments here, after running the majority of the installation above\nARG rails_env=docker\nARG bundle_args=\"--without development test\"\n#  Set the rails env var\nENV RAILS_ENV=\"$rails_env\"\n# ### OpenStudio Server Code\n#  First upload the Gemfile* so that it can cache the Gems -- do this first because it is slow\nADD /bin /opt/openstudio/bin\nADD /server/Gemfile /opt/openstudio/server/Gemfile\nWORKDIR /opt/openstudio/server\nRUN bundle _${OS_BUNDLER_VERSION}_ install --jobs=3 --retry=3 $bundle_args\n#  Add the app assets and precompile assets. Do it this way so that when the app changes the assets don't\n#  have to be recompiled everytime\nADD /server/Rakefile /opt/openstudio/server/Rakefile\nADD /server/config/ /opt/openstudio/server/config/\nADD /server/app/assets/ /opt/openstudio/server/app/assets/\n#  Now call precompile\nRUN mkdir /opt/openstudio/server/log\nRUN bundle exec rake assets:precompile\n#  Bundle app source\nADD /server /opt/openstudio/server\nADD .rubocop.yml /opt/openstudio/.rubocop.yml\n#  Run bundle again, because if the user has a local Gemfile.lock it will have been overriden\nRUN rm Gemfile.lock\nRUN bundle install --jobs=3 --retry=3\n#  Configure IPVS keepalive\nADD /docker/server/ipvs-keepalive.conf /etc/sysctl.d/ipvs-keepalive.conf\nRUN sudo sysctl --system\n#  Add in scripts for running server. This includes the wait-for-it scripts to ensure other processes (mongo, redis) have\n#  started before starting the main process.\nCOPY /docker/server/wait-for-it.sh /usr/local/bin/wait-for-it\nCOPY /docker/server/start-server.sh /usr/local/bin/start-server\nCOPY /docker/server/run-server-tests.sh /usr/local/bin/run-server-tests\nCOPY /docker/server/rails-entrypoint.sh /usr/local/bin/rails-entrypoint\nCOPY /docker/server/start-web-background.sh /usr/local/bin/start-web-background\nCOPY /docker/server/start-workers.sh /usr/local/bin/start-workers\nCOPY /docker/server/memfix-controller.rb /usr/local/lib/memfix-controller.rb\nCOPY /docker/server/memfix.rb /usr/local/lib/memfix.rb\nRUN chmod 755 /usr/local/bin/wait-for-it\nRUN chmod +x /usr/local/bin/start-server\nRUN chmod +x /usr/local/bin/run-server-tests\nRUN chmod 755 /usr/local/bin/rails-entrypoint\nRUN chmod 755 /usr/local/bin/start-web-background\nRUN chmod 755 /usr/local/bin/start-workers\nRUN chmod +x /usr/local/lib/memfix-controller.rb\nRUN chmod +x /usr/local/lib/memfix.rb\n#  set the permissions for windows users\nRUN chmod +x /opt/openstudio/server/bin/*\nENTRYPOINT [\"rails-entrypoint\"]\nCMD [\"/usr/local/bin/start-server\"]\n#  Expose ports.\nEXPOSE 8080/tcp 9090/tcp\n#  Multistage build includes test library. To build without testing run\n#  docker build --target base -t some-tag .\nFROM base\nENV GECKODRIVER_VERSION=\"v0.21.0\"\n#  Install vfb and firefox requirement if docker-test env\nRUN echo \"Running in testing environment - Installing Firefox and Gecko Driver\" \\\n && apt-get update \\\n && apt-get install xvfb x11-xkb-utils xfonts-100dpi xfonts-75dpi xfonts-scalable xfonts-cyrillic firefox -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && cd /usr/local/bin \\\n && wget http://github.com/mozilla/geckodriver/releases/download/$GECKODRIVER_VERSION/geckodriver-$GECKODRIVER_VERSION-linux64.tar.gz \\\n && tar -xvzf geckodriver-$GECKODRIVER_VERSION-linux64.tar.gz \\\n && rm geckodriver-$GECKODRIVER_VERSION-linux64.tar.gz \\\n && chmod +x geckodriver\n#  Test adding the git repo to the container for coveralls\n#  The #TEST# will be removed in the travis test script to be run in the test container\n# TEST#COPY .git /opt/openstudio/.git\n","injectedSmells":[],"originalDockerfileHash":"045706e289abc6c26a36a53da7d009e9","successfullyInjectedSmells":[],"originalDockerfileUglified":"#   AUTHOR:           Nicholas Long\n#   DESCRIPTION:      OpenStudio Server Docker Container\n#   TO_BUILD_AND_RUN: docker-compose up\n#   NOTES:            Currently this is one big dockerfile and non-optimal.\n#  may include suffix\nARG OPENSTUDIO_VERSION\nFROM nrel/openstudio:$OPENSTUDIO_VERSION AS base\nMAINTAINER Nicholas Long nicholas.long@nrel.gov\n#   Install required libaries.\n#     realpath - needed for wait-for-it\nRUN sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 7F0CEB10 \\\n && echo \"deb http://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/3.0 multiverse\" | sudo tee /etc/apt/sources.list.d/mongodb-org-3.0.list \\\n && apt-get update \\\n && apt-get install --no-install-recommends apt-transport-https autoconf bison build-essential bzip2 ca-certificates curl default-jdk dos2unix imagemagick gdebi-core git libbz2-dev libcurl4-openssl-dev libdbus-glib-1-2 libgdbm3 libgdbm-dev libglib2.0-dev libglu1 libgsl0-dev libncurses-dev libreadline-dev libxml2-dev libxslt-dev libffi-dev libssl-dev libyaml-dev libice-dev libsm-dev mongodb-org-tools procps realpath tar unzip wget zip zlib1g-dev -y \\\n && rm -rf /var/lib/apt/lists/*\n#   Install passenger (this also installs nginx)\nENV PASSENGER_VERSION=\"5.0.25\"\n#   Install Rack. Silly workaround for not having ruby 2.2.2. Rack 1.6.4 is the\n#   latest for Ruby <= 2.0\nRUN gem install rack -v=1.6.4\nRUN gem install passenger\nRUN passenger-install-nginx-module\n#   Configure the nginx server\nRUN mkdir /var/log/nginx\nADD /docker/server/nginx.conf /opt/nginx/conf/nginx.conf\n#   Radiance env vars. RUBYLIB is set in the base openstudio container\nENV OPENSTUDIO_SERVER=\"'true'\"\nENV OS_RAYPATH=\"/usr/local/openstudio-$OPENSTUDIO_VERSION/Radiance\"\nENV PERL_EXE_PATH=\"/usr/bin\"\n#   Specify a couple arguments here, after running the majority of the installation above\nARG rails_env=docker\nARG bundle_args=\"--without development test\"\n#   Set the rails env var\nENV RAILS_ENV=\"$rails_env\"\n#  ### OpenStudio Server Code\n#   First upload the Gemfile* so that it can cache the Gems -- do this first because it is slow\nADD /bin /opt/openstudio/bin\nADD /server/Gemfile /opt/openstudio/server/Gemfile\nWORKDIR /opt/openstudio/server\nRUN bundle _${OS_BUNDLER_VERSION}_ install --jobs=3 --retry=3 $bundle_args\n#   Add the app assets and precompile assets. Do it this way so that when the app changes the assets don't\n#   have to be recompiled everytime\nADD /server/Rakefile /opt/openstudio/server/Rakefile\nADD /server/config/ /opt/openstudio/server/config/\nADD /server/app/assets/ /opt/openstudio/server/app/assets/\n#   Now call precompile\nRUN mkdir /opt/openstudio/server/log\nRUN bundle exec rake assets:precompile\n#   Bundle app source\nADD /server /opt/openstudio/server\nADD .rubocop.yml /opt/openstudio/.rubocop.yml\n#   Run bundle again, because if the user has a local Gemfile.lock it will have been overriden\nRUN rm Gemfile.lock\nRUN bundle install --jobs=3 --retry=3\n#   Configure IPVS keepalive\nADD /docker/server/ipvs-keepalive.conf /etc/sysctl.d/ipvs-keepalive.conf\nRUN sudo sysctl --system\n#   Add in scripts for running server. This includes the wait-for-it scripts to ensure other processes (mongo, redis) have\n#   started before starting the main process.\nCOPY /docker/server/wait-for-it.sh /usr/local/bin/wait-for-it\nCOPY /docker/server/start-server.sh /usr/local/bin/start-server\nCOPY /docker/server/run-server-tests.sh /usr/local/bin/run-server-tests\nCOPY /docker/server/rails-entrypoint.sh /usr/local/bin/rails-entrypoint\nCOPY /docker/server/start-web-background.sh /usr/local/bin/start-web-background\nCOPY /docker/server/start-workers.sh /usr/local/bin/start-workers\nCOPY /docker/server/memfix-controller.rb /usr/local/lib/memfix-controller.rb\nCOPY /docker/server/memfix.rb /usr/local/lib/memfix.rb\nRUN chmod 755 /usr/local/bin/wait-for-it\nRUN chmod +x /usr/local/bin/start-server\nRUN chmod +x /usr/local/bin/run-server-tests\nRUN chmod 755 /usr/local/bin/rails-entrypoint\nRUN chmod 755 /usr/local/bin/start-web-background\nRUN chmod 755 /usr/local/bin/start-workers\nRUN chmod +x /usr/local/lib/memfix-controller.rb\nRUN chmod +x /usr/local/lib/memfix.rb\n#   set the permissions for windows users\nRUN chmod +x /opt/openstudio/server/bin/*\nENTRYPOINT [\"rails-entrypoint\"]\nCMD [\"/usr/local/bin/start-server\"]\n#   Expose ports.\nEXPOSE 8080/tcp 9090/tcp\n#   Multistage build includes test library. To build without testing run\n#   docker build --target base -t some-tag .\nFROM base\nENV GECKODRIVER_VERSION=\"v0.21.0\"\n#   Install vfb and firefox requirement if docker-test env\nRUN echo \"Running in testing environment - Installing Firefox and Gecko Driver\" \\\n && apt-get update \\\n && apt-get install xvfb x11-xkb-utils xfonts-100dpi xfonts-75dpi xfonts-scalable xfonts-cyrillic firefox -y \\\n && rm -rf /var/lib/apt/lists/* \\\n && cd /usr/local/bin \\\n && wget http://github.com/mozilla/geckodriver/releases/download/$GECKODRIVER_VERSION/geckodriver-$GECKODRIVER_VERSION-linux64.tar.gz \\\n && tar -xvzf geckodriver-$GECKODRIVER_VERSION-linux64.tar.gz \\\n && rm geckodriver-$GECKODRIVER_VERSION-linux64.tar.gz \\\n && chmod +x geckodriver\n#   Test adding the git repo to the container for coveralls\n#   The #TEST# will be removed in the travis test script to be run in the test container\n#  TEST#COPY .git /opt/openstudio/.git\n","originalDockerfileUglifiedHash":"72d1ec5dbb9bcbe7e49e2bd72b94d75d","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles_bianncle/674a39ef1f52e3ba32dfa13eabfe3be1a888d90f.dockerfile"}