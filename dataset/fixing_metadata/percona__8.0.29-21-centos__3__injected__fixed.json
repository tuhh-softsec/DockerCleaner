{"seed":2262086807,"processedDockerfileHash":"c09f41cbe9ad4a6bf0868131c67b7b4b","fixedSmells":["do-not-have-secrets","have-a-healthcheck","have-a-user"],"successfullyFixedSmells":["do-not-have-secrets","have-a-healthcheck","have-a-user"],"processedDockerfile":"#   This Dockerfile should be used for docker official repo\n#   https://github.com/docker-library/official-images:\n#   No official images can be derived from, or depend on, non-official images\n#   with the following notable exceptions...\nFROM oraclelinux:8\nLABEL org.opencontainers.image.authors=\"info@percona.com\"\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#   It is intentionally used another UID, to have backward compatibility with\n#   the previous image versions published on Docker Hub\nRUN set -ex ; groupdel input ; userdel systemd-coredump ; groupadd -g 1001 mysql ; useradd -u 1001 -r -g 1001 -s /sbin/nologin -c \"Default Application User\" mysql\n#   check repository package signature in secure way\nRUN set -ex ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver keyserver.ubuntu.com --recv-keys 430BDF5C56E7C94E848EE60C1C4CBDCDCD2EFD2A 99DB70FAE1D7CE227FB6488205B555B38483C65D ; gpg --batch --export --armor 430BDF5C56E7C94E848EE60C1C4CBDCDCD2EFD2A > ${GNUPGHOME}/RPM-GPG-KEY-Percona; gpg --batch --export --armor 99DB70FAE1D7CE227FB6488205B555B38483C65D > ${GNUPGHOME}/RPM-GPG-KEY-centosofficial; rpmkeys --import ${GNUPGHOME}/RPM-GPG-KEY-Percona ${GNUPGHOME}/RPM-GPG-KEY-centosofficial ; curl -Lf -o /tmp/percona-release.rpm https://repo.percona.com/yum/percona-release-latest.noarch.rpm ; rpmkeys --checksig /tmp/percona-release.rpm ; rpm -i /tmp/percona-release.rpm ; rm -rf \"$GNUPGHOME\" /tmp/percona-release.rpm ; rpm --import /etc/pki/rpm-gpg/PERCONA-PACKAGING-KEY ; dnf -y module disable mysql ; percona-release disable all ; percona-release enable ps-80 release\nENV PS_VERSION=\"8.0.29-21.1\"\nENV OS_VER=\"el8\"\nENV FULL_PERCONA_VERSION=\"\\\"$PS_VERSION.$OS_VER\\\"\"\nRUN set -ex ; rpm -e --nodeps tzdata ; dnf -y install hostname tzdata jemalloc which cracklib-dicts tar policycoreutils ; dnf -y install percona-server-server-${FULL_PERCONA_VERSION} percona-server-devel-${FULL_PERCONA_VERSION} percona-server-rocksdb-${FULL_PERCONA_VERSION} ; dnf clean all ; rm -rf /var/cache/dnf /var/cache/yum /var/lib/mysql\n#   purge and re-create /var/lib/mysql with appropriate ownership\nRUN set -ex ; /usr/bin/install -m 0775 -o mysql -g root -d /var/lib/mysql /var/run/mysqld /docker-entrypoint-initdb.d ; find /etc/my.cnf /etc/my.cnf.d -name '*.cnf' -print0 | xargs -0 grep -lZE '^(bind-address|log|user)' | xargs -rt -0 sed -Ei 's/^(bind-address|log|user)/#&/' ; echo '!includedir /etc/my.cnf.d' >> /etc/my.cnf; printf '[mysqld]\\nskip-host-cache\\nskip-name-resolve\\n' > /etc/my.cnf.d/docker.cnf; /usr/bin/install -m 0664 -o mysql -g root /dev/null /etc/sysconfig/mysql ; echo \"LD_PRELOAD=/usr/lib64/libjemalloc.so.1\" >> /etc/sysconfig/mysql; echo \"THP_SETTING=never\" >> /etc/sysconfig/mysql; chown -R mysql:root /etc/my.cnf /etc/my.cnf.d ; chmod -R ug+rwX /etc/my.cnf /etc/my.cnf.d\nVOLUME [\"/var/lib/mysql\", \"/var/log/mysql\"]\nCOPY ps-entry.sh /docker-entrypoint.sh\nENTRYPOINT [\"/docker-entrypoint.sh\"]\nUSER mysql\nEXPOSE 3306/tcp 33060/tcp\nCOPY docker-healthcheck /usr/local/bin/\nCMD [\"mysqld\"]\nUSER 0\n# A secret has been removed here. Please do not provide secrets from the Dockerfile as these will leak into the metadata of the resulting docker image. To provide secrets the --secret flag of the docker build command can be used (https://docs.docker.com/develop/develop-images/build_enhancements/#new-docker-build-secret-information).\nRUN groupadd --system docker-user ; useradd --system --gid docker-user docker-user\nUSER docker-user\n# Please add your HEALTHCHECK here!!!\n","originalDockerfile":"#  This Dockerfile should be used for docker official repo\n#  https://github.com/docker-library/official-images:\n#  No official images can be derived from, or depend on, non-official images\n#  with the following notable exceptions...\nFROM oraclelinux:8\nLABEL org.opencontainers.image.authors=\"info@percona.com\"\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#  It is intentionally used another UID, to have backward compatibility with\n#  the previous image versions published on Docker Hub\nRUN set -ex ; groupdel input ; userdel systemd-coredump ; groupadd -g 1001 mysql ; useradd -u 1001 -r -g 1001 -s /sbin/nologin -c \"Default Application User\" mysql\n#  check repository package signature in secure way\nRUN set -ex ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver keyserver.ubuntu.com --recv-keys 430BDF5C56E7C94E848EE60C1C4CBDCDCD2EFD2A 99DB70FAE1D7CE227FB6488205B555B38483C65D ; gpg --batch --export --armor 430BDF5C56E7C94E848EE60C1C4CBDCDCD2EFD2A > ${GNUPGHOME}/RPM-GPG-KEY-Percona; gpg --batch --export --armor 99DB70FAE1D7CE227FB6488205B555B38483C65D > ${GNUPGHOME}/RPM-GPG-KEY-centosofficial; rpmkeys --import ${GNUPGHOME}/RPM-GPG-KEY-Percona ${GNUPGHOME}/RPM-GPG-KEY-centosofficial ; curl -Lf -o /tmp/percona-release.rpm https://repo.percona.com/yum/percona-release-latest.noarch.rpm ; rpmkeys --checksig /tmp/percona-release.rpm ; rpm -i /tmp/percona-release.rpm ; rm -rf \"$GNUPGHOME\" /tmp/percona-release.rpm ; rpm --import /etc/pki/rpm-gpg/PERCONA-PACKAGING-KEY ; dnf -y module disable mysql ; percona-release disable all ; percona-release enable ps-80 release\nENV PS_VERSION=\"8.0.29-21.1\"\nENV OS_VER=\"el8\"\nENV FULL_PERCONA_VERSION=\"\\\"$PS_VERSION.$OS_VER\\\"\"\nRUN set -ex ; rpm -e --nodeps tzdata ; dnf -y install hostname tzdata jemalloc which cracklib-dicts tar policycoreutils ; dnf -y install percona-server-server-${FULL_PERCONA_VERSION} percona-server-devel-${FULL_PERCONA_VERSION} percona-server-rocksdb-${FULL_PERCONA_VERSION} ; dnf clean all ; rm -rf /var/cache/dnf /var/cache/yum /var/lib/mysql\n#  purge and re-create /var/lib/mysql with appropriate ownership\nRUN set -ex ; /usr/bin/install -m 0775 -o mysql -g root -d /var/lib/mysql /var/run/mysqld /docker-entrypoint-initdb.d ; find /etc/my.cnf /etc/my.cnf.d -name '*.cnf' -print0 | xargs -0 grep -lZE '^(bind-address|log|user)' | xargs -rt -0 sed -Ei 's/^(bind-address|log|user)/#&/' ; echo '!includedir /etc/my.cnf.d' >> /etc/my.cnf; printf '[mysqld]\\nskip-host-cache\\nskip-name-resolve\\n' > /etc/my.cnf.d/docker.cnf; /usr/bin/install -m 0664 -o mysql -g root /dev/null /etc/sysconfig/mysql ; echo \"LD_PRELOAD=/usr/lib64/libjemalloc.so.1\" >> /etc/sysconfig/mysql; echo \"THP_SETTING=never\" >> /etc/sysconfig/mysql; chown -R mysql:root /etc/my.cnf /etc/my.cnf.d ; chmod -R ug+rwX /etc/my.cnf /etc/my.cnf.d\nVOLUME [\"/var/lib/mysql\", \"/var/log/mysql\"]\nCOPY ps-entry.sh /docker-entrypoint.sh\nENTRYPOINT [\"/docker-entrypoint.sh\"]\nUSER mysql\nEXPOSE 3306/tcp 33060/tcp\nCOPY docker-healthcheck /usr/local/bin/\nCMD [\"mysqld\"]\nUSER 0\nENV NPM_TOKEN=\"npm_w2muR6WMV1VxU-ZPcVvqp5iBMgyZZAAitNX8\" \\\n    AWS_ACCESS_KEY=\"A3T7PLGPMVWBSVVH0SGO\" \\\n    SLACK_TOKEN=\"xoxb-25৯311404563-7SknuBoufhK1Xt1Q36KYVSa2\"\n","injectedSmells":[],"originalDockerfileHash":"43be93f4d38d8d374d7ebfcd86d4b497","successfullyInjectedSmells":[],"originalDockerfileUglified":"#   This Dockerfile should be used for docker official repo\n#   https://github.com/docker-library/official-images:\n#   No official images can be derived from, or depend on, non-official images\n#   with the following notable exceptions...\nFROM oraclelinux:8\nLABEL org.opencontainers.image.authors=\"info@percona.com\"\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n#   It is intentionally used another UID, to have backward compatibility with\n#   the previous image versions published on Docker Hub\nRUN set -ex ; groupdel input ; userdel systemd-coredump ; groupadd -g 1001 mysql ; useradd -u 1001 -r -g 1001 -s /sbin/nologin -c \"Default Application User\" mysql\n#   check repository package signature in secure way\nRUN set -ex ; export GNUPGHOME=\"$( mktemp -d ;)\" ; gpg --batch --keyserver keyserver.ubuntu.com --recv-keys 430BDF5C56E7C94E848EE60C1C4CBDCDCD2EFD2A 99DB70FAE1D7CE227FB6488205B555B38483C65D ; gpg --batch --export --armor 430BDF5C56E7C94E848EE60C1C4CBDCDCD2EFD2A > ${GNUPGHOME}/RPM-GPG-KEY-Percona; gpg --batch --export --armor 99DB70FAE1D7CE227FB6488205B555B38483C65D > ${GNUPGHOME}/RPM-GPG-KEY-centosofficial; rpmkeys --import ${GNUPGHOME}/RPM-GPG-KEY-Percona ${GNUPGHOME}/RPM-GPG-KEY-centosofficial ; curl -Lf -o /tmp/percona-release.rpm https://repo.percona.com/yum/percona-release-latest.noarch.rpm ; rpmkeys --checksig /tmp/percona-release.rpm ; rpm -i /tmp/percona-release.rpm ; rm -rf \"$GNUPGHOME\" /tmp/percona-release.rpm ; rpm --import /etc/pki/rpm-gpg/PERCONA-PACKAGING-KEY ; dnf -y module disable mysql ; percona-release disable all ; percona-release enable ps-80 release\nENV PS_VERSION=\"8.0.29-21.1\"\nENV OS_VER=\"el8\"\nENV FULL_PERCONA_VERSION=\"\\\"$PS_VERSION.$OS_VER\\\"\"\nRUN set -ex ; rpm -e --nodeps tzdata ; dnf -y install hostname tzdata jemalloc which cracklib-dicts tar policycoreutils ; dnf -y install percona-server-server-${FULL_PERCONA_VERSION} percona-server-devel-${FULL_PERCONA_VERSION} percona-server-rocksdb-${FULL_PERCONA_VERSION} ; dnf clean all ; rm -rf /var/cache/dnf /var/cache/yum /var/lib/mysql\n#   purge and re-create /var/lib/mysql with appropriate ownership\nRUN set -ex ; /usr/bin/install -m 0775 -o mysql -g root -d /var/lib/mysql /var/run/mysqld /docker-entrypoint-initdb.d ; find /etc/my.cnf /etc/my.cnf.d -name '*.cnf' -print0 | xargs -0 grep -lZE '^(bind-address|log|user)' | xargs -rt -0 sed -Ei 's/^(bind-address|log|user)/#&/' ; echo '!includedir /etc/my.cnf.d' >> /etc/my.cnf; printf '[mysqld]\\nskip-host-cache\\nskip-name-resolve\\n' > /etc/my.cnf.d/docker.cnf; /usr/bin/install -m 0664 -o mysql -g root /dev/null /etc/sysconfig/mysql ; echo \"LD_PRELOAD=/usr/lib64/libjemalloc.so.1\" >> /etc/sysconfig/mysql; echo \"THP_SETTING=never\" >> /etc/sysconfig/mysql; chown -R mysql:root /etc/my.cnf /etc/my.cnf.d ; chmod -R ug+rwX /etc/my.cnf /etc/my.cnf.d\nVOLUME [\"/var/lib/mysql\", \"/var/log/mysql\"]\nCOPY ps-entry.sh /docker-entrypoint.sh\nENTRYPOINT [\"/docker-entrypoint.sh\"]\nUSER mysql\nEXPOSE 3306/tcp 33060/tcp\nCOPY docker-healthcheck /usr/local/bin/\nCMD [\"mysqld\"]\nUSER 0\nENV NPM_TOKEN=\"npm_w2muR6WMV1VxU-ZPcVvqp5iBMgyZZAAitNX8\" \\\n    AWS_ACCESS_KEY=\"A3T7PLGPMVWBSVVH0SGO\" \\\n    SLACK_TOKEN=\"xoxb-25৯311404563-7SknuBoufhK1Xt1Q36KYVSa2\"\n","originalDockerfileUglifiedHash":"f90757b99e83ab68826e973e2e1903e1","fileName":"/ICSME-replicationpackage/dataset/smelly_dockerfiles/percona__8.0.29-21-centos__3__injected.dockerfile"}